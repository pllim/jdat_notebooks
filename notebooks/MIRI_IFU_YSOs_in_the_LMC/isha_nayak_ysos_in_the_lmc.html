<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
  <title>
   IFU of YSOs in LMC — STScI JDAT Notebooks
  </title>
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
  <link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
  <link href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
  <link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" rel="stylesheet" type="text/css"/>
  <link href="../../_static/togglebutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/copybutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/mystnb.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/sphinx-thebe.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/main.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" rel="stylesheet" type="text/css"/>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
  <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js">
  </script>
  <script src="../../_static/jquery.js">
  </script>
  <script src="../../_static/underscore.js">
  </script>
  <script src="../../_static/doctools.js">
  </script>
  <script src="../../_static/clipboard.min.js">
  </script>
  <script src="../../_static/copybutton.js">
  </script>
  <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411">
  </script>
  <script>
   let toggleHintShow = 'Click to show';
  </script>
  <script>
   let toggleHintHide = 'Click to hide';
  </script>
  <script>
   let toggleOpenOnPrint = 'true';
  </script>
  <script src="../../_static/togglebutton.js">
  </script>
  <script>
   var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';
  </script>
  <script src="../../_static/design-tabs.js">
  </script>
  <script>
   const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
  </script>
  <script async="async" src="../../_static/sphinx-thebe.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js">
  </script>
  <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js">
  </script>
  <link href="../../genindex.html" rel="index" title="Index"/>
  <link href="../../search.html" rel="search" title="Search"/>
  <link href="../MIRI_LRS_spectral_extraction/miri_lrs_spectral_extraction.html" rel="next" title="LRS Optimal Spectral Extraction"/>
  <link href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html" rel="prev" title="MRS Cube Analysis"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <meta content="None" name="docsearch:language"/>
  <!-- Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3">
  </script>
  <script>
   window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-D46G4HKJY3');
  </script>
 </head>
 <body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
  <!-- Checkboxes to toggle the left sidebar -->
  <input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
  <label class="overlay overlay-navbar" for="__navigation">
   <div class="visually-hidden">
    Toggle navigation sidebar
   </div>
  </label>
  <!-- Checkboxes to toggle the in-page toc -->
  <input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
  <label class="overlay overlay-pagetoc" for="__page-toc">
   <div class="visually-hidden">
    Toggle in-page Table of Contents
   </div>
  </label>
  <!-- Headers at the top -->
  <div class="announcement header-item noprint">
  </div>
  <div class="header header-item noprint">
  </div>
  <div class="container-fluid" id="banner">
  </div>
  <div class="container-xl">
   <div class="row">
    <!-- Sidebar -->
    <div class="bd-sidebar noprint" id="site-navigation">
     <div class="bd-sidebar__content">
      <div class="bd-sidebar__top">
       <div class="navbar-brand-box">
        <a class="navbar-brand text-wrap" href="../../index.html">
         <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
         <img alt="logo" class="logo" src="../../_static/stsci_logo2.png"/>
         <h1 class="site-logo" id="site-title">
          STScI JDAT Notebooks
         </h1>
        </a>
       </div>
       <form action="../../search.html" class="bd-search d-flex align-items-center" method="get">
        <i class="icon fas fa-search">
        </i>
        <input aria-label="Search this book..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." type="search"/>
       </form>
       <nav aria-label="Main" class="bd-links" id="bd-docs-nav">
        <div class="bd-toc-item active">
         <ul class="nav bd-sidenav bd-sidenav__home-link">
          <li class="toctree-l1">
           <a class="reference internal" href="../../intro.html">
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           General
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../../index.html">
            Home
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../../install.html">
            Installation
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           Cross-Instrument
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../asdf_example/asdf_example.html">
            ASDF Example
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../background_estimation_imaging/Imaging_Sky_Background_Estimation.html">
            Complex 2D Background
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../composite_model_fitting/specfit_demo_3.html">
            Composite Model Spectral Fitting
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">
            MAST Query
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">
            Specviz Simple Demo
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../cube_fitting/cube_fitting.html">
            IFU Cube Line Maps
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           MIRI
          </span>
         </p>
         <ul class="current nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_runpipeline.html">
            MRS Mstar - Run Pipeline
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_PointSourceDetectorBasedExtraction.html">
            MRS Detector Based Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">
            MRS Mstar - Data Analysis
           </a>
          </li>
          <li class="toctree-l1 current active">
           <a class="current reference internal" href="#">
            IFU of YSOs in LMC
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_spectral_extraction.html">
            LRS Optimal Spectral Extraction
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           NIRCam
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../aperture_photometry/NIRCam_Aperture_Photometry_Example.html">
            Point Source Aperture Photometry
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRCam_photometry/NIRCam_multiband_photometry.html">
            Extended Aperture Photometry
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">
            Cross-Filter PSF Matching
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../psf_photometry/NIRCam_PSF_Photometry_Example.html">
            PSF Photometry
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           NIRISS
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRISS_WFSS_postpipeline/00_Optimal_extraction.html">
            WFSS Spectra - Optimal Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRISS_WFSS_postpipeline/01_Combine_and_normalize_1D_spectra.html">
            WFSS Spectra - Combine and Normalize 1D Spectra
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRISS_WFSS_postpipeline/02_Cross_correlation_template.html">
            WFSS Spectra - Cross-Correlation Template
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.html">
            WFSS Spectra - Emission Line Map
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           NIRSpec
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">
            IFU Cube Fitting
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../ifu_optimal/ifu_optimal.html">
            IFU Optimal Spectral Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../optimal_extraction/Spectral_Extraction-static.html">
            MOS Optimal Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../mos-spectroscopy/MOSspec_sv06_revised.html">
            MOS Spectroscopy of Extragalactic Field
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">
            BOTS Time Series Observations
           </a>
          </li>
         </ul>
        </div>
       </nav>
      </div>
      <div class="bd-sidebar__bottom">
       <!-- To handle the deprecated key -->
       <div class="navbar_extra_footer">
        Powered by
        <a href="https://jupyterbook.org">
         Jupyter Book
        </a>
       </div>
      </div>
     </div>
     <div id="rtd-footer-container">
     </div>
    </div>
    <!-- A tiny helper pixel to detect if we've scrolled -->
    <div class="sbt-scroll-pixel-helper">
    </div>
    <!-- Main content -->
    <div class="col py-0 content-container">
     <div class="header-article row sticky-top noprint">
      <div class="col py-1 d-flex header-article-main">
       <div class="header-article__left">
        <label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
         <span class="headerbtn__icon-container">
          <i class="fas fa-bars">
          </i>
         </span>
        </label>
       </div>
       <div class="header-article__right">
        <div class="menu-dropdown menu-dropdown-launch-buttons">
         <button aria-label="Launch interactive content" class="headerbtn menu-dropdown__trigger">
          <i class="fas fa-rocket">
          </i>
         </button>
         <div class="menu-dropdown__content">
          <ul>
           <li>
            <button class="headerbtn headerbtn-launch-thebe" data-placement="left" data-toggle="tooltip" onclick="initThebeSBT()" title="Launch Thebe">
             <span class="headerbtn__icon-container">
              <i class="fas fa-play">
              </i>
             </span>
             <span class="headerbtn__text-container">
              Live Code
             </span>
            </button>
           </li>
          </ul>
         </div>
        </div>
        <button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
         <span class="headerbtn__icon-container">
          <i class="fas fa-expand">
          </i>
         </span>
        </button>
        <div class="menu-dropdown menu-dropdown-repository-buttons">
         <button aria-label="Source repositories" class="headerbtn menu-dropdown__trigger">
          <i class="fab fa-github">
          </i>
         </button>
         <div class="menu-dropdown__content">
          <ul>
           <li>
            <a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/spacetelescope/jdat_notebooks/" title="Source repository">
             <span class="headerbtn__icon-container">
              <i class="fab fa-github">
              </i>
             </span>
             <span class="headerbtn__text-container">
              repository
             </span>
            </a>
           </li>
           <li>
            <a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/spacetelescope/jdat_notebooks//issues/new?title=Issue%20on%20page%20%2Fnotebooks/MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html&amp;body=Your%20issue%20content%20here." title="Open an issue">
             <span class="headerbtn__icon-container">
              <i class="fas fa-lightbulb">
              </i>
             </span>
             <span class="headerbtn__text-container">
              open issue
             </span>
            </a>
           </li>
          </ul>
         </div>
        </div>
        <div class="menu-dropdown menu-dropdown-download-buttons">
         <button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
          <i class="fas fa-download">
          </i>
         </button>
         <div class="menu-dropdown__content">
          <ul>
           <li>
            <a class="headerbtn" data-placement="left" data-toggle="tooltip" href="../../_sources/notebooks/MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.ipynb" title="Download source file">
             <span class="headerbtn__icon-container">
              <i class="fas fa-file">
              </i>
             </span>
             <span class="headerbtn__text-container">
              .ipynb
             </span>
            </a>
           </li>
           <li>
            <button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
             <span class="headerbtn__icon-container">
              <i class="fas fa-file-pdf">
              </i>
             </span>
             <span class="headerbtn__text-container">
              .pdf
             </span>
            </button>
           </li>
          </ul>
         </div>
        </div>
        <label class="headerbtn headerbtn-page-toc" for="__page-toc">
         <span class="headerbtn__icon-container">
          <i class="fas fa-list">
          </i>
         </span>
        </label>
       </div>
      </div>
      <!-- Table of contents -->
      <div class="col-md-3 bd-toc show noprint">
       <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list">
        </i>
        Contents
       </div>
       <nav aria-label="Page" id="bd-toc-nav">
        <ul class="visible nav section-nav flex-column">
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#import-things-you-need">
           Import things you need
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#check-versions-of-imported-things">
           Check versions of imported things
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#setup-output-directory-for-figures-and-spectra">
           Setup output directory for figures and spectra
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#set-plot-paramters">
           Set plot paramters
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#set-path-to-data">
           Set path to data
          </a>
          <ul class="nav section-nav flex-column">
           <li class="toc-h3 nav-item toc-entry">
            <a class="reference internal nav-link" href="#note-that-the-data-file-is-2-gb-so-download-will-take-a-while-depending-on-your-intenet-speed-you-can-also-download-directly-using-the-link-below">
             Note that the data file is ~2 GB, so download will take a while depending on your intenet speed. You can also download directly using the link below.
            </a>
           </li>
          </ul>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#load-and-display-data-cube">
           Load and display data cube
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#trim-the-cube">
           Trim the cube
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#make-a-2d-image-from-the-3d-cube-either-with-average-median-or-sum">
           Make a 2D image from the 3D cube either with average, median, or sum
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#plot-the-image-to-do-a-visual-check">
           Plot the image to do a visual check
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#plot-the-summed-image-with-wcs-coordinates-and-save-the-figure">
           Plot the summed image with WCS coordinates and save the figure
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#identify-all-point-sources-using-photutils">
           Identify all point sources using photutils
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#get-a-list-of-all-point-sources">
           Get a list of all point sources
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#extract-and-plot-spectrum-of-all-sources">
           Extract and plot spectrum of all sources
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#make-a-table-for-the-extracted-sources">
           Make a Table for the Extracted Sources
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#use-spitzer-irs-yso-spectra-from-here-on-out-for-science-test-cases">
           Use Spitzer IRS YSO Spectra from Here on Out For Science Test Cases
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#fit-a-generic-continuum">
           Fit a generic continuum
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#look-for-emission-and-absorption-lines">
           Look For Emission and Absorption Lines
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#identify-emission-and-absorption-lines">
           Identify emission and absorption lines
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#classify-the-yso-according-to-what-lines-are-detected">
           Classify the YSO according to what lines are detected
          </a>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#plot-the-spectra-and-label-the-emission-and-absorption-features">
           Plot the spectra and label the emission and absorption features
          </a>
         </li>
        </ul>
       </nav>
      </div>
     </div>
     <div class="article row">
      <div class="col pl-md-3 pl-lg-5 content-container">
       <!-- Table of contents that is only displayed when printing the page -->
       <div class="onlyprint" id="jb-print-docs-body">
        <h1>
         IFU of YSOs in LMC
        </h1>
        <!-- Table of contents -->
        <div id="print-main-content">
         <div id="jb-print-toc">
          <div>
           <h2>
            Contents
           </h2>
          </div>
          <nav aria-label="Page">
           <ul class="visible nav section-nav flex-column">
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#import-things-you-need">
              Import things you need
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#check-versions-of-imported-things">
              Check versions of imported things
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#setup-output-directory-for-figures-and-spectra">
              Setup output directory for figures and spectra
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#set-plot-paramters">
              Set plot paramters
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#set-path-to-data">
              Set path to data
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#note-that-the-data-file-is-2-gb-so-download-will-take-a-while-depending-on-your-intenet-speed-you-can-also-download-directly-using-the-link-below">
                Note that the data file is ~2 GB, so download will take a while depending on your intenet speed. You can also download directly using the link below.
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#load-and-display-data-cube">
              Load and display data cube
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#trim-the-cube">
              Trim the cube
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#make-a-2d-image-from-the-3d-cube-either-with-average-median-or-sum">
              Make a 2D image from the 3D cube either with average, median, or sum
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#plot-the-image-to-do-a-visual-check">
              Plot the image to do a visual check
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#plot-the-summed-image-with-wcs-coordinates-and-save-the-figure">
              Plot the summed image with WCS coordinates and save the figure
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#identify-all-point-sources-using-photutils">
              Identify all point sources using photutils
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#get-a-list-of-all-point-sources">
              Get a list of all point sources
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#extract-and-plot-spectrum-of-all-sources">
              Extract and plot spectrum of all sources
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#make-a-table-for-the-extracted-sources">
              Make a Table for the Extracted Sources
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#use-spitzer-irs-yso-spectra-from-here-on-out-for-science-test-cases">
              Use Spitzer IRS YSO Spectra from Here on Out For Science Test Cases
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#fit-a-generic-continuum">
              Fit a generic continuum
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#look-for-emission-and-absorption-lines">
              Look For Emission and Absorption Lines
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#identify-emission-and-absorption-lines">
              Identify emission and absorption lines
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#classify-the-yso-according-to-what-lines-are-detected">
              Classify the YSO according to what lines are detected
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#plot-the-spectra-and-label-the-emission-and-absorption-features">
              Plot the spectra and label the emission and absorption features
             </a>
            </li>
           </ul>
          </nav>
         </div>
        </div>
       </div>
       <main id="main-content" role="main">
        <div>
         <section class="tex2jax_ignore mathjax_ignore" id="ifu-of-ysos-in-lmc">
          <h1>
           IFU of YSOs in LMC
           <a class="headerlink" href="#ifu-of-ysos-in-lmc" title="Permalink to this headline">
            #
           </a>
          </h1>
          <p>
           <strong>
            Use case:
           </strong>
           Automatically detect point sources and extract photometry in a 3D cube. Analyze spectral lines.
           <br/>
           <strong>
            Data:
           </strong>
           ALMA 13CO data cubes.
           <br/>
           <strong>
            Tools:
           </strong>
           specutils, photutils, astropy.
           <br/>
           <strong>
            Cross-intrument:
           </strong>
           NIRSpec, MIRI.
           <br/>
           <strong>
            Documentation:
           </strong>
           This notebook is part of a STScI’s larger
           <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-post-pipeline-data-analysis">
            post-pipeline Data Analysis Tools Ecosystem
           </a>
           and can be
           <a class="reference external" href="https://github.com/spacetelescope/dat_pyinthesky/tree/main/jdat_notebooks/MRS_Mstar_analysis">
            downloaded
           </a>
           directly from the
           <a class="reference external" href="https://github.com/spacetelescope/jdat_notebooks">
            JDAT Notebook Github directory
           </a>
           .
           <br/>
          </p>
          <p>
           The LMC is the ideal site to study massive star formation because it is relatively close (d ~ 50 kpc) and has a face-on orientation so that we can resolve individual star formation sites and eliminate line of sight confusion. The Spitzer and Herschel surveys have identified thousands of YSOs in the LMC by using photometry that spans from 3 microns to 500 microns and are complete down to 8 solar mass YSOs.
          </p>
          <p>
           We know massive star formation occurs in dense molecular gas. ALMA observations of 12CO and 13CO molecular gas show evidence that colliding filaments can be a mechanisms for gas densities to be as high as 10^6 cm^-3. Massive stars up go 50 solar masses have been observed in dense cores at the center of colliding CO gas filaments seen with ALMA.
          </p>
          <p>
           The instruments on JWST will have angular resolutions 10 times better than Spitzer Space Telescope and sensitivities over a hundred times better than current instruments. Observations of YSOs with MIRI and NIRCam will be complete down to 1 solar mass YSOs, as oppose to 8 solar mass YSOs with Spitzer observations. The massive YSOs in the LMC are most likely a small cluster of YSOs, and with MRS we can get spectra of the individual object in the cluster. This will be a powerful tool in understanding star formation and cluster formation.
          </p>
          <p>
           For the first part, I use ALMA 13CO data cubes to read in the cube and make figures. There are nearly 400 massive stars in the footprint shown in this notebook. One of the goals of this notebook is to use photutils to automatically detect point sources and extract photometry in a given 3D cube. For the second part, I use Spitzer/IRS spectra of a known early-stage YSOs. YSOs have specific absorption and emission lines. The goal is to first use specutils to find the important lines to first identify if something is or is not a YSO based on what lines do exist or do not exist. And then the next step is to identify if the YSO is Stage I (most embedded with CO2 ice feature), Stage II (more evolved with ice and silicate absorption features), or Stage III (almost a flat spectrum with PAH emission) based on the emission and absorption lines detected.
          </p>
          <section id="import-things-you-need">
           <h2>
            Import things you need
            <a class="headerlink" href="#import-things-you-need" title="Permalink to this headline">
             #
            </a>
           </h2>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>import os

from astropy import units as u
from astropy.wcs import WCS
from astropy import constants as const
from astropy.io import ascii, fits
from astropy.nddata import StdDevUncertainty
from astropy.modeling import models
from astropy.table import Table, Column, vstack
from astropy.stats import sigma_clipped_stats
from astropy.utils.data import download_file
import urllib.request

import numpy as np
import pandas as pd

from scipy.optimize import curve_fit
from spectral_cube import SpectralCube
from photutils import DAOStarFinder, CircularAperture

from specutils import Spectrum1D, SpectralRegion
from specutils.analysis import snr, line_flux, centroid, equivalent_width
from specutils.fitting import fit_generic_continuum, fit_continuum, find_lines_threshold,  find_lines_derivative, estimate_line_parameters, fit_lines
from specutils.manipulation import noise_region_uncertainty, box_smooth, extract_region, gaussian_smooth, SplineInterpolatedResampler
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>/tmp/ipykernel_2136/4275384822.py:19: DeprecationWarning: `photutils.DAOStarFinder` is a deprecated alias for `photutils.detection.DAOStarFinder` and will be removed in the future. Instead, please use `from photutils.detection import DAOStarFinder` to silence this warning.
  from photutils import DAOStarFinder, CircularAperture
/tmp/ipykernel_2136/4275384822.py:19: DeprecationWarning: `photutils.CircularAperture` is a deprecated alias for `photutils.aperture.CircularAperture` and will be removed in the future. Instead, please use `from photutils.aperture import CircularAperture` to silence this warning.
  from photutils import DAOStarFinder, CircularAperture
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>%matplotlib inline
import matplotlib.pyplot as plt
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="check-versions-of-imported-things">
           <h2>
            Check versions of imported things
            <a class="headerlink" href="#check-versions-of-imported-things" title="Permalink to this headline">
             #
            </a>
           </h2>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>import aplpy
from aplpy import __version__ as aplpy_version
print("Aplpy: {}".format(aplpy_version))

import astrodendro
from astrodendro import __version__ as astrodendro_version
print("Astrodendro: {}".format(astrodendro_version))

import astropy
from astropy import __version__ as astropy_version
print("Astropy: {}".format(astropy_version))

import jwst
from jwst import __version__ as jwst_version
print("JWST: {}".format(jwst_version))

import matplotlib
from matplotlib import __version__ as matplotlib_version
print("Matplotlib: {}".format(matplotlib_version))

import numpy
from numpy import __version__ as numpy_version
print("Numpy: {}".format(numpy_version))

import pandas
from pandas import __version__ as pandas_version
print("Pandas: {}".format(pandas_version))

import photutils
from photutils import __version__ as photutils_version
print("Photutils: {}".format(photutils_version))

import scipy
from scipy import __version__ as scipy_version
print("Scipy: {}".format(scipy_version))

import specutils
from specutils import __version__ as specutils_version
print("Specutils: {}".format(specutils_version))

import spectral_cube
from spectral_cube import __version__ as spectral_cube_version
print("SpectralCube: {}".format(spectral_cube_version))
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Aplpy: 2.1.0
</pre>
              </div>
             </div>
             <div class="output traceback highlight-ipythontb notranslate">
              <div class="highlight">
               <pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">5</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">aplpy</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">aplpy_version</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"Aplpy: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aplpy_version</span><span class="p">))</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="kn">import</span> <span class="nn">astrodendro</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">from</span> <span class="nn">astrodendro</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">astrodendro_version</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"Astrodendro: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">astrodendro_version</span><span class="p">))</span>

<span class="n">File</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">miniconda</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">astrodendro</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Licensed under an MIT open source license - see LICENSE</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="kn">from</span> <span class="nn">.dendrogram</span> <span class="kn">import</span> <span class="n">Dendrogram</span><span class="p">,</span> <span class="n">periodic_neighbours</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">from</span> <span class="nn">.structure</span> <span class="kn">import</span> <span class="n">Structure</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">from</span> <span class="nn">.analysis</span> <span class="kn">import</span> <span class="n">ppv_catalog</span><span class="p">,</span> <span class="n">pp_catalog</span>

<span class="n">File</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">miniconda</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">astrodendro</span><span class="o">/</span><span class="n">dendrogram</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">23</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="c1"># utility dict to offsets of adjacent pixel list</span>
<span class="ne">---&gt; </span><span class="mi">23</span> <span class="n">_offsets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">ndim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>                 <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">ndim</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>                 <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">))</span>
<span class="nn">     26                 for ndim</span> in <span class="ni">range</span><span class="nt">(1, 8))</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="c1"># the formula above generalizes this special case</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="c1">#_offsets[3] = np.array([(0, 0, -1), (0, 0, 1),</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="c1">#                        (0, -1, 0), (0, 1, 0),</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="c1">#                        (-1, 0, 0), (1, 0, 0)])</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="k">class</span> <span class="nc">Dendrogram</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/astrodendro/dendrogram.py:25,</span> in <span class="ni">&lt;genexpr&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="c1"># utility dict to offsets of adjacent pixel list</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="n">_offsets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">ndim</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>                 <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">ndim</span><span class="p">),</span>
<span class="ne">---&gt; </span><span class="mi">25</span>                 <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">))</span>
<span class="nn">     26                 for ndim</span> in <span class="ni">range</span><span class="nt">(1, 8))</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="c1"># the formula above generalizes this special case</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="c1">#_offsets[3] = np.array([(0, 0, -1), (0, 0, 1),</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="c1">#                        (0, -1, 0), (0, 1, 0),</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="c1">#                        (-1, 0, 0), (1, 0, 0)])</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="k">class</span> <span class="nc">Dendrogram</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/numpy/__init__.py:284,</span> in <span class="ni">__getattr__</span><span class="nt">(attr)</span>
<span class="g g-Whitespace">    </span><span class="mi">281</span>     <span class="kn">from</span> <span class="nn">.testing</span> <span class="kn">import</span> <span class="n">Tester</span>
<span class="g g-Whitespace">    </span><span class="mi">282</span>     <span class="k">return</span> <span class="n">Tester</span>
<span class="ne">--&gt; </span><span class="mi">284</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">"module </span><span class="si">{!r}</span><span class="s2"> has no attribute "</span>
<span class="g g-Whitespace">    </span><span class="mi">285</span>                      <span class="s2">"</span><span class="si">{!r}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>

<span class="ne">AttributeError</span>: module 'numpy' has no attribute 'int'
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="setup-output-directory-for-figures-and-spectra">
           <h2>
            Setup output directory for figures and spectra
            <a class="headerlink" href="#setup-output-directory-for-figures-and-spectra" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            The user needs to setup their own path to where they want the output to be located.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>output_images = './Images' # This is where the output images will be located
output_spectra = './Spectra' # This is where the output spectra will be located

for directory in [output_images, output_spectra]:
    if not os.path.exists(directory):
        os.makedirs(directory)
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="set-plot-paramters">
           <h2>
            Set plot paramters
            <a class="headerlink" href="#set-plot-paramters" title="Permalink to this headline">
             #
            </a>
           </h2>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>params = {'legend.fontsize': '18',
        'axes.labelsize': '18',
        'axes.titlesize': '18',
        'xtick.labelsize': '18',
        'ytick.labelsize': '18',
        'lines.linewidth': 2,
        'axes.linewidth': 2,
        'animation.html': 'html5'}
plt.rcParams.update(params)
plt.rcParams.update({'figure.max_open_warning': 0})
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="set-path-to-data">
           <h2>
            Set path to data
            <a class="headerlink" href="#set-path-to-data" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            Using ALMA 13CO from a known star formation region in the LMC host to nearly 150 massive YSOs.
           </p>
           <section id="note-that-the-data-file-is-2-gb-so-download-will-take-a-while-depending-on-your-intenet-speed-you-can-also-download-directly-using-the-link-below">
            <h3>
             Note that the data file is ~2 GB, so download will take a while depending on your intenet speed. You can also download directly using the link below.
             <a class="headerlink" href="#note-that-the-data-file-is-2-gb-so-download-will-take-a-while-depending-on-your-intenet-speed-you-can-also-download-directly-using-the-link-below" title="Permalink to this headline">
              #
             </a>
            </h3>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span>data_file = './LMC_13CO.fits'
if os.path.exists("LMC_13CO.fits"):
    print("LMC_13CO.fits Already Exists")
else:
    print("Downloading LMC_13CO.fits")
    url = 'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MIRI_IFU_YSOs_in_the_LMC/LMC_13CO.fits'
    urllib.request.urlretrieve(url, './LMC_13CO.fits')
</pre>
               </div>
              </div>
             </div>
            </div>
           </section>
          </section>
          <section id="load-and-display-data-cube">
           <h2>
            Load and display data cube
            <a class="headerlink" href="#load-and-display-data-cube" title="Permalink to this headline">
             #
            </a>
           </h2>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>cube = SpectralCube.read(data_file, hdu=1)  
print(cube)
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="trim-the-cube">
           <h2>
            Trim the cube
            <a class="headerlink" href="#trim-the-cube" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            Not sure about JWST MRS cube, but in ALMA the beginning and end of cube have poor data quality so you can trim the cube to make it smaller if you want. I used the whole cube in this example.
           </p>
           <p>
            If you want to trim the cube to a certain spectral range then do the following:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">subcube</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">spectral_slab</span><span class="p">(</span><span class="mi">240</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">),</span> <span class="mi">265</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">))</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">subcube</span>
</pre>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>cube.allow_huge_operations = True
cmin = cube.minimal_subcube()
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="make-a-2d-image-from-the-3d-cube-either-with-average-median-or-sum">
           <h2>
            Make a 2D image from the 3D cube either with average, median, or sum
            <a class="headerlink" href="#make-a-2d-image-from-the-3d-cube-either-with-average-median-or-sum" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            This is to look for point sources. After you locate point sources, you will be applying aperture photometry to extract the spectrum.
           </p>
           <p>
            <strong>
             The code can take awhile
            </strong>
            since it is a big data cube.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>cont_img = cmin.sum(axis=0)
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="plot-the-image-to-do-a-visual-check">
           <h2>
            Plot the image to do a visual check
            <a class="headerlink" href="#plot-the-image-to-do-a-visual-check" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            This is to see if you even see any emission and to make sure you have the correct data cube.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>fig = plt.figure()
plt.imshow(cont_img.value)
plt.tight_layout()
plt.show()
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="plot-the-summed-image-with-wcs-coordinates-and-save-the-figure">
           <h2>
            Plot the summed image with WCS coordinates and save the figure
            <a class="headerlink" href="#plot-the-summed-image-with-wcs-coordinates-and-save-the-figure" title="Permalink to this headline">
             #
            </a>
           </h2>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>name = '13CO'

F = aplpy.FITSFigure(cont_img.hdu, north=True)
F.show_colorscale()
F.add_label(0.1, 0.9, name, relative=True, size=22, weight='bold')
F.axis_labels.set_font(size=22)
F.tick_labels.set_font(size=18, stretch='condensed')
F.save(output_images+"_"+name+".pdf", dpi=300) 
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="identify-all-point-sources-using-photutils">
           <h2>
            Identify all point sources using photutils
            <a class="headerlink" href="#identify-all-point-sources-using-photutils" title="Permalink to this headline">
             #
            </a>
           </h2>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Empty array to store values
name_val = []
source_val = []
ra_val = []
dec_val = []

# Find mean, meadian, and standard deviation of the summed image
mean, median, std = sigma_clipped_stats(cont_img.value, sigma=2.0)
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="get-a-list-of-all-point-sources">
           <h2>
            Get a list of all point sources
            <a class="headerlink" href="#get-a-list-of-all-point-sources" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            Note that usually it is
            <code class="docutils literal notranslate">
             <span class="pre">
              3*std
             </span>
            </code>
            to find sources above noise level, but there are 247 point sources when I do that. So I made it
            <code class="docutils literal notranslate">
             <span class="pre">
              6*std
             </span>
            </code>
            to look at 4 point sources and make sure this step works.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>daofind = DAOStarFinder(fwhm=2.0, threshold=6*std)
sources = daofind(cont_img.value - median) 
print("\n  Number of sources in field: ", len(sources))
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="extract-and-plot-spectrum-of-all-sources">
           <h2>
            Extract and plot spectrum of all sources
            <a class="headerlink" href="#extract-and-plot-spectrum-of-all-sources" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            <strong>
             This step can take while to run.
            </strong>
           </p>
           <p>
            Do a visual check to see if all point sources have been identified, although the end result should be that this is not necessary. Also as a science user, I would like the algorithm to tell me what is and isn’t a point source mathematically. There should be some criteria that differences point and extended sources that the user shouldn’t have to visually check. Of the four sources, two are noise spectra because it detected noise spikes on the border of the ALMA cube which is a common thing with ALMA data cubes.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Make table be consistent with RA and DEC coordinates
if len(sources) &gt; 0:
    for col in sources.colnames:    
        sources[col].info.format = '%.8g'

    print(sources)  
    
    # Convert xcentroid and ycentroid to RA and DEC coordiantes
    positions = Table([sources['xcentroid'], sources['ycentroid']])                
    w = WCS(cont_img.header)                                                       
    radec_lst = w.pixel_to_world(sources['xcentroid'], sources['ycentroid'])

    # Aperture extract spectrum of point source Using a cirular aperture            
    for countS, _ in enumerate(sources):
        print(radec_lst[countS].to_string('hmsdms'))  # Print the RA and Dec in hms dms values   
        
        name_val.append(name)
        source_val.append(countS)
        ra_val.append(radec_lst[countS].ra.deg)
        dec_val.append(radec_lst[countS].dec.deg)
    
        # Size of frame 
        ysize_pix = cmin.shape[1]
        xsize_pix = cmin.shape[2]

        # Set up some centroid pixel for the source 
        ycent_pix = sources['ycentroid'][countS]
        xcent_pix = sources['xcentroid'][countS]

        # Make an aperture radius for source
        # This can be something the user inputs based on their own science expertise.
        apertureRad_pix = 2

        # Make a masked array for the apeture
        yy, xx = np.indices([ysize_pix, xsize_pix], dtype='float')  # Check ycentpix, xcentpix are in correct order 
        radius = ((yy - ycent_pix)**2 + (xx - xcent_pix)**2)**0.5  # Make a circle in the frame

        mask = radius &lt;= apertureRad_pix  # Select pixels within the aperture radius
        maskedcube = cmin.with_mask(mask)  # Make a masked cube
        pixInAp = np.count_nonzero(mask == 1)  # Pixels in apeture

        spectrum = maskedcube.sum(axis=(1, 2))  # Extract the spectrum from only the annulus
        noisespectrum = maskedcube.std(axis=(1, 2))  # Extract the noise spectrum for the source 

        # Measure a spectrum from the background. Use an annulus arround the source.
        an_mask = (radius &gt; apertureRad_pix + 1) &amp; (radius &lt;= apertureRad_pix + 2)  # Select pixels within an anulus
        an_maskedcube = cmin.with_mask(an_mask)  # Make a masked cube
    
        # Plot the spectrum extracted from cirular aperture via: a sum extraction 
        
        fig = plt.figure(figsize=(10, 5))
        
        plt.plot(maskedcube.spectral_axis.value, spectrum.value, label='Source')  # Source spectrum 
        plt.xlabel('Frequency [Hz]')
        plt.ylabel('Kelvin') 
        plt.gcf().text(0.5, 0.85, name, fontsize=14, ha='center')
        plt.gcf().text(0.5, 0.80, radec_lst[countS].to_string('decimal'), ha='center', fontsize=14)
        plt.legend(frameon=False, fontsize='medium')
        plt.tight_layout()
        plt.show()
        plt.close()
        
        positions_pix = (sources['xcentroid'], sources['ycentroid'])
    
        apertures = CircularAperture([positions_pix[0][countS], positions_pix[1][countS]], r=2.)
        fig = plt.figure()            

        plt.subplot(1, 2, 1)
        plt.imshow(cont_img.value, cmap='Greys', origin='lower')
        
        apertures.plot(color='blue', lw=1.5, alpha=0.5)

        plt.subplot(1, 2, 2)
        plt.imshow(cont_img.value, origin='lower')
        plt.tight_layout()
        plt.show()
        plt.close()
    
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="make-a-table-for-the-extracted-sources">
           <h2>
            Make a Table for the Extracted Sources
            <a class="headerlink" href="#make-a-table-for-the-extracted-sources" title="Permalink to this headline">
             #
            </a>
           </h2>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>sourceExtSpecTab = Table([name_val, source_val, ra_val, dec_val], 
                         names=("name", "source_no", "ra", "dec"))
print(sourceExtSpecTab)   

os.path.join(output_spectra, 'YSOsourcesSpec_list.csv')
ascii.write(sourceExtSpecTab, os.path.join(output_spectra, 'YSOsourcesSpec_list.csv'), format='csv', overwrite=True) 
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="use-spitzer-irs-yso-spectra-from-here-on-out-for-science-test-cases">
           <h2>
            Use Spitzer IRS YSO Spectra from Here on Out For Science Test Cases
            <a class="headerlink" href="#use-spitzer-irs-yso-spectra-from-here-on-out-for-science-test-cases" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            (1) Look for lines in Spectra. Ice features in the 5-7 micron range from H20, NH3, CH3OH, HCOOH, and H2CO are difficult to identify because confusion with PAH. The 15.2 micron CO2 ice absorbtion is better to identify. More evolved YSOs will have PAH and fine-structure features at 6.2 micron, 7.7 micron, 8.6 micron, 11.3 micron, and 12.7 micron. But PAH and fine-sturcture could mean a more evolved HII region rather than an embedded YSO. H2 emission is expected from YSOs. Both PDRs and shocks lead to H2 emission near YSO environments.
           </p>
           <p>
            (2) Look at ice features, PAH feature, and silicate features in more detail.
           </p>
           <p>
            (3) Identify YSOs.
           </p>
           <p>
            User can decide which YSO they want to check. YSO1, YSO2, or YSO3 and comment out the code accordingly.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Set Path to YSO1 Data
YSO1 = 'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MIRI_IFU_YSOs_in_the_LMC/yso1_108_spec.txt'

# Set Path to YSO2 Data
# YSO2 = 'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MIRI_IFU_YSOs_in_the_LMC/yso2_102_spec.txt'

# Set Path to YSO3 Data
# YSO3 = 'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MIRI_IFU_YSOs_in_the_LMC/yso3_4536_spec.txt'
</pre>
              </div>
             </div>
            </div>
           </div>
           <p>
            Choose YSO1, YSO2, or YSO3 in this section too.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Read in the spectra and plot it for initial visualization check

data = ascii.read(YSO1)
# data = ascii.read(YSO2)
# data = ascii.read(YSO3)

if data.colnames[0] == 'col1':
    data['col1'].name = 'wave_mum'
    data['col2'].name = 'cSpec_Jy'            
    data['col3'].name = 'errFl_Jy'         

wav = data['wave_mum'] * u.micron  # Wavelength: microns
fl = data['cSpec_Jy'] * u.Jy  # Fnu: Jy
efl = data['errFl_Jy'] * u.Jy  # Error flux: Jy

spec = Spectrum1D(spectral_axis=wav, flux=fl, uncertainty=StdDevUncertainty(efl))  # Make a 1D spectrum object
fig = plt.figure(figsize=(8, 4))
plt.plot(spec.spectral_axis, spec.flux, label='spectrum')                
plt.xlabel('Wavelength (microns)')
plt.ylabel("Flux ({:latex})".format(spec.flux.unit))

plt.legend(frameon=False, fontsize='medium')
plt.tight_layout()
plt.show()
plt.close()
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="fit-a-generic-continuum">
           <h2>
            Fit a generic continuum
            <a class="headerlink" href="#fit-a-generic-continuum" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            The continuum seems to be overestimated 5 micron - 7 micron and then again 17 micron - 25 micron when fitting a generic continuum without excluding any wavelengths. This leads to misidentification of emissiona and abroption lines. Rather I fit a continuum to 5-13 micron range and another continuum for the 13-35 micron range. This gives a much better continuum subtracted spectrum. But that means that I will have to keep track of two different line lists fo absorption and emission features. It would be better if I can fit one continuum.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Calculate S/N
sig2noise = np.round(snr(spec), 2)

# Fit one continuum for wavelengths greater than 13 microns excluding a couple lines
to_exclude_1 = [(5.0, 13.0)*u.micron, (14.5, 15.5) * u.micron, (17.0, 18.0) * u.micron]  # Define lines/regions to exclude
exclude_region_1 = SpectralRegion(to_exclude_1)  # Make a specutils region

# Another continuum fit for wavelengths under 13 microns excluding the silicate absorption feature
to_exclude_2 = [(7.0, 11.0)*u.micron, (13.0, 35.0)*u.micron]
exclude_region_2 = SpectralRegion(to_exclude_2)

continuum_model_1 = fit_generic_continuum(spec, exclude_regions=exclude_region_1)  # Generate the first contimiumn
continuum_model_2 = fit_generic_continuum(spec, exclude_regions=exclude_region_2)  # Generate the second contimiumn
y_continuum_1 = continuum_model_1(spec.spectral_axis)  # Put the first continiumn into 1d spectra object
y_continuum_2 = continuum_model_2(spec.spectral_axis)  # Put the second continiumn into 1d spectra object

# Generate a continuum subtracted and continuum normalised spectra. Both needed for later analysis. 
spec_norm_2 = spec / y_continuum_2
count_axis = 0
for i in spec.spectral_axis:
    if i.value &lt; 13.0:
        count_axis = count_axis+1

# Assign to variable to make it more readable for line below
spec_contsub_1 = spec[count_axis:len(spec.spectral_axis)] - y_continuum_1[count_axis:len(spec.spectral_axis)]
spec_contsub_2 = spec[0:count_axis] - y_continuum_2[0:count_axis]
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Plot the continiumn and spectra
fig = plt.figure(figsize=(10, 6))
plt.plot(spec.spectral_axis, spec.flux, label='Source')  # Source spectrum 
plt.plot(spec.spectral_axis, y_continuum_1, label='Continuum Fit to lambda &gt; 13 microns')  # Continuum (lambda &gt; 13 microns)
plt.plot(spec.spectral_axis, y_continuum_2, label='Continuum Fit to lambda &lt; 13 microns')  # Continuum (lambda &lt; 13 microns)

plt.xlabel("Wavelength ({:latex})".format(spec.spectral_axis.unit))
plt.ylabel("Flux ({:latex})".format(spec.flux.unit))

plt.legend(frameon=False, fontsize='medium')
plt.tight_layout()
plt.show()
plt.close()
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Plot the contimum subtracted spectrum

fig = plt.figure(figsize=(10, 6))
plt.plot(spec_contsub_1.spectral_axis, spec_contsub_1.flux, color='black')
plt.plot(spec_contsub_2.spectral_axis, spec_contsub_2.flux, color='black')
plt.axhline(y=0.0, color='r', linestyle='-')

plt.xlabel("Wavelength ({:latex})".format(spec.spectral_axis.unit))
plt.ylabel("Flux ({:latex})".format(spec.flux.unit))

plt.tight_layout()
plt.show()
plt.close()
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="look-for-emission-and-absorption-lines">
           <h2>
            Look For Emission and Absorption Lines
            <a class="headerlink" href="#look-for-emission-and-absorption-lines" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            Common YSO lines include PAH emission lines, ice absorption lines, and silicate absorption lines.
           </p>
           <p>
            It would be better to have a SNR threshold instead of a flux threshold for the
            <code class="docutils literal notranslate">
             <span class="pre">
              find_lines_derivative()
             </span>
            </code>
            function.
           </p>
           <p>
            The user has to remove the comment depending on which YSO they are checking: YSO1, YSO2, or YSO3. If it was a SNR threshold instead, then it can be a bit more automated.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Find emmision and absorption lines in the continuum-subtracted spectra.
# This will print out two emission line lists and two absorption line lists.

if sig2noise &gt; 10:
    lines = find_lines_derivative(spec_contsub_1, flux_threshold=0.020)  # YSO 1
    # lines = find_lines_derivative(spec_contsub_1, flux_threshold=0.03)  # YSO 2
    # lines = find_lines_derivative(spec_contsub_1, flux_threshold=0.02)  # YSO 3
    if len(lines) &gt; 0:
        emissionlines_1 = lines[lines['line_type'] == 'emission']  # Grab a list of the emission lines
        abslines_1 = lines[lines['line_type'] == 'absorption']  # Grab a list of the absorption lines
        print("Number of emission lines found:", len(emissionlines_1))
        print("Number of absorption lines found:", len(abslines_1))
    else:
        emissionlines_1 = []
        abslines_1 = []
        print("No emission lines found!") 

    lines = find_lines_derivative(spec_contsub_2, flux_threshold=0.020)  # YSO 1
    # lines = find_lines_derivative(spec_contsub_2, flux_threshold=0.03)  # YSO 2
    # lines = find_lines_derivative(spec_contsub_2, flux_threshold=0.02)  # YSO 3
    if len(lines) &gt; 0:
        emissionlines_2 = lines[lines['line_type'] == 'emission']  # Grab a list of the emission lines
        abslines_2 = lines[lines['line_type'] == 'absorption']  # Grab a list of the absorption lines
        print("Number of emission lines found:", len(emissionlines_2))
        print("Number of absorption lines found:", len(abslines_2))
    else:
        emissionlines_2 = []
        abslines_2 = []
        print("No emission lines found!") 
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Extract emission lines greater than 13 microns

if emissionlines_1:
    emissionlines_1['gauss_line_center'] = 0. * u.micron
    emissionlines_1['gauss_line_amp'] = 0. * u.jansky
    emissionlines_1['gauss_line_stddev'] = 0. * u.micron
    emissionlines_1['gauss_line_FWHM'] = 0. * u.micron
    emissionlines_1['gauss_line_area'] = np.log10(1e-20) * u.W / u.m**2

    emissionlines_1['no_AltRestWav'] = 0  # Number of possible lines which could be the feature
    emissionlines_1['RestWav'] = 0.  # RestWavelength of closest lab measured line
    emissionlines_1['diff_ft_wav'] = 0.  # Diff. in initial line wav estimate and the fitted gausian
    emissionlines_1['line_suspect'] = 0  # Set == 1 if large diffrence in wavelength possition
    emissionlines_1['line'] = "                 "  # For storing the line name

    # Loop through all the found emission lines in the spectra
    for idx, emlines in enumerate(emissionlines_1):

        # Look at the region surrounding the found lines from the original smoothed spectrum
        sw_line = emissionlines_1["line_center"][idx].value-0.001
        lw_line = emissionlines_1["line_center"][idx].value+0.001     
        line_region = SpectralRegion(sw_line*u.um, lw_line*u.um)

        # Variable for the line center
        line_cnr = emissionlines_1["line_center"][idx]
        
print(emissionlines_1)

# Extract emission lines less than 13 microns

if emissionlines_2:
    emissionlines_2['gauss_line_center'] = 0. * u.micron
    emissionlines_2['gauss_line_amp'] = 0. * u.jansky
    emissionlines_2['gauss_line_stddev'] = 0. * u.micron
    emissionlines_2['gauss_line_FWHM'] = 0. * u.micron
    emissionlines_2['gauss_line_area'] = np.log10(1e-20) * u.W / u.m**2

    emissionlines_2['no_AltRestWav'] = 0  # Number of possible lines which could be the feature
    emissionlines_2['RestWav'] = 0.  # RestWavelength of closest lab measured line
    emissionlines_2['diff_ft_wav'] = 0.  # Diff. in initial line wav estimate and the fitted gausian
    emissionlines_2['line_suspect'] = 0  # Set == 1 if large diffrence in wavelength possition
    emissionlines_2['line'] = "                 "  # For storing the line name
    
    # Loop through all the found emission lines in the spectra

    for idx, emlines2 in enumerate(emissionlines_2):

        # Look at the region surrounding the found lines from the original smoothed spectrum
        sw_line = emissionlines_2["line_center"][idx].value-0.01
        lw_line = emissionlines_2["line_center"][idx].value+0.01     
        line_region = SpectralRegion(sw_line*u.um, lw_line*u.um)

        # Variable for the line center
        line_cnr = emissionlines_2["line_center"][idx]     
         
print(emissionlines_2)
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Extract absorption lines greater than 13 microns

if abslines_1:
    abslines_1['gauss_line_center'] = 0. * u.micron
    abslines_1['gauss_line_amp'] = 0. * u.jansky
    abslines_1['gauss_line_stddev'] = 0. * u.micron
    abslines_1['gauss_line_FWHM'] = 0. * u.micron
    abslines_1['gauss_line_area'] = np.log10(1e-20) * u.W / u.m**2

    abslines_1['no_AltRestWav'] = 0  # Number of possible lines which could be the feature
    abslines_1['RestWav'] = 0.  # RestWavelength of closest lab measured line
    abslines_1['diff_ft_wav'] = 0.  # Diff. in initial line wav estimate and the fitted gausian
    abslines_1['line_suspect'] = 0  # Set == 1 if large diffrence in wavelength possition
    abslines_1['line'] = "                 "  # For storing the line name

    # Loop through all the found absorption lines in the spectra

    for idx, absorplines in enumerate(abslines_1):

        # Look at the region surrounding the found lines from the original smoothed spectrum
        sw_line = abslines_1["line_center"][idx].value-0.01
        lw_line = abslines_1["line_center"][idx].value+0.01     
        line_region = SpectralRegion(sw_line*u.um, lw_line*u.um)

        # Variable for the line center
        line_cnr_abs = abslines_1["line_center"][idx]
        
print(abslines_1)

# Extract absorption lines less than 13 microns

if abslines_2:
    abslines_2['gauss_line_center'] = 0. * u.micron
    abslines_2['gauss_line_amp'] = 0. * u.jansky
    abslines_2['gauss_line_stddev'] = 0. * u.micron
    abslines_2['gauss_line_FWHM'] = 0. * u.micron
    abslines_2['gauss_line_area'] = np.log10(1e-20) * u.W / u.m**2

    abslines_2['no_AltRestWav'] = 0  # Number of possible lines which could be the feature
    abslines_2['RestWav'] = 0.  # RestWavelength of closest lab measured line
    abslines_2['diff_ft_wav'] = 0.  # Diff. in initial line wav estimate and the fitted gausian
    abslines_2['line_suspect'] = 0  # Set == 1 if large diffrence in wavelength possition
    abslines_2['line'] = "                 "  # For storing the line name
    
    # Loop through all the found absorption lines in the spectra

    for idx, absorplines2 in enumerate(abslines_2):

        # Look at the region surrounding the found lines from the original smoothed spectrum
        sw_line = abslines_2["line_center"][idx].value - 0.01
        lw_line = abslines_2["line_center"][idx].value + 0.01     
        line_region = SpectralRegion(sw_line*u.um, lw_line*u.um)

        # Variable for the line center
        line_cnr_abs = abslines_2["line_center"][idx]

print(abslines_2)
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="identify-emission-and-absorption-lines">
           <h2>
            Identify emission and absorption lines
            <a class="headerlink" href="#identify-emission-and-absorption-lines" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            PAH emission feature: 6.2 micron, 7.7 micron, 8.6 micron, 11.3 micron, 12.0 micron, 12.7 micron, 14.2 micron, 16.2 micron
           </p>
           <p>
            Silicate absoprtion feature: 10.0 micron, 18.0 micron, 23.0 micron
           </p>
           <p>
            CO2 ice absorption feature: 15.2 micron
           </p>
           <p>
            Other ice features: CO (4.67 micron), H2O + HCOOH (6 micron),  CH3OH (6.89 micron), CH4 (7.7 micron)
           </p>
           <p>
            If none of these 8 emission lines and 8 absorption lines exist, then this is not a YSO
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># First Look for pah emission features

pah_emission = [6.2, 7.7, 8.6, 11.3, 12.0, 12.7, 14.2, 16.2] * u.micron  # list or known YSO pah emission lines
len_pah_list = len(pah_emission)

pah_emission_detected = []  # empty list to store detected lines
line_cnr_list_1 = emissionlines_1["line_center"]  # list of emission lines extracted from first spectrum
len_line_list = len(line_cnr_list_1)
line_cnr_list_2 = emissionlines_2["line_center"]  # list of emission lines extracted from second spectrum
len_line_list2 = len(line_cnr_list_2)

count_pah1 = 0  # counting how many pah emission lines exist in first spectrum
for i in range(0, len_pah_list):
    for j in range(0, len_line_list):
        if line_cnr_list_1[j].value - 0.15 &lt; pah_emission.value[i] &lt; line_cnr_list_1[j].value + 0.15:
            count_pah1 += 1
count_pah2 = 0  # counting how many pah emission lines exist in second spectrum
for i in range(0, len_pah_list):
    for j in range(0, len_line_list2):
        if line_cnr_list_2[j].value - 0.15 &lt; pah_emission.value[i] &lt; line_cnr_list_2[j].value + 0.15:
            count_pah2 += 1

pah_emission_detected = []  # empty list to store detected lines
count_pah = 0  # restart count
for i in range(0, len_pah_list):
    for j in range(0, len_line_list):
        if line_cnr_list_1[j].value - 0.15 &lt; pah_emission.value[i] &lt; line_cnr_list_1[j].value + 0.15:
            pah_emission_detected.append(line_cnr_list_1[j])
            count_pah += 1
    for j in range(0, len_line_list2):
        if line_cnr_list_2[j].value - 0.15 &lt; pah_emission.value[i] &lt; line_cnr_list_2[j].value + 0.15:
            pah_emission_detected.append(line_cnr_list_2[j])
            count_pah += 1

print(f"{count_pah} PAH emission lines detected in spectrum")
if count_pah &gt; 0:
    print(pah_emission_detected)
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Look for Silicate absorption features

sil_absorption = [10.0, 18.0, 23.0] * u.micron  # list or known YSO silicate absorption lines
len_sil_list = len(sil_absorption)

sil_absorption_detected = []  # empty array to store detected lines
line_cnr_list_1 = abslines_1["line_center"]  # list of absorption lines extracted from first spectrum
len_line_list = len(line_cnr_list_1)
line_cnr_list_2 = abslines_2["line_center"]  # list of absorption lines extracted from second spectrum
len_line_list2 = len(line_cnr_list_2)

count_sil1 = 0  # counting how many silicate absorption lines exist in first spectrum
for i in range(0, len_sil_list):
    for j in range(0, len_line_list):
        if line_cnr_list_1[j].value - 0.3 &lt; sil_absorption.value[i] &lt; line_cnr_list_1[j].value + 0.3:  # absorption features are wider than emission features therefore +/-0.2
            count_sil1 += 1
count_sil2 = 0  # counting how many silicate absorption lines exist in second spectrum
for i in range(0, len_sil_list):
    for j in range(0, len_line_list2):
        if line_cnr_list_2[j].value - 0.3 &lt; sil_absorption.value[i] &lt; line_cnr_list_2[j].value + 0.3:  # absorption features are wider than emission features therefore +/-0.2
            count_sil2 += 1
            
sil_absorption_detected = []  # empty array to store detected lines
count_sil = 0  # restart count
for i in range(0, len_sil_list):
    for j in range(0, len_line_list):
        if line_cnr_list_1[j].value - 0.3 &lt; sil_absorption.value[i] &lt; line_cnr_list_1[j].value + 0.3:
            sil_absorption_detected.append(sil_absorption[i])
            count_sil += 1
    for j in range(0, len_line_list2):
        if line_cnr_list_2[j].value - 0.3 &lt; sil_absorption.value[i] &lt; line_cnr_list_2[j].value + 0.3:
            sil_absorption_detected.append(sil_absorption[i])
            count_sil += 1
            
# Remove multiple detections of same line
drop_dups_sil = list(set(sil_absorption_detected))
print(f"{len(drop_dups_sil)} silicate absorption lines detected in spectrum")
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Look for ice absorption features

ice_absorption = [4.67, 6.0, 6.9, 7.7, 15.2] * u.micron  # list or known YSO ice absorption lines
len_ice_list = len(ice_absorption)

ice_absorption_detected = []  # empty array to store detected lines
line_cnr_list_1 = abslines_1["line_center"]  # list of absorption lines extracted from first spectrum
len_line_list = len(line_cnr_list_1)
line_cnr_list_2 = abslines_2["line_center"]  # list of absorption lines extracted from second spectrum
len_line_list2 = len(line_cnr_list_2)

count_ice1 = 0  # counting how many ice absorption lines exist in first spectrum
for i in range(0, len_ice_list):
    for j in range(0, len_line_list):
        if line_cnr_list_1[j].value - 0.2 &lt; ice_absorption.value[i] &lt; line_cnr_list_1[j].value + 0.2:   
            count_ice1 += 1
count_ice2 = 0  # counting how many ice absorption lines exist in second spectrum
for i in range(0, len_ice_list):
    for j in range(0, len_line_list2):
        if line_cnr_list_2[j].value - 0.2 &lt; ice_absorption.value[i] &lt; line_cnr_list_2[j].value + 0.2: 
            count_ice2 += 1
            
ice_absorption_detected = []  # empty array to store detected lines
count_ice = 0  # restart count
for i in range(0, len_ice_list):
    for j in range(0, len_line_list):
        if line_cnr_list_1[j].value - 0.2 &lt; ice_absorption.value[i] &lt; line_cnr_list_1[j].value + 0.2:
            ice_absorption_detected.append(ice_absorption[i])
            count_ice += 1
    for j in range(0, len_line_list2):
        if line_cnr_list_2[j].value - 0.2 &lt; ice_absorption.value[i] &lt; line_cnr_list_2[j].value + 0.2:
            ice_absorption_detected.append(ice_absorption[i])
            count_ice += 1
             
# Remove multiple detections of same line
drop_dups_ice = list(set(ice_absorption_detected))
print(f"{len(drop_dups_ice)} ice absorption lines detected in spectrum")
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="classify-the-yso-according-to-what-lines-are-detected">
           <h2>
            Classify the YSO according to what lines are detected
            <a class="headerlink" href="#classify-the-yso-according-to-what-lines-are-detected" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            If more than one classification pops up, then the user needs to take a closer look and the YSO can be inbetween. For example if you get “This is a Class 2 YSO” and “This is a class 3 YSO”, then the protostar can be inbetween these two phases in its evolution and be a Class 2/3 YSO.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># If no PAH, silicate, and ice lines found then print this is not a YSO
if not pah_emission_detected and not sil_absorption_detected and not ice_absorption_detected:
    print("This is not a YSO.")
    
else:
    # Else find out if YSO 1 (youngest, most embedded YSO with CO2 absorption feature at 15.2 microns)
    if drop_dups_ice and not drop_dups_sil:
        for i in range(0, count_ice):
            if ice_absorption_detected[i].value &lt; 15.4 and ice_absorption_detected[i].value &gt; 15.0:
                    print("This is a Class 1 YSO.")
                    
    # Else find out if YSO 2 (more evolved YSO with other ice absoprtion and silicate absorption features)
    if drop_dups_sil:
        print("This is a Class 2 YSO.")  
    elif count_pah == 0 and drop_dups_ice:
        for i in range(0, count_ice):
            if ((ice_absorption_detected[i].value &lt; 4.87 and ice_absorption_detected[i].value &gt; 4.47)
                or (ice_absorption_detected[i].value &lt; 5.8 and ice_absorption_detected[i].value &gt; 6.2)
                or (ice_absorption_detected[i].value &lt; 6.69 and ice_absorption_detected[i].value &gt; 7.09)
                or (ice_absorption_detected[i].value &lt; 7.5 and ice_absorption_detected[i].value &gt; 7.7)):
                print("This is a Class 2 YSO.")
                
    # Else if PAH emission features then YSO 3
    if ((count_pah &gt; 0 and not drop_dups_ice)
        or (count_pah &gt; 0 and drop_dups_sil)):
        print("This is a Class 3 YSO.")
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="plot-the-spectra-and-label-the-emission-and-absorption-features">
           <h2>
            Plot the spectra and label the emission and absorption features
            <a class="headerlink" href="#plot-the-spectra-and-label-the-emission-and-absorption-features" title="Permalink to this headline">
             #
            </a>
           </h2>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>fig = plt.figure(figsize=(10, 6))
plt.plot(spec_contsub_1.spectral_axis, spec_contsub_1.flux, color='black')
plt.plot(spec_contsub_2.spectral_axis, spec_contsub_2.flux, color='black')

plt.xlabel("Wavelength ({:latex})".format(spec.spectral_axis.unit))
plt.ylabel("Flux ({:latex})".format(spec.flux.unit))
plt.axhline(y=0.0, color='r', linestyle='-')

max_emission_plot_y = np.max(spec_contsub_2.flux.value) * 4

if len(pah_emission_detected) &gt; 0:
    pah_vals = [v.value for v in pah_emission_detected]
    plt.vlines(pah_vals, -max_emission_plot_y, max_emission_plot_y,
               color='r', ls='--', label='PAH emission')
    print("PAH emission lines detected: ", pah_emission_detected)

if len(sil_absorption_detected) &gt; 0:
    sil_vals = [v.value for v in sil_absorption_detected]
    plt.vlines(sil_vals, -max_emission_plot_y, max_emission_plot_y,
               color='b', ls='--', label='silicate absorption')
    print("silicate absorption lines detected: ", sil_absorption_detected)
    
if len(ice_absorption_detected) &gt; 0:
    ice_vals = [v.value for v in ice_absorption_detected]
    plt.vlines(ice_vals, -max_emission_plot_y, max_emission_plot_y,
               color='g', ls='--', label='ice absorption')
    print("ice absorption lines detected: ", ice_absorption_detected)

plt.xlim(5, 35)
plt.legend(frameon=False, fontsize='medium')
plt.tight_layout()
plt.show()
plt.close()
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
         </section>
         <script type="text/x-thebe-config">
          {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/jdat_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/MIRI_IFU_YSOs_in_the_LMC"
        },
        predefinedOutput: true
    }
         </script>
         <script>
          kernelName = 'python3'
         </script>
        </div>
       </main>
       <footer class="footer-article noprint">
        <!-- Previous / next buttons -->
        <div class="prev-next-area">
         <a class="left-prev" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html" id="prev-link" title="previous page">
          <i class="fas fa-angle-left">
          </i>
          <div class="prev-next-info">
           <p class="prev-next-subtitle">
            previous
           </p>
           <p class="prev-next-title">
            MRS Cube Analysis
           </p>
          </div>
         </a>
         <a class="right-next" href="../MIRI_LRS_spectral_extraction/miri_lrs_spectral_extraction.html" id="next-link" title="next page">
          <div class="prev-next-info">
           <p class="prev-next-subtitle">
            next
           </p>
           <p class="prev-next-title">
            LRS Optimal Spectral Extraction
           </p>
          </div>
          <i class="fas fa-angle-right">
          </i>
         </a>
        </div>
       </footer>
      </div>
     </div>
     <div class="footer-content row">
      <footer class="col footer">
       <p>
        By STScI
        <br/>
        © Copyright 2022.
        <br/>
       </p>
      </footer>
     </div>
    </div>
   </div>
  </div>
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  </script>
 </body>
</html>