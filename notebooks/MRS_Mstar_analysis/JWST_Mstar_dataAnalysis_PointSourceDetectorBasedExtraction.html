<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
  <title>
   MRS Detector Based Extraction — STScI JDAT Notebooks
  </title>
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
  <link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
  <link href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
  <link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" rel="stylesheet" type="text/css"/>
  <link href="../../_static/togglebutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/copybutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/mystnb.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/sphinx-thebe.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/main.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" rel="stylesheet" type="text/css"/>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
  <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js">
  </script>
  <script src="../../_static/jquery.js">
  </script>
  <script src="../../_static/underscore.js">
  </script>
  <script src="../../_static/doctools.js">
  </script>
  <script src="../../_static/clipboard.min.js">
  </script>
  <script src="../../_static/copybutton.js">
  </script>
  <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411">
  </script>
  <script>
   let toggleHintShow = 'Click to show';
  </script>
  <script>
   let toggleHintHide = 'Click to hide';
  </script>
  <script>
   let toggleOpenOnPrint = 'true';
  </script>
  <script src="../../_static/togglebutton.js">
  </script>
  <script>
   var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';
  </script>
  <script src="../../_static/design-tabs.js">
  </script>
  <script>
   const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
  </script>
  <script async="async" src="../../_static/sphinx-thebe.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js">
  </script>
  <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js">
  </script>
  <script>
   window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}
  </script>
  <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <link href="../../genindex.html" rel="index" title="Index"/>
  <link href="../../search.html" rel="search" title="Search"/>
  <link href="JWST_Mstar_dataAnalysis_analysis.html" rel="next" title="MRS Cube Analysis"/>
  <link href="JWST_Mstar_dataAnalysis_runpipeline.html" rel="prev" title="MRS Pipeline"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <meta content="None" name="docsearch:language"/>
  <!-- Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3">
  </script>
  <script>
   window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-D46G4HKJY3');
  </script>
 </head>
 <body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
  <!-- Checkboxes to toggle the left sidebar -->
  <input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
  <label class="overlay overlay-navbar" for="__navigation">
   <div class="visually-hidden">
    Toggle navigation sidebar
   </div>
  </label>
  <!-- Checkboxes to toggle the in-page toc -->
  <input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
  <label class="overlay overlay-pagetoc" for="__page-toc">
   <div class="visually-hidden">
    Toggle in-page Table of Contents
   </div>
  </label>
  <!-- Headers at the top -->
  <div class="announcement header-item noprint">
  </div>
  <div class="header header-item noprint">
  </div>
  <div class="container-fluid" id="banner">
  </div>
  <div class="container-xl">
   <div class="row">
    <!-- Sidebar -->
    <div class="bd-sidebar noprint" id="site-navigation">
     <div class="bd-sidebar__content">
      <div class="bd-sidebar__top">
       <div class="navbar-brand-box">
        <a class="navbar-brand text-wrap" href="../../index.html">
         <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
         <img alt="logo" class="logo" src="../../_static/stsci_logo2.png"/>
         <h1 class="site-logo" id="site-title">
          STScI JDAT Notebooks
         </h1>
        </a>
       </div>
       <form action="../../search.html" class="bd-search d-flex align-items-center" method="get">
        <i class="icon fas fa-search">
        </i>
        <input aria-label="Search this book..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." type="search"/>
       </form>
       <nav aria-label="Main" class="bd-links" id="bd-docs-nav">
        <div class="bd-toc-item active">
         <ul class="nav bd-sidenav bd-sidenav__home-link">
          <li class="toctree-l1">
           <a class="reference internal" href="../../intro.html">
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           General
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../../index.html">
            Home
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../../install.html">
            Installation
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           Cross-Instrument
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../asdf_example/asdf_example.html">
            ASDF Example
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../background_estimation_imaging/Imaging_Sky_Background_Estimation.html">
            Complex 2D Background
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../composite_model_fitting/specfit_demo_3.html">
            Composite Model Spectral Fitting
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">
            MAST Query
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">
            Specviz Simple Demo
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../cube_fitting/cube_fitting.html">
            IFU Cube Line Maps
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           MIRI
          </span>
         </p>
         <ul class="current nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="JWST_Mstar_dataAnalysis_runpipeline.html">
            MRS Mstar - Run Pipeline
           </a>
          </li>
          <li class="toctree-l1 current active">
           <a class="current reference internal" href="#">
            MRS Detector Based Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="JWST_Mstar_dataAnalysis_analysis.html">
            MRS Mstar - Data Analysis
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">
            IFU of YSOs in LMC
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_spectral_extraction.html">
            LRS Optimal Spectral Extraction
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           NIRCam
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../aperture_photometry/NIRCam_Aperture_Photometry_Example.html">
            Point Source Aperture Photometry
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRCam_photometry/NIRCam_multiband_photometry.html">
            Extended Aperture Photometry
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">
            Cross-Filter PSF Matching
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../psf_photometry/NIRCam_PSF_Photometry_Example.html">
            PSF Photometry
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           NIRISS
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRISS_WFSS_postpipeline/00_Optimal_extraction.html">
            WFSS Spectra - Optimal Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRISS_WFSS_postpipeline/01_Combine_and_normalize_1D_spectra.html">
            WFSS Spectra - Combine and Normalize 1D Spectra
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRISS_WFSS_postpipeline/02_Cross_correlation_template.html">
            WFSS Spectra - Cross-Correlation Template
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.html">
            WFSS Spectra - Emission Line Map
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           NIRSpec
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">
            IFU Cube Fitting
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../ifu_optimal/ifu_optimal.html">
            IFU Optimal Spectral Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../optimal_extraction/Spectral_Extraction-static.html">
            MOS Optimal Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../mos-spectroscopy/MOSspec_sv06_revised.html">
            MOS Spectroscopy of Extragalactic Field
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">
            BOTS Time Series Observations
           </a>
          </li>
         </ul>
        </div>
       </nav>
      </div>
      <div class="bd-sidebar__bottom">
       <!-- To handle the deprecated key -->
       <div class="navbar_extra_footer">
        Powered by
        <a href="https://jupyterbook.org">
         Jupyter Book
        </a>
       </div>
      </div>
     </div>
     <div id="rtd-footer-container">
     </div>
    </div>
    <!-- A tiny helper pixel to detect if we've scrolled -->
    <div class="sbt-scroll-pixel-helper">
    </div>
    <!-- Main content -->
    <div class="col py-0 content-container">
     <div class="header-article row sticky-top noprint">
      <div class="col py-1 d-flex header-article-main">
       <div class="header-article__left">
        <label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
         <span class="headerbtn__icon-container">
          <i class="fas fa-bars">
          </i>
         </span>
        </label>
       </div>
       <div class="header-article__right">
        <div class="menu-dropdown menu-dropdown-launch-buttons">
         <button aria-label="Launch interactive content" class="headerbtn menu-dropdown__trigger">
          <i class="fas fa-rocket">
          </i>
         </button>
         <div class="menu-dropdown__content">
          <ul>
           <li>
            <button class="headerbtn headerbtn-launch-thebe" data-placement="left" data-toggle="tooltip" onclick="initThebeSBT()" title="Launch Thebe">
             <span class="headerbtn__icon-container">
              <i class="fas fa-play">
              </i>
             </span>
             <span class="headerbtn__text-container">
              Live Code
             </span>
            </button>
           </li>
          </ul>
         </div>
        </div>
        <button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
         <span class="headerbtn__icon-container">
          <i class="fas fa-expand">
          </i>
         </span>
        </button>
        <div class="menu-dropdown menu-dropdown-repository-buttons">
         <button aria-label="Source repositories" class="headerbtn menu-dropdown__trigger">
          <i class="fab fa-github">
          </i>
         </button>
         <div class="menu-dropdown__content">
          <ul>
           <li>
            <a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/spacetelescope/jdat_notebooks/" title="Source repository">
             <span class="headerbtn__icon-container">
              <i class="fab fa-github">
              </i>
             </span>
             <span class="headerbtn__text-container">
              repository
             </span>
            </a>
           </li>
           <li>
            <a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/spacetelescope/jdat_notebooks//issues/new?title=Issue%20on%20page%20%2Fnotebooks/MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_PointSourceDetectorBasedExtraction.html&amp;body=Your%20issue%20content%20here." title="Open an issue">
             <span class="headerbtn__icon-container">
              <i class="fas fa-lightbulb">
              </i>
             </span>
             <span class="headerbtn__text-container">
              open issue
             </span>
            </a>
           </li>
          </ul>
         </div>
        </div>
        <div class="menu-dropdown menu-dropdown-download-buttons">
         <button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
          <i class="fas fa-download">
          </i>
         </button>
         <div class="menu-dropdown__content">
          <ul>
           <li>
            <a class="headerbtn" data-placement="left" data-toggle="tooltip" href="../../_sources/notebooks/MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_PointSourceDetectorBasedExtraction.ipynb" title="Download source file">
             <span class="headerbtn__icon-container">
              <i class="fas fa-file">
              </i>
             </span>
             <span class="headerbtn__text-container">
              .ipynb
             </span>
            </a>
           </li>
           <li>
            <button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
             <span class="headerbtn__icon-container">
              <i class="fas fa-file-pdf">
              </i>
             </span>
             <span class="headerbtn__text-container">
              .pdf
             </span>
            </button>
           </li>
          </ul>
         </div>
        </div>
        <label class="headerbtn headerbtn-page-toc" for="__page-toc">
         <span class="headerbtn__icon-container">
          <i class="fas fa-list">
          </i>
         </span>
        </label>
       </div>
      </div>
      <!-- Table of contents -->
      <div class="col-md-3 bd-toc show noprint">
       <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list">
        </i>
        Contents
       </div>
       <nav aria-label="Page" id="bd-toc-nav">
        <ul class="visible nav section-nav flex-column">
         <li class="toc-h1 nav-item toc-entry">
          <a class="reference internal nav-link" href="#">
           MRS Detector Based Extraction
          </a>
          <ul class="visible nav section-nav flex-column">
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#introduction">
             Introduction
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#motivation-to-the-detector-based-extraction-technique">
             Motivation to the Detector Based Extraction Technique
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#implementation-of-the-algorithm">
             Implementation of the Algorithm
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#import-packages">
             Import Packages
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#set-paths-to-the-data-and-outputs">
             Set paths to the Data and Outputs
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#run-pipeline">
             Run Pipeline
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#now-to-detect-the-point-source-in-the-detector-image-plane-and-extract-and-plot-the-spectra-for-each-source">
             Now to detect the point source in the detector image plane and extract and plot the spectra for each source
            </a>
           </li>
          </ul>
         </li>
         <li class="toc-h1 nav-item toc-entry">
          <a class="reference internal nav-link" href="#determine-transmission-factor-corresponding-to-source-across-slice-position-beta-the-signal-should-be-multiplied-by-this-factor">
           Determine transmission factor corresponding to source across-slice position
           <span class="math notranslate nohighlight">
            \(\beta\)
           </span>
           , the signal should be multiplied by this factor
          </a>
         </li>
         <li class="toc-h1 nav-item toc-entry">
          <a class="reference internal nav-link" href="#determine-wavelength-correction-due-to-source-across-slice-position-beta">
           Determine wavelength correction due to source across-slice position
           <span class="math notranslate nohighlight">
            \(\beta\)
           </span>
          </a>
         </li>
         <li class="toc-h1 nav-item toc-entry">
          <a class="reference internal nav-link" href="#load-mrs-psf-model-in-the-3d-spectral-cube-and-project-it-on-the-2d-detector">
           Load MRS PSF model in the 3D spectral cube and project it on the 2D detector
          </a>
          <ul class="visible nav section-nav flex-column">
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#correct-for-spectral-leak-if-mrs-band-is-set-to-3a">
             Correct for spectral leak if MRS band is set to 3A
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#caution-in-order-for-the-following-cell-to-work-the-user-must-have-run-this-notebook-already-once-for-band-1b">
             CAUTION: In order for the following cell to work, the user must have run this notebook already once for band 1B.
            </a>
           </li>
          </ul>
         </li>
         <li class="toc-h1 nav-item toc-entry">
          <a class="reference internal nav-link" href="#the-end">
           THE END
          </a>
          <ul class="visible nav section-nav flex-column">
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#still-to-do">
             Still to do:
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#about-this-notebook">
             About this notebook
            </a>
           </li>
          </ul>
         </li>
        </ul>
       </nav>
      </div>
     </div>
     <div class="article row">
      <div class="col pl-md-3 pl-lg-5 content-container">
       <!-- Table of contents that is only displayed when printing the page -->
       <div class="onlyprint" id="jb-print-docs-body">
        <h1>
         MRS Detector Based Extraction
        </h1>
        <!-- Table of contents -->
        <div id="print-main-content">
         <div id="jb-print-toc">
          <div>
           <h2>
            Contents
           </h2>
          </div>
          <nav aria-label="Page">
           <ul class="visible nav section-nav flex-column">
            <li class="toc-h1 nav-item toc-entry">
             <a class="reference internal nav-link" href="#">
              MRS Detector Based Extraction
             </a>
             <ul class="visible nav section-nav flex-column">
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#introduction">
                Introduction
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#motivation-to-the-detector-based-extraction-technique">
                Motivation to the Detector Based Extraction Technique
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#implementation-of-the-algorithm">
                Implementation of the Algorithm
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#import-packages">
                Import Packages
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#set-paths-to-the-data-and-outputs">
                Set paths to the Data and Outputs
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#run-pipeline">
                Run Pipeline
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#now-to-detect-the-point-source-in-the-detector-image-plane-and-extract-and-plot-the-spectra-for-each-source">
                Now to detect the point source in the detector image plane and extract and plot the spectra for each source
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h1 nav-item toc-entry">
             <a class="reference internal nav-link" href="#determine-transmission-factor-corresponding-to-source-across-slice-position-beta-the-signal-should-be-multiplied-by-this-factor">
              Determine transmission factor corresponding to source across-slice position
              <span class="math notranslate nohighlight">
               \(\beta\)
              </span>
              , the signal should be multiplied by this factor
             </a>
            </li>
            <li class="toc-h1 nav-item toc-entry">
             <a class="reference internal nav-link" href="#determine-wavelength-correction-due-to-source-across-slice-position-beta">
              Determine wavelength correction due to source across-slice position
              <span class="math notranslate nohighlight">
               \(\beta\)
              </span>
             </a>
            </li>
            <li class="toc-h1 nav-item toc-entry">
             <a class="reference internal nav-link" href="#load-mrs-psf-model-in-the-3d-spectral-cube-and-project-it-on-the-2d-detector">
              Load MRS PSF model in the 3D spectral cube and project it on the 2D detector
             </a>
             <ul class="visible nav section-nav flex-column">
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#correct-for-spectral-leak-if-mrs-band-is-set-to-3a">
                Correct for spectral leak if MRS band is set to 3A
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#caution-in-order-for-the-following-cell-to-work-the-user-must-have-run-this-notebook-already-once-for-band-1b">
                CAUTION: In order for the following cell to work, the user must have run this notebook already once for band 1B.
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h1 nav-item toc-entry">
             <a class="reference internal nav-link" href="#the-end">
              THE END
             </a>
             <ul class="visible nav section-nav flex-column">
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#still-to-do">
                Still to do:
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#about-this-notebook">
                About this notebook
               </a>
              </li>
             </ul>
            </li>
           </ul>
          </nav>
         </div>
        </div>
       </div>
       <main id="main-content" role="main">
        <div>
         <section class="tex2jax_ignore mathjax_ignore" id="mrs-detector-based-extraction">
          <h1>
           MRS Detector Based Extraction
           <a class="headerlink" href="#mrs-detector-based-extraction" title="Permalink to this headline">
            #
           </a>
          </h1>
          <p>
           <strong>
            Use case:
           </strong>
           This notebook illustrates a spectral extraction technique from detector image plane using a PSF model and the pixel variance. This extraction is considered more advanced than what is currently implemented in the JWST pipeline and is expected to be fully integrated into the pipeline in the future.
           <br/>
           <strong>
            Data:
           </strong>
           Simulated
           <a class="reference external" href="https://jwst-docs.stsci.edu/mid-infrared-instrument/miri-observing-modes/miri-medium-resolution-spectroscopy">
            MIRI MRS
           </a>
           spectrum of AGB star.
           <br/>
           <strong>
            Tools:
           </strong>
           jwst, astropy, numpy, scipy.
           <br/>
           <strong>
            Cross-intrument:
           </strong>
           No.
           <br/>
           <strong>
            Documentation:
           </strong>
           This notebook is part of a STScI’s larger
           <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-post-pipeline-data-analysis">
            post-pipeline Data Analysis Tools Ecosystem
           </a>
           and can be
           <a class="reference external" href="https://github.com/spacetelescope/dat_pyinthesky/tree/main/jdat_notebooks/MRS_Mstar_analysis">
            downloaded
           </a>
           directly from the
           <a class="reference external" href="https://github.com/spacetelescope/jdat_notebooks">
            JDAT Notebook Github directory
           </a>
           .
           <br/>
           <strong>
            Source of Simulations:
           </strong>
           <a class="reference external" href="https://www.stsci.edu/jwst/science-planning/proposal-planning-toolbox/mirisim">
            MIRISim
           </a>
           <br/>
           <strong>
            Pipeline Version:
           </strong>
           <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-data-reduction-pipeline">
            JWST Pipeline
           </a>
           <br/>
          </p>
          <p>
           <strong>
            Note
           </strong>
           : This notebook includes MIRI simulated data cubes obtained using MIRISim (
           <a class="reference external" href="https://wiki.miricle.org//bin/view/Public/MIRISim_Public">
            https://wiki.miricle.org//bin/view/Public/MIRISim_Public
           </a>
           ) and run through the JWST pipeline (
           <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/">
            https://jwst-pipeline.readthedocs.io/en/latest/
           </a>
           ) of point sources with spectra representative of late M type stars.
          </p>
          <section id="introduction">
           <h2>
            Introduction
            <a class="headerlink" href="#introduction" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            This notebook analyzes one star represented by a dusty SED corresponding to the ISO SWS spectrum of W Per from Kraemer et al. (2002) and Sloan et al. (2003) to cover the MRS spectral range 5-28 microns.  Analysis of JWST spectral cubes requires extracting spatial-spectral features of interest and measuring their attributes.
           </p>
           <p>
            This is the first notebook, which will process the data and automatically detect and extract spectra for the point source.  The workflow automatically detects sources on the detector image plane to extract the spectrum of the point source. Then it will read in the spectra generated at Stage 3 of the JWST pipeline.
           </p>
          </section>
          <section id="motivation-to-the-detector-based-extraction-technique">
           <h2>
            Motivation to the Detector Based Extraction Technique
            <a class="headerlink" href="#motivation-to-the-detector-based-extraction-technique" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            At present, one-dimensional spectra produced by the JWST pipeline are
constructed exclusively from the combined and rectified 3-dimensional
data cubes.  These data cubes are treated as a collection of images at
various wavelength planes, and simple aperture-based (or effective
PSF-weighted) techniques are used to recover the source intensity as a
function of wavelength in a manner akin to standard imaging PSF
photometry.  However, this method of extracting point source spectra
from data cubes is not ideal; fundamentally, a source with no spatial
structure should not undergo spatial reprocessing prior to extraction of
spectral information.  Indeed, large-scale IFU surveys targeting point
sources rather than extended sources (e.g., SDSS IV/MaStar, R. Yan et
al. 2019) have relied on detector-based spectral extraction rather than
the construction of 3d data cubes.
           </p>
           <p>
            For the MIRI MRS in particular, such detector-based extraction offers
the opportunity to correct for the following effects which would be
difficult or impossible to handle once the observational data has been
rectified into 3-dimensional cubes:
           </p>
           <ol class="simple">
            <li>
             <p>
              Given the significant undersampling of the MRS, offsets in spaxel
sampling locations as a function of wavelength can alias spatial
structure from the point spread function into spectral artifacts that
bias extracted 1D spectra.  3D cube building is designed in a manner to
mitigate these artifacts, but the act of resampling ensures that 1D
spectra of unresolved sources extracted from 3D cubes can never be as
reliable as 1D spectra extracted directly from detector-level data
without the intermediate resampling step.
             </p>
            </li>
            <li>
             <p>
              Resampled pixels in the data cubes have significant covariance with
adjacent/nearby pixels.  Treating this covariance properly in the
construction of extracted 1D spectra with flux and variance information
is challenging, and not handled at present by the cube-based spectral
extraction.
             </p>
            </li>
            <li>
             <p>
              Pipeline calibrations of the instrument throughput and wavelength
calibration are based on sources that fill a given IFU slice, whereas
point sources produce a non-uniform response depending upon the location
of the source centroid within a given IFU slice.  For instance, given
the degeneracy on the detector between the spatial across-slice and
spectral dispersion directions, the wavelength solution for point
sources will differ slightly than for extended sources in a manner that
depends on the source location within the slice.  This effect cannot be
recovered once a 3D cube has been constructed that combines data from
many slices (and indeed, multiple dithered exposures).
             </p>
            </li>
            <li>
             <p>
              The MRS has a spectral leak in which 2nd order light from 6 microns
(Ch1B) is visible at a few percent transmission in the 12 micron
observations (Ch3A).  This effect is not possible to correct in general,
since the Ch3A field of view is larger than that of Ch1B.  However, for
the specific case of a point source within the common field of view of
all channels it is possible to use the Ch1B spectrum to predict and
subtract the second-order signal from the Ch3A data.
             </p>
            </li>
           </ol>
          </section>
          <section id="implementation-of-the-algorithm">
           <h2>
            Implementation of the Algorithm
            <a class="headerlink" href="#implementation-of-the-algorithm" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            In this notebook, we implement a method for achieving MIRI MRS
detector-based point source extraction. The formalism behind the method
follows the optimal spectral extraction formalism by Keith Horne 1986.
Extracting a 1d integrated spectrum directly from the MRS detectors
depends on (a) a detailed knowledge of the detector PSF, and (b) the
pixel variance. The MRS detector PSF differs considerably from the
telescope PSF due to the scattering of the photons inside the detector
substrate. How well the detector PSF is understood/modeled/measured is
key in this instance and should not be understated. For the pixel
variance, the slope-fitting uncertainty from the pixel integration
ramp(s) is used. The combination of the detector PSF and pixel variance
is used as a weighing function to weigh the signal in each detector pixel.
           </p>
           <p>
            In its most basic form, the notebook code assumes that there is only one
point source in the MRS field of view. Using a Gaussian-fitting routine
at detector-level, the centroid of the point source is determined with a
sub-pixel accuracy. The centroid is used to project the known detector
PSF model directly onto the point source signal. The centroid is also
used to derive the throughput and wavelength correction due to the
location of the point source with respect to the imaging slicer of the
MRS. The throughput and wavelength correction are applied before the
spectral extraction step.
           </p>
           <p>
            The spectral extraction step integrates the point source flux in a
pre-defined list of wavelength bins. All detector pixels contributing to
a wavelength bin are weighed by the projected PSF model -and- the pixel
variance. In case the extracted spectral band is MRS band 3A (around 12
microns) then the following steps are taken:
           </p>
           <ul class="simple">
            <li>
             <p>
              The band 1B (~6 micron) detector image is multiplied by a spectral
leak transmission curve.
             </p>
            </li>
            <li>
             <p>
              A 1d “spectral leak” integrated point source spectrum is extracted
from band 1B.
             </p>
            </li>
            <li>
             <p>
              The spectral leak spectrum is subtracted from the band 3A integrated
point source spectrum.
             </p>
            </li>
           </ul>
           <p>
            Future improvements to the code will allow users to input MRS point
source centroid locations to address the case of crowded fields, barely
resolved blended point sources, and point sources located within a
semi-extended environment with spatial structure. In addition, the fine
centroiding, currently performed using a Gaussian distribution, can be
improved by striving for residual minimisation with a master
detector-based PSF model. Such a master PSF model will be derived and
refined throughout commissioning and Cycle 1 calibration.
           </p>
          </section>
          <section id="import-packages">
           <h2>
            Import Packages
            <a class="headerlink" href="#import-packages" title="Permalink to this headline">
             #
            </a>
           </h2>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Import useful python packages
import numpy as np
from scipy.interpolate import interp1d

# Import packages to display images in the notebook
from matplotlib.lines import Line2D
import matplotlib.pyplot as plt    
%matplotlib inline

# Set general plotting options
params = {'legend.fontsize': '18', 'axes.labelsize': '18', 
          'axes.titlesize': '18', 'xtick.labelsize': '18', 
          'ytick.labelsize': '18', 'lines.linewidth': 2, 'axes.linewidth': 2, 'animation.html': 'html5'}
plt.rcParams.update(params)
plt.rcParams.update({'figure.max_open_warning': 0})

from IPython.display import display, HTML
display(HTML("&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;"))
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output text_html">
              <style>
               .container { width:100% !important; }
              </style>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>import warnings
warnings.simplefilter('ignore')
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Import astropy packages 
from astropy import units as u
from astropy.io import ascii
from astropy.wcs import WCS
from astropy.table import Table, vstack
from astropy.stats import sigma_clipped_stats
from astropy.nddata import StdDevUncertainty
from astropy.io import fits # added by BAS on 8 April 2021
from astropy.utils.data import get_pkg_data_filename
from astropy.utils.data import download_file

# To find stars in the MRS spectralcubes and do aperture photometry
from photutils import DAOStarFinder, CircularAperture

# To deal with 1D spectrum
from specutils import Spectrum1D
from specutils.fitting import fit_generic_continuum
from specutils.manipulation import box_smooth, extract_region, SplineInterpolatedResampler
from specutils.analysis import line_flux, centroid, equivalent_width
from specutils.spectra import SpectralRegion
from specutils import SpectrumList

# To make nice plots with WCS axis
# import aplpy

# To fit a curve to the data
from scipy.optimize import curve_fit

# To download data
import tarfile
import urllib.request
from pathlib import Path
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># import necessary functions from PointSourceDetectorBasedExtractionFuncs and create_distortionMaps
from PointSourceDetectorBasedExtractionFuncs import mrs_aux, point_source_centroiding, evaluate_psf_cdp

# evaluate distortion maps on the 2D detector image plane
from create_distortionMaps import d2cMapping
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="set-paths-to-the-data-and-outputs">
           <h2>
            Set paths to the Data and Outputs
            <a class="headerlink" href="#set-paths-to-the-data-and-outputs" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            Use MIRISim JWST pipeline processed data in future iterations.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>import os
os.environ['CRDS_PATH'] = os.environ['HOME']+'/crds_cache'
os.environ['CRDS_SERVER_URL'] = 'https://jwst-crds-pub.stsci.edu'
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Set JWST pipeline paths
import os
os.environ['CRDS_PATH'] = str(Path(os.environ['HOME']) / 'crds_cache')
os.environ['CRDS_SERVER_URL'] = 'https://jwst-crds-pub.stsci.edu'

# import JWST pipeline
from jdaviz.app import Application
from jwst.pipeline import Detector1Pipeline
from jwst.pipeline import Spec2Pipeline
from jwst.pipeline import Spec3Pipeline
from jwst.extract_1d import Extract1dStep
from jwst.associations.lib.rules_level3_base import DMS_Level3_Base
from jwst.associations import asn_from_list
from photutils import aperture_photometry

import asdf
import crds
import json
import glob
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>tar_location = Path('./')
tar_files = [
    '20210413_120546_mirisim.tar.gz', 
    '20210413_123047_mirisim.tar.gz',
    '20210413_125354_mirisim.tar.gz'
]
tar_paths_full = [tar_location / f for f in tar_files]

tar_urls = [
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/20210413_120546_mirisim.tar.gz',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/20210413_123047_mirisim.tar.gz',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/20210413_125354_mirisim.tar.gz'
]


for p, url in zip(tar_paths_full, tar_urls):
    # check for un-tarred version of file
    tmp = p.parent / p.stem
    if os.path.exists(tmp.stem):
        print(f"{p.name} Directory Exists.")
    else:
        # check for tarred version of file and un-tar
        if not os.path.exists(p):
            # download file if absent
            print(f"Downloading {p.name}...")           
            urllib.request.urlretrieve(url, p)
        
        tar = tarfile.open(p, "r:gz")
        tar.extractall()
        tar.close()
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading 20210413_120546_mirisim.tar.gz...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading 20210413_123047_mirisim.tar.gz...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading 20210413_125354_mirisim.tar.gz...
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Create Directories If They Don't Exist
if os.path.isdir("./miri_devel/cdp_data/DISTORTION"):
    print("MIRI Reference File Directory Exists.")
else:
    os.makedirs("./miri_devel/cdp_data/DISTORTION")
    print("Made Directory ./miri_devel/cdp_data/DISTORTION")
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Made Directory ./miri_devel/cdp_data/DISTORTION
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>data_dir = Path('./')
data_paths = [
    'spectral_leak_transmission.npy',
    'W_Per_spectrum_sws.fit',
    'jwst_miri_photom_0064.fits',
    'jwst_miri_photom_0060.fits',
    'jwst_miri_photom_0052.fits',
    'miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_2SHORT_PSF_07.02.00.fits',
    'miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_2MEDIUM_PSF_07.02.00.fits',
    'miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_2LONG_PSF_07.02.00.fits',
    'miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_1SHORT_PSF_07.02.00.fits',
    'miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_1MEDIUM_PSF_07.02.00.fits',
    'miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_1LONG_PSF_07.02.00.fits',
    'miri_devel/cdp_data/MIRI_FM_MIRIFULONG_3SHORT_PSF_07.02.00.fits',
    'miri_devel/cdp_data/MIRI_FM_MIRIFULONG_3MEDIUM_PSF_07.02.00.fits',
    'miri_devel/cdp_data/MIRI_FM_MIRIFULONG_3LONG_PSF_07.02.00.fits',
    'miri_devel/cdp_data/MIRI_FM_MIRIFULONG_4SHORT_PSF_07.02.00.fits',
    'miri_devel/cdp_data/MIRI_FM_MIRIFULONG_4MEDIUM_PSF_07.02.00.fits',
    'miri_devel/cdp_data/MIRI_FM_MIRIFULONG_4LONG_PSF_07.02.00.fits',
    'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34LONG_DISTORTION_8B.05.03.fits',
    'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34LONG_DISTORTION_8B.05.02.fits',
    'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34MEDIUM_DISTORTION_8B.05.02.fits',
    'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34MEDIUM_DISTORTION_8B.05.03.fits',
    'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34SHORT_DISTORTION_8B.05.02.fits',
    'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34SHORT_DISTORTION_8B.05.03.fits',
    'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFUSHORT_12LONG_DISTORTION_8B.05.02.fits',
    'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFUSHORT_12MEDIUM_DISTORTION_8B.05.02.fits',
    'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFUSHORT_12SHORT_DISTORTION_8B.05.02.fits'
]

data_paths_full = [data_dir / p for p in data_paths]
data_urls = [
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/spectral_leak_transmission.npy',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/W_Per_spectrum_sws.fit',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/jwst_miri_photom_0064.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/jwst_miri_photom_0060.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/jwst_miri_photom_0052.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_2SHORT_PSF_07.02.00.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_2MEDIUM_PSF_07.02.00.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_2LONG_PSF_07.02.00.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_1SHORT_PSF_07.02.00.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_1MEDIUM_PSF_07.02.00.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_1LONG_PSF_07.02.00.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFULONG_3SHORT_PSF_07.02.00.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFULONG_3MEDIUM_PSF_07.02.00.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFULONG_3LONG_PSF_07.02.00.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFULONG_4SHORT_PSF_07.02.00.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFULONG_4MEDIUM_PSF_07.02.00.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFULONG_4LONG_PSF_07.02.00.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34LONG_DISTORTION_8B.05.03.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34LONG_DISTORTION_8B.05.02.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34MEDIUM_DISTORTION_8B.05.02.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34MEDIUM_DISTORTION_8B.05.03.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34SHORT_DISTORTION_8B.05.02.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34SHORT_DISTORTION_8B.05.03.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFUSHORT_12LONG_DISTORTION_8B.05.02.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFUSHORT_12MEDIUM_DISTORTION_8B.05.02.fits',
    'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFUSHORT_12SHORT_DISTORTION_8B.05.02.fits'
] 

for p, url in zip(data_paths_full, data_urls):
    if os.path.exists(p):
        print(f"{p.name} exists.")
    else:
        print(f"Downloading {p.name}...")
        urllib.request.urlretrieve(url, p)
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading spectral_leak_transmission.npy...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading W_Per_spectrum_sws.fit...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading jwst_miri_photom_0064.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading jwst_miri_photom_0060.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading jwst_miri_photom_0052.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_2SHORT_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_2MEDIUM_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_2LONG_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_1SHORT_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_1MEDIUM_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_1LONG_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_3SHORT_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_3MEDIUM_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_3LONG_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_4SHORT_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_4MEDIUM_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_4LONG_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_34LONG_DISTORTION_8B.05.03.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_34LONG_DISTORTION_8B.05.02.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_34MEDIUM_DISTORTION_8B.05.02.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_34MEDIUM_DISTORTION_8B.05.03.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_34SHORT_DISTORTION_8B.05.02.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_34SHORT_DISTORTION_8B.05.03.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_12LONG_DISTORTION_8B.05.02.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_12MEDIUM_DISTORTION_8B.05.02.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_12SHORT_DISTORTION_8B.05.02.fits...
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="run-pipeline">
           <h2>
            Run Pipeline
            <a class="headerlink" href="#run-pipeline" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            The various
            <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/pipeline/main.html#pipelines">
             stages of the pipeline
            </a>
            can be
            <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/introduction.html#running-from-within-python">
             run within Python
            </a>
            .  For a more in depth tutorial on running the pipelines, check out the
            <a class="reference external" href="https://www.stsci.edu/jwst/science-execution/jwebbinars">
             JWebbinars
            </a>
            .
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Execute calwebb_detector1 pipeline on raw simulation output.  This will overwrite previous reductions.

allshortfiles = glob.glob('20210413_*_mirisim/det_images/*MIRIFUSHORT*fits')
alllongfiles = glob.glob('20210413_*_mirisim/det_images/*MIRIFULONG*fits')
      
pipe1short = Detector1Pipeline()

# run calwebb_detector1 on the MIRIFUSHORT data separate from MIRIFULONG data, as it saves time this way
for shortfile in allshortfiles:
    print(shortfile)
    baseshort, remaindershort = shortfile.split('.')
    
    # If you run your own simulations, you will need to update these hardcoded files.
    beforestuffshort, dateafterstuffshort = shortfile.split('20210413_')    
    datestringshort, afterstuffshort = dateafterstuffshort.split('_mirisim')
    
    pipe1short.refpix.skip = True
    pipe1short.output_file = baseshort + datestringshort
    
    pipe1short.run(shortfile)

pipe1long = Detector1Pipeline()

for longfile in alllongfiles:
    print(longfile)
    baselong, remainderlong = longfile.split('.')
    
    # If you run your own simulations, you will need to update these hardcoded files.
    beforestufflong, dateafterstufflong = longfile.split('20210413_')
    datestringlong, afterstufflong = dateafterstufflong.split('_mirisim')
    
    pipe1long.refpix.skip = True
    pipe1long.output_file = baselong + datestringlong
    
    pipe1long.run(longfile)
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq3_MIRIFUSHORT_12MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:44,969 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_system_datalvl_0002.rmap      694 bytes  (1 / 179 files) (0 / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:45,055 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_system_calver_0031.rmap    3.8 K bytes  (2 / 179 files) (694 / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:45,131 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_system_0030.imap      385 bytes  (3 / 179 files) (4.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:45,203 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_wavelengthrange_0020.rmap    1.5 K bytes  (4 / 179 files) (4.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:45,276 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_wavecorr_0005.rmap      884 bytes  (5 / 179 files) (6.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:45,352 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_superbias_0052.rmap   29.8 K bytes  (6 / 179 files) (7.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:45,448 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_sflat_0021.rmap   20.6 K bytes  (7 / 179 files) (37.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:45,535 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_saturation_0018.rmap    2.0 K bytes  (8 / 179 files) (57.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:45,589 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_refpix_0015.rmap    1.6 K bytes  (9 / 179 files) (59.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:45,667 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_readnoise_0020.rmap    2.3 K bytes  (10 / 179 files) (61.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:45,851 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_photom_0013.rmap      958 bytes  (11 / 179 files) (63.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:45,921 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_pathloss_0004.rmap      983 bytes  (12 / 179 files) (64.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:45,995 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_pars-whitelightstep_0001.rmap      777 bytes  (13 / 179 files) (65.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,067 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_pars-spec2pipeline_0013.rmap    2.1 K bytes  (14 / 179 files) (66.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,131 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_pars-image2pipeline_0008.rmap    1.0 K bytes  (15 / 179 files) (68.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,190 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_pars-detector1pipeline_0003.rmap    1.1 K bytes  (16 / 179 files) (69.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,244 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_pars-darkpipeline_0003.rmap      872 bytes  (17 / 179 files) (70.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,312 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_ote_0027.rmap    1.2 K bytes  (18 / 179 files) (71.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,373 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_msaoper_0007.rmap    1.1 K bytes  (19 / 179 files) (72.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,450 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_msa_0025.rmap    1.2 K bytes  (20 / 179 files) (73.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,506 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_mask_0027.rmap    1.9 K bytes  (21 / 179 files) (74.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,561 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_linearity_0017.rmap    1.6 K bytes  (22 / 179 files) (76.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,634 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_ipc_0006.rmap      876 bytes  (23 / 179 files) (78.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,695 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_ifuslicer_0015.rmap    1.5 K bytes  (24 / 179 files) (79.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,750 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_ifupost_0017.rmap    1.4 K bytes  (25 / 179 files) (80.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,818 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_ifufore_0015.rmap    1.4 K bytes  (26 / 179 files) (82.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,877 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_gain_0022.rmap    1.8 K bytes  (27 / 179 files) (83.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,931 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_fpa_0026.rmap    1.2 K bytes  (28 / 179 files) (85.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:46,987 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_fore_0024.rmap    4.5 K bytes  (29 / 179 files) (86.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,055 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_flat_0015.rmap    3.8 K bytes  (30 / 179 files) (91.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,114 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_fflat_0015.rmap    7.2 K bytes  (31 / 179 files) (94.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,190 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_extract1d_0015.rmap    2.2 K bytes  (32 / 179 files) (102.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,247 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_disperser_0026.rmap    5.1 K bytes  (33 / 179 files) (104.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,315 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_dflat_0007.rmap    1.1 K bytes  (34 / 179 files) (109.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,367 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_dark_0048.rmap   28.5 K bytes  (35 / 179 files) (110.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,434 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_cubepar_0011.rmap      966 bytes  (36 / 179 files) (138.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,492 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_collimator_0024.rmap    1.3 K bytes  (37 / 179 files) (139.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,562 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_camera_0024.rmap    1.2 K bytes  (38 / 179 files) (141.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,623 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_barshadow_0004.rmap      928 bytes  (39 / 179 files) (142.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,681 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_area_0017.rmap    6.3 K bytes  (40 / 179 files) (143.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,739 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_apcorr_0010.rmap    5.6 K bytes  (41 / 179 files) (149.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,867 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_0293.imap    5.1 K bytes  (42 / 179 files) (155.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,924 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_wfssbkg_0007.rmap    3.1 K bytes  (43 / 179 files) (160.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:47,980 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_wavemap_0008.rmap    2.2 K bytes  (44 / 179 files) (163.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,050 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_wavelengthrange_0006.rmap      862 bytes  (45 / 179 files) (165.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,109 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_trappars_0004.rmap      753 bytes  (46 / 179 files) (166.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,180 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_trapdensity_0004.rmap      774 bytes  (47 / 179 files) (167.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,234 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_throughput_0004.rmap      979 bytes  (48 / 179 files) (168.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,291 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_superbias_0024.rmap    7.2 K bytes  (49 / 179 files) (168.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,345 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_specwcs_0010.rmap    3.1 K bytes  (50 / 179 files) (176.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,402 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_spectrace_0008.rmap    2.3 K bytes  (51 / 179 files) (179.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,461 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_specprofile_0008.rmap    2.4 K bytes  (52 / 179 files) (181.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,517 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_speckernel_0006.rmap    1.0 K bytes  (53 / 179 files) (184.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,601 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_saturation_0014.rmap      761 bytes  (54 / 179 files) (185.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,656 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_readnoise_0011.rmap      987 bytes  (55 / 179 files) (185.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,718 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_photom_0033.rmap    1.2 K bytes  (56 / 179 files) (186.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,787 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_persat_0005.rmap      738 bytes  (57 / 179 files) (188.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,857 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pathloss_0003.rmap      758 bytes  (58 / 179 files) (188.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,926 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-tweakregstep_0005.rmap    3.1 K bytes  (59 / 179 files) (189.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:48,981 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-spec2pipeline_0008.rmap      984 bytes  (60 / 179 files) (192.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,039 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-sourcecatalogstep_0001.rmap      668 bytes  (61 / 179 files) (193.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,107 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-outlierdetectionstep_0004.rmap    2.7 K bytes  (62 / 179 files) (194.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,167 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-jumpstep_0003.rmap    4.5 K bytes  (63 / 179 files) (196.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,220 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-image2pipeline_0005.rmap    1.0 K bytes  (64 / 179 files) (201.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,289 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-detector1pipeline_0002.rmap    1.0 K bytes  (65 / 179 files) (202.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,348 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-darkpipeline_0002.rmap      868 bytes  (66 / 179 files) (203.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,406 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_mask_0019.rmap      797 bytes  (67 / 179 files) (204.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,468 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_linearity_0020.rmap      894 bytes  (68 / 179 files) (205.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,525 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_ipc_0007.rmap      651 bytes  (69 / 179 files) (206.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,597 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_gain_0011.rmap      797 bytes  (70 / 179 files) (206.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,667 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_flat_0021.rmap    5.9 K bytes  (71 / 179 files) (207.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,723 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_filteroffset_0006.rmap      844 bytes  (72 / 179 files) (213.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,781 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_extract1d_0007.rmap      905 bytes  (73 / 179 files) (214.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,833 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_drizpars_0004.rmap      519 bytes  (74 / 179 files) (215.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,890 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_distortion_0024.rmap    3.4 K bytes  (75 / 179 files) (215.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:49,947 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_dark_0030.rmap    6.8 K bytes  (76 / 179 files) (219.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,000 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_area_0014.rmap    2.7 K bytes  (77 / 179 files) (225.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,072 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_apcorr_0006.rmap    4.3 K bytes  (78 / 179 files) (228.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,127 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_abvegaoffset_0003.rmap    1.4 K bytes  (79 / 179 files) (232.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,197 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_0204.imap    5.1 K bytes  (80 / 179 files) (234.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,267 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_wfssbkg_0004.rmap    7.2 K bytes  (81 / 179 files) (239.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,338 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_wavelengthrange_0010.rmap      996 bytes  (82 / 179 files) (246.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,406 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_tsophot_0003.rmap      896 bytes  (83 / 179 files) (247.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,463 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_trappars_0003.rmap    1.6 K bytes  (84 / 179 files) (248.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,518 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_trapdensity_0003.rmap    1.6 K bytes  (85 / 179 files) (250.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,573 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_superbias_0011.rmap   11.2 K bytes  (86 / 179 files) (251.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,631 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_specwcs_0016.rmap    7.1 K bytes  (87 / 179 files) (262.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,689 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_saturation_0008.rmap    2.2 K bytes  (88 / 179 files) (270.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,770 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_readnoise_0015.rmap   18.6 K bytes  (89 / 179 files) (272.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,852 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_psfmask_0007.rmap   11.0 K bytes  (90 / 179 files) (290.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,921 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_photom_0014.rmap    5.0 K bytes  (91 / 179 files) (301.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:50,976 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_persat_0005.rmap    1.6 K bytes  (92 / 179 files) (306.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,032 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-whitelightstep_0003.rmap    1.5 K bytes  (93 / 179 files) (308.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,086 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-tweakregstep_0003.rmap    4.5 K bytes  (94 / 179 files) (309.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,139 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-spec2pipeline_0008.rmap      984 bytes  (95 / 179 files) (314.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,191 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-sourcecatalogstep_0001.rmap      668 bytes  (96 / 179 files) (315.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,260 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-outlierdetectionstep_0003.rmap      940 bytes  (97 / 179 files) (315.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,335 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-image2pipeline_0003.rmap    1.0 K bytes  (98 / 179 files) (316.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,394 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-detector1pipeline_0002.rmap    1.0 K bytes  (99 / 179 files) (317.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,454 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-darkpipeline_0002.rmap      868 bytes  (100 / 179 files) (318.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,512 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_mask_0010.rmap    2.9 K bytes  (101 / 179 files) (319.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,582 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_linearity_0011.rmap    2.4 K bytes  (102 / 179 files) (322.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,638 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_ipc_0003.rmap    2.0 K bytes  (103 / 179 files) (325.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,691 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_gain_0016.rmap    2.1 K bytes  (104 / 179 files) (327.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,767 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_flat_0020.rmap   51.6 K bytes  (105 / 179 files) (329.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,840 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_filteroffset_0004.rmap    1.4 K bytes  (106 / 179 files) (380.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,911 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_extract1d_0004.rmap      842 bytes  (107 / 179 files) (382.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:51,990 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_drizpars_0001.rmap      519 bytes  (108 / 179 files) (383.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,045 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_distortion_0028.rmap   25.5 K bytes  (109 / 179 files) (383.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,115 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_dark_0042.rmap   22.9 K bytes  (110 / 179 files) (409.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,190 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_area_0007.rmap    4.6 K bytes  (111 / 179 files) (431.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,246 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_apcorr_0008.rmap    4.3 K bytes  (112 / 179 files) (436.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,316 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_abvegaoffset_0002.rmap    1.3 K bytes  (113 / 179 files) (440.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,384 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_0225.imap    5.0 K bytes  (114 / 179 files) (442.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,458 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_wavelengthrange_0024.rmap      929 bytes  (115 / 179 files) (447.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,530 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_tsophot_0003.rmap      882 bytes  (116 / 179 files) (448.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,589 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_straymask_0008.rmap      987 bytes  (117 / 179 files) (448.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,646 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_specwcs_0034.rmap    5.8 K bytes  (118 / 179 files) (449.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,699 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_saturation_0014.rmap    1.2 K bytes  (119 / 179 files) (455.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,754 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_rscd_0008.rmap    1.0 K bytes  (120 / 179 files) (456.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,812 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_resol_0005.rmap      790 bytes  (121 / 179 files) (457.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,884 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_reset_0023.rmap    3.9 K bytes  (122 / 179 files) (458.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,940 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_regions_0030.rmap    5.2 K bytes  (123 / 179 files) (462.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:52,995 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_readnoise_0020.rmap    1.6 K bytes  (124 / 179 files) (467.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,048 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_psfmask_0007.rmap    1.6 K bytes  (125 / 179 files) (469.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,110 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_photom_0037.rmap    3.9 K bytes  (126 / 179 files) (471.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,182 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pathloss_0004.rmap      802 bytes  (127 / 179 files) (474.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,236 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-whitelightstep_0002.rmap      887 bytes  (128 / 179 files) (475.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,304 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-tweakregstep_0003.rmap    1.8 K bytes  (129 / 179 files) (476.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,360 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-spec3pipeline_0003.rmap      890 bytes  (130 / 179 files) (478.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,429 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-spec2pipeline_0008.rmap    1.1 K bytes  (131 / 179 files) (479.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,486 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-sourcecatalogstep_0003.rmap    1.9 K bytes  (132 / 179 files) (480.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,556 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-outlierdetectionstep_0011.rmap    3.4 K bytes  (133 / 179 files) (482.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,625 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-image2pipeline_0005.rmap      979 bytes  (134 / 179 files) (485.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,681 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-detector1pipeline_0004.rmap    1.1 K bytes  (135 / 179 files) (486.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,737 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-darkpipeline_0002.rmap      860 bytes  (136 / 179 files) (487.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,791 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_mrsxartcorr_0004.rmap    2.2 K bytes  (137 / 179 files) (488.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,860 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_mrsptcorr_0002.rmap    1.9 K bytes  (138 / 179 files) (490.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,915 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_mask_0019.rmap    1.1 K bytes  (139 / 179 files) (492.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:53,971 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_linearity_0015.rmap    2.4 K bytes  (140 / 179 files) (493.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,032 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_gain_0007.rmap      893 bytes  (141 / 179 files) (496.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,087 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_fringefreq_0003.rmap    1.4 K bytes  (142 / 179 files) (497.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,144 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_fringe_0017.rmap    3.7 K bytes  (143 / 179 files) (498.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,220 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_flat_0059.rmap   15.1 K bytes  (144 / 179 files) (502.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,286 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_filteroffset_0022.rmap    1.5 K bytes  (145 / 179 files) (517.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,343 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_extract1d_0016.rmap    1.3 K bytes  (146 / 179 files) (518.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,400 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_drizpars_0002.rmap      511 bytes  (147 / 179 files) (520.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,455 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_distortion_0037.rmap    4.9 K bytes  (148 / 179 files) (520.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,513 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_dark_0031.rmap    4.4 K bytes  (149 / 179 files) (525.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,567 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_cubepar_0013.rmap      800 bytes  (150 / 179 files) (529.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,617 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_area_0012.rmap      806 bytes  (151 / 179 files) (530.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,672 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_apcorr_0009.rmap    4.3 K bytes  (152 / 179 files) (531.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,742 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_abvegaoffset_0002.rmap    1.3 K bytes  (153 / 179 files) (535.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,802 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_0310.imap    5.1 K bytes  (154 / 179 files) (537.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,860 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_trappars_0004.rmap      903 bytes  (155 / 179 files) (542.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,915 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_trapdensity_0006.rmap      930 bytes  (156 / 179 files) (543.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:54,971 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_superbias_0017.rmap    3.8 K bytes  (157 / 179 files) (544.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,042 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_saturation_0009.rmap      779 bytes  (158 / 179 files) (547.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,109 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_readnoise_0011.rmap    1.3 K bytes  (159 / 179 files) (548.6 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,163 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_photom_0014.rmap    1.1 K bytes  (160 / 179 files) (549.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,218 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_persat_0006.rmap      884 bytes  (161 / 179 files) (551.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,272 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_pars-tweakregstep_0002.rmap      850 bytes  (162 / 179 files) (551.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,327 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_pars-sourcecatalogstep_0001.rmap      636 bytes  (163 / 179 files) (552.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,397 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_pars-outlierdetectionstep_0001.rmap      654 bytes  (164 / 179 files) (553.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,451 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_pars-image2pipeline_0005.rmap      974 bytes  (165 / 179 files) (554.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,504 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_pars-detector1pipeline_0002.rmap    1.0 K bytes  (166 / 179 files) (555.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,560 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_pars-darkpipeline_0002.rmap      856 bytes  (167 / 179 files) (556.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,613 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_mask_0022.rmap    1.1 K bytes  (168 / 179 files) (556.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,685 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_linearity_0015.rmap      925 bytes  (169 / 179 files) (557.9 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,743 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_ipc_0003.rmap      614 bytes  (170 / 179 files) (558.8 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,804 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_gain_0010.rmap      890 bytes  (171 / 179 files) (559.4 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,857 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_flat_0009.rmap    1.1 K bytes  (172 / 179 files) (560.3 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,928 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_distortion_0009.rmap    1.2 K bytes  (173 / 179 files) (561.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:55,987 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_dark_0016.rmap    4.3 K bytes  (174 / 179 files) (562.7 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:56,046 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_area_0010.rmap    1.2 K bytes  (175 / 179 files) (567.0 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:56,097 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_apcorr_0003.rmap    4.1 K bytes  (176 / 179 files) (568.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:56,158 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_abvegaoffset_0002.rmap    1.3 K bytes  (177 / 179 files) (572.2 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:56,211 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_0103.imap    4.6 K bytes  (178 / 179 files) (573.5 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:56,266 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_0994.pmap         580 bytes  (179 / 179 files) (578.1 K / 578.7 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:00:56,538 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_dark_0044.fits  773.6 M bytes  (1 / 7 files) (0 / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:01:08,938 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_gain_0007.fits    4.2 M bytes  (2 / 7 files) (773.6 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:01:09,141 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_linearity_0023.fits   46.5 M bytes  (3 / 7 files) (777.8 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:01:10,264 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_mask_0027.fits    4.3 M bytes  (4 / 7 files) (824.4 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:01:10,464 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_readnoise_0050.fits    4.2 M bytes  (5 / 7 files) (828.6 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:01:10,667 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_rscd_0013.fits   37.4 K bytes  (6 / 7 files) (832.8 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:01:10,758 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_saturation_0025.fits    9.5 M bytes  (7 / 7 files) (832.9 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq2_MIRIFUSHORT_12MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq4_MIRIFUSHORT_12MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq1_MIRIFUSHORT_12MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq4_MIRIFUSHORT_12SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq3_MIRIFUSHORT_12SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq1_MIRIFUSHORT_12SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq2_MIRIFUSHORT_12SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq1_MIRIFUSHORT_12LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq3_MIRIFUSHORT_12LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq2_MIRIFUSHORT_12LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq4_MIRIFUSHORT_12LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq1_MIRIFULONG_34MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:09:51,367 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_dark_0057.fits  773.6 M bytes  (1 / 7 files) (0 / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:10:03,057 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_gain_0006.fits    4.2 M bytes  (2 / 7 files) (773.6 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:10:03,289 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_linearity_0027.fits   46.5 M bytes  (3 / 7 files) (777.8 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:10:06,093 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_mask_0029.fits    4.3 M bytes  (4 / 7 files) (824.4 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:10:06,333 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_readnoise_0064.fits    4.2 M bytes  (5 / 7 files) (828.6 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:10:06,570 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_rscd_0014.fits   37.4 K bytes  (6 / 7 files) (832.8 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:10:06,678 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_saturation_0024.fits    9.5 M bytes  (7 / 7 files) (832.9 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq2_MIRIFULONG_34MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq3_MIRIFULONG_34MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq4_MIRIFULONG_34MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq2_MIRIFULONG_34SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:13:17,817 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_linearity_0026.fits   46.5 M bytes  (1 / 1 files) (0 / 46.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq3_MIRIFULONG_34SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq4_MIRIFULONG_34SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq1_MIRIFULONG_34SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq3_MIRIFULONG_34LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:16:26,409 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_linearity_0022.fits   46.5 M bytes  (1 / 1 files) (0 / 46.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq1_MIRIFULONG_34LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq4_MIRIFULONG_34LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq2_MIRIFULONG_34LONGexp1.fits
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Execute calwebb_spec2 pipeline. This will overwrite previous reductions.

# All the local calwebb_detector1 files
allshortfiles2 = glob.glob('det_image_*_MIRIFUSHORT_*_rate.fits')
alllongfiles2 = glob.glob('det_image_*_MIRIFULONG_*_rate.fits')

for short2file in allshortfiles2:
    print(short2file)
    pipe2short = Spec2Pipeline()
    base2short, remainder2short = short2file.split('.')
    
    pipe2short.straylight.skip = True
    
    # If you run your own simulations, you will need to update these hardcoded files.
    if (short2file == 'det_image_seq1_MIRIFUSHORT_12LONGexp1125354_rate.fits'):
        print('this one will have the level 2b cube built')
    else:
        pipe2short.cube_build.skip = True
    pipe2short.extract_1d.skip = True
    pipe2short.output_file = base2short
        
    pipe2short.run(short2file)

for long2file in alllongfiles2:
    print(long2file)
    pipe2long = Spec2Pipeline()
    base2long, remainder2long = long2file.split('.')
    
    pipe2long.straylight.skip = True
    # If you run your own simulations, you will need to update these hardcoded files.
    if (long2file == 'det_image_seq1_MIRIFULONG_34SHORTexp1120546_rate.fits'):
        print('this one will have the level 2b cube built')
    else:
        pipe2long.cube_build.skip = True
    pipe2long.extract_1d.skip = True
    pipe2long.output_file = base2long
    
    pipe2long.run(long2file)
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq2_MIRIFUSHORT_12LONGexp1125354_rate.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:32,241 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_distortion_0029.asdf  131.1 K bytes  (1 / 8 files) (0 / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:32,369 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_drizpars_0001.fits    8.6 K bytes  (2 / 8 files) (131.1 K / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:32,467 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_flat_0753.fits   12.7 M bytes  (3 / 8 files) (139.7 K / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:33,011 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_fringe_0049.fits   12.7 M bytes  (4 / 8 files) (12.8 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:34,239 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_photom_0060.fits   33.8 M bytes  (5 / 8 files) (25.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:36,103 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_regions_0028.asdf   76.1 M bytes  (6 / 8 files) (59.4 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:40,144 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_specwcs_0022.asdf   42.1 K bytes  (7 / 8 files) (135.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:40,248 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_wavelengthrange_0005.asdf    2.4 K bytes  (8 / 8 files) (135.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq1_MIRIFUSHORT_12SHORTexp1120546_rate.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:52,726 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_distortion_0031.asdf  131.0 K bytes  (1 / 6 files) (0 / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:52,923 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_flat_0749.fits   12.7 M bytes  (2 / 6 files) (131.0 K / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:53,949 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_fringe_0046.fits   12.7 M bytes  (3 / 6 files) (12.8 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:55,136 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_photom_0052.fits   33.8 M bytes  (4 / 6 files) (25.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:57,251 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_regions_0027.asdf   76.1 M bytes  (5 / 6 files) (59.4 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:19:59,454 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_specwcs_0024.asdf   42.1 K bytes  (6 / 6 files) (135.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq3_MIRIFUSHORT_12SHORTexp1120546_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq4_MIRIFUSHORT_12LONGexp1125354_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq2_MIRIFUSHORT_12MEDIUMexp1123047_rate.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:20:36,394 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_distortion_0030.asdf  131.0 K bytes  (1 / 6 files) (0 / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:20:36,533 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_flat_0763.fits   12.7 M bytes  (2 / 6 files) (131.0 K / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:20:37,457 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_fringe_0034.fits   12.7 M bytes  (3 / 6 files) (12.8 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:20:38,403 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_photom_0064.fits   33.8 M bytes  (4 / 6 files) (25.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:20:40,389 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_regions_0026.asdf   76.1 M bytes  (5 / 6 files) (59.4 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:20:45,412 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_specwcs_0021.asdf   42.1 K bytes  (6 / 6 files) (135.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq2_MIRIFUSHORT_12SHORTexp1120546_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq1_MIRIFUSHORT_12LONGexp1125354_rate.fits
this one will have the level 2b cube built
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:21:10,581 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_cubepar_0006.fits  489.6 K bytes  (1 / 1 files) (0 / 489.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq4_MIRIFUSHORT_12MEDIUMexp1123047_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq3_MIRIFUSHORT_12MEDIUMexp1123047_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq4_MIRIFUSHORT_12SHORTexp1120546_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq1_MIRIFUSHORT_12MEDIUMexp1123047_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq3_MIRIFUSHORT_12LONGexp1125354_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq1_MIRIFULONG_34MEDIUMexp1123047_rate.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:22:43,883 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_distortion_0033.asdf   98.4 K bytes  (1 / 6 files) (0 / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:22:44,000 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_flat_0747.fits   12.7 M bytes  (2 / 6 files) (98.4 K / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:22:44,527 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_fringe_0044.fits   12.7 M bytes  (3 / 6 files) (12.8 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:22:45,133 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_photom_0049.fits   33.8 M bytes  (4 / 6 files) (25.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:22:46,917 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_regions_0030.asdf   76.1 M bytes  (5 / 6 files) (59.4 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:22:49,081 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_specwcs_0023.asdf   31.4 K bytes  (6 / 6 files) (135.4 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq1_MIRIFULONG_34LONGexp1125354_rate.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:23:00,460 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_distortion_0032.asdf   98.3 K bytes  (1 / 6 files) (0 / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:23:00,594 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_flat_0750.fits   12.7 M bytes  (2 / 6 files) (98.3 K / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:23:01,166 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_fringe_0045.fits   12.7 M bytes  (3 / 6 files) (12.8 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:23:02,067 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_photom_0059.fits   33.8 M bytes  (4 / 6 files) (25.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:23:02,977 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_regions_0025.asdf   76.1 M bytes  (5 / 6 files) (59.4 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:23:06,234 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_specwcs_0019.asdf   31.4 K bytes  (6 / 6 files) (135.4 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq3_MIRIFULONG_34MEDIUMexp1123047_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq2_MIRIFULONG_34MEDIUMexp1123047_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq2_MIRIFULONG_34LONGexp1125354_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq4_MIRIFULONG_34SHORTexp1120546_rate.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:23:51,649 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_distortion_0034.asdf   98.3 K bytes  (1 / 6 files) (0 / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:23:51,881 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_flat_0758.fits   12.7 M bytes  (2 / 6 files) (98.3 K / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:23:52,373 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_fringe_0042.fits   12.7 M bytes  (3 / 6 files) (12.8 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:23:53,386 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_photom_0057.fits   33.8 M bytes  (4 / 6 files) (25.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:23:55,073 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_regions_0029.asdf   76.1 M bytes  (5 / 6 files) (59.4 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-12-30 16:23:59,457 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_specwcs_0020.asdf   31.4 K bytes  (6 / 6 files) (135.4 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq3_MIRIFULONG_34SHORTexp1120546_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq1_MIRIFULONG_34SHORTexp1120546_rate.fits
this one will have the level 2b cube built
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq4_MIRIFULONG_34LONGexp1125354_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq2_MIRIFULONG_34SHORTexp1120546_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq3_MIRIFULONG_34LONGexp1125354_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq4_MIRIFULONG_34MEDIUMexp1123047_rate.fits
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># If you run your own simulations, you will need to update these hardcoded files.
l_cube_file = 'det_image_seq1_MIRIFULONG_34SHORTexp1120546_s3d.fits'
s_cube_file = 'det_image_seq1_MIRIFUSHORT_12LONGexp1125354_s3d.fits'

with fits.open(s_cube_file) as hdu_s_cube:
    s_cube = hdu_s_cube['SCI'].data
    s_med_cube = np.zeros((s_cube.shape[1], s_cube.shape[2]))
    for a in range(s_cube.shape[1]):
        for b in range(s_cube.shape[2]):
            s_med_cube[a, b] = np.median(s_cube[:, a, b])

mean, median, std = sigma_clipped_stats(s_med_cube, sigma=2.0)

# Get a list of sources using a dedicated source detection algorithm
# Find sources at least 3* background (typically)

daofind = DAOStarFinder(fwhm=2.0, threshold=3.*std)
sources = daofind(s_med_cube-median) 
print("\n Number of sources in field: ", len(sources))

# Positions in pixels
positions = Table([sources['xcentroid'], sources['ycentroid']])

# Convert to RA &amp; Dec (ICRS)
peakpixval = np.zeros(len(sources['xcentroid']))
for count_s, _ in enumerate(sources):
    peakpixval[count_s] = s_med_cube[int(np.round(sources['xcentroid'][count_s])), int(np.round(sources['ycentroid'][count_s]))]
print('peak pixel x =')
print(sources['xcentroid'][np.argmax(peakpixval)])
print('peak pixel y =')
print(sources['ycentroid'][np.argmax(peakpixval)])

plt.imshow(s_med_cube, vmin=0, vmax=100)
plt.tight_layout()
plt.scatter(sources['xcentroid'], sources['ycentroid'], c="red", marker="+", s=50)
plt.scatter(sources['xcentroid'][np.argmax(peakpixval)], sources['ycentroid'][np.argmax(peakpixval)], c='black', marker='+', s=50)
plt.show()

f0 = fits.open(s_cube_file)
w0 = WCS(f0[('sci', 1)].header, f0)
f0.close()

radec = w0.all_pix2world([sources['xcentroid'][np.argmax(peakpixval)]], [sources['ycentroid'][np.argmax(peakpixval)]], [1], 1)

# Take the brightest source flux and take that to be your primary point source for extraction
ra_ptsrc = radec[0][0]
dec_ptsrc = radec[1][0]
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output traceback highlight-ipythontb notranslate">
              <div class="highlight">
               <pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">line</span> <span class="mi">19</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="n">daofind</span> <span class="o">=</span> <span class="n">DAOStarFinder</span><span class="p">(</span><span class="n">fwhm</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">3.</span><span class="o">*</span><span class="n">std</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="n">sources</span> <span class="o">=</span> <span class="n">daofind</span><span class="p">(</span><span class="n">s_med_cube</span><span class="o">-</span><span class="n">median</span><span class="p">)</span> 
<span class="nn">---&gt; 19 print("\n Number of sources</span> in <span class="ni">field: ", len</span><span class="nt">(sources))</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="c1"># Positions in pixels</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="n">positions</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">sources</span><span class="p">[</span><span class="s1">'xcentroid'</span><span class="p">],</span> <span class="n">sources</span><span class="p">[</span><span class="s1">'ycentroid'</span><span class="p">]])</span>

<span class="ne">TypeError</span>: object of type 'NoneType' has no len()
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Due to the way the pipeline currently extracts Level3 data, you must update the headers to be centered on the point source of your choosing from the step above.
all_files = glob.glob('det_image_*_cal.fits')
targra = ra_ptsrc
targdec = dec_ptsrc
for thisfile in all_files:
    base, remainder = thisfile.split('.')
    outfilename = base + '_fix.' + remainder
    print(outfilename)
    
    with fits.open(thisfile) as hduthis:
        hduthis['SCI'].header['SRCTYPE'] = 'POINT'
        hduthis[0].header['TARG_RA'] = targra 
        hduthis[0].header['TARG_DEC'] = targdec
        hduthis.writeto(outfilename, overwrite=True)
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># set up needed reference file(s) for spec3

file_all_list = glob.glob('det_image_*_cal.fits')

asnall = asn_from_list.asn_from_list(file_all_list, rule=DMS_Level3_Base, product_name='combine_dithers_all_exposures')

asnallfile = 'for_spec3_all.json'
with open(asnallfile, 'w') as fpall:
    fpall.write(asnall.dump()[1])
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Execute calwebb_spec3 pipeline.  This will overwrite previous reductions.

pipe3ss = Spec3Pipeline()
pipe3ss.master_background.skip = True
pipe3ss.mrs_imatch.skip = True
pipe3ss.outlier_detection.skip = True
pipe3ss.resample_spec.skip = True
pipe3ss.combine_1d.skip = True
pipe3ss.use_source_posn = 'True'
pipe3ss.subtract_background = 'True'
pipe3ss.output_file = 'allspec3'
pipe3ss.run(asnallfile)
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="now-to-detect-the-point-source-in-the-detector-image-plane-and-extract-and-plot-the-spectra-for-each-source">
           <h2>
            Now to detect the point source in the detector image plane and extract and plot the spectra for each source
            <a class="headerlink" href="#now-to-detect-the-point-source-in-the-detector-image-plane-and-extract-and-plot-the-spectra-for-each-source" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            Steps involved:
           </p>
           <ol class="simple">
            <li>
             <p>
              Convert MJy/sr to Jy
             </p>
            </li>
            <li>
             <p>
              Determine PSF centroid on the detector plane, if this one is not provided
             </p>
            </li>
            <li>
             <p>
              Based on the across-slice position of the point source, determine the transmission and wavelength correction factors and apply correction
             </p>
            </li>
            <li>
             <p>
              Project MRS PSF model from 3D spectral cube to 2D detector image plane
             </p>
            </li>
            <li>
             <p>
              Determine pixel weights based on PSF and pixel variance information
             </p>
            </li>
            <li>
             <p>
              Perform detector-based spectral extraction
             </p>
            </li>
            <li>
             <p>
              If MRS spectral band is 3A (~12.2 micron), determine diffraction grating second order spectral leak contribution (from ~6.1 microns) and apply correction.
             </p>
            </li>
           </ol>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># centroid placeholders in local MRS coordinates
alpha_centers2D_dict = {}
beta_centers2D_dict = {}
# spectrum placeholder
isolambda_spec_optimal = {}
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># define spectral band
band = '1B'
ch = band[0]

if ch in ['1', '2']:
    det_id = 'MIRIFUSHORT'
    band_combo = '12'
elif ch in ['3', '4']:
    det_id = 'MIRIFULONG'
    band_combo = '34'
    
if band[1] == 'A':
    band_id = 'short'
    band_id_nr = 1
elif band[1] == 'B':
    band_id = 'medium'
    band_id_nr = 2
elif band[1] == 'C':
    band_id = 'long'
    band_id_nr = 3
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># load data file SCI and ERR extensions
if band in ['1A', '2A']:
    hdu = fits.open('det_image_seq1_MIRIFUSHORT_12SHORTexp1120546_cal.fits')
    fn = download_file('https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/jwst_miri_photom_0052.fits', cache=False)
    hdu_photom = fits.open(fn)  
elif band in ['1B', '2B']:
    hdu = fits.open('det_image_seq1_MIRIFUSHORT_12MEDIUMexp1123047_cal.fits')
    fn = download_file('https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/jwst_miri_photom_0064.fits', cache=False)
    hdu_photom = fits.open(fn)
elif band in ['1C', '2C']:
    hdu = fits.open('det_image_seq1_MIRIFUSHORT_12LONGexp1125354_cal.fits')
    fn = download_file('https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/jwst_miri_photom_0060.fits', cache=False)
    hdu_photom = fits.open(fn)
sci_img = hdu['SCI'].data
err_img = hdu['ERR'].data

# load photom PIXSIZ extension to convert MJy/sr to Jansky
pixsiz_img = hdu_photom['PIXSIZ'].data

# convert MJy/sr to Jansky for both the SCI and ERR extensions
sci_img = sci_img*pixsiz_img # MJy/sr --&gt; MJy
err_img = err_img*pixsiz_img # MJy/sr --&gt; MJy

sci_img = sci_img*10**6 # MJy --&gt; Jy
err_img = err_img*10**6 # MJy --&gt; Jy

# close opened fits files
hdu.close()
hdu_photom.close()

# Point source corrections CDP values
# Transmission vs across-slice correction
fn = download_file('https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri-ifuptcor-59645.fits', cache=False)
hdu = fits.open(fn)
list_channels = ['CH1', 'CH2', 'CH3', 'CH4']
lamb_min = np.round(hdu['TRACOR'].data['WAVE_MIN'], 2)
lamb_max = np.round(hdu['TRACOR'].data['WAVE_MAX'], 2)
Tcen_min = np.round(hdu['TRACOR'].data['T_WMIN_CENTRE'], 2)
Tcen_max = np.round(hdu['TRACOR'].data['T_WMAX_CENTRE'], 2)
Tedg_min = np.round(hdu['TRACOR'].data['T_WMIN_EDGE'], 2)
Tedg_max = np.round(hdu['TRACOR'].data['T_WMAX_EDGE'], 2)

# Wavelength offset vs across-slice correction
bands = hdu['WAVCORR_OPTICAL'].data['SUB_BAND']
x_slice_min_LT = np.round(hdu['WAVCORR_XSLICE'].data['XSLICE_MIN'][0], 8) # micron * arcsec^-1
x_slice_max_LT = np.round(hdu['WAVCORR_XSLICE'].data['XSLICE_MAX'][0], 8) # micron * arcsec^-1

beta_slice = np.round(hdu['WAVCORR_OPTICAL'].data['BETA_SLICE'], 3)

wave_min = np.round(hdu['WAVCORR_OPTICAL'].data['WAVE_MIN'], 2)
wave_max = np.round(hdu['WAVCORR_OPTICAL'].data['WAVE_MAX'], 2)
srp_min = hdu['WAVCORR_OPTICAL'].data['SRP_MIN']
srp_max = hdu['WAVCORR_OPTICAL'].data['SRP_MAX']

beta_off = np.round(hdu['WAVCORR_SHIFT'].data['BETA_OFF'], 3)
Delta_s_min_LT = hdu['WAVCORR_SHIFT'].data['DS_MIN']
Delta_s_max_LT = hdu['WAVCORR_SHIFT'].data['DS_MAX']

# Spectral leak (second order spectral response in form of an optical system transmission)
sys_transm_img = hdu['SCI'].data
hdu.close()
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># define path to distortion (D2C) files (and create folder if it doesn't exist)
workDir = './miri_devel/'
cdpDir = workDir+'cdp_data/'
d2cDir = cdpDir+'DISTORTION/'

# Evaluate largest distortion solution on the 2D detector (lowest slice transmission)
d2cMaps = d2cMapping(band, d2cDir, slice_transmission='10pc', fileversion="8B.05.02")
sliceMap = d2cMaps['sliceMap']
lambdaMap = d2cMaps['lambdaMap']
alphaMap = d2cMaps['alphaMap']
betaMap = d2cMaps['betaMap']
nslices = d2cMaps['nslices']

# some auxiliary data
det_dims = (1024, 1032)
bandlims = [lambdaMap[np.nonzero(lambdaMap)].min(), lambdaMap[np.nonzero(lambdaMap)].max()]

# spectral grid based on which the point source centroid is determined
lambmin = mrs_aux(band)[3][0]
lambmax = mrs_aux(band)[3][1]
lambcens = np.arange(lambmin, lambmax, (lambmax-lambmin)/1024.)
lambfwhms = np.ones(len(lambcens))*(5*(lambmax-lambmin)/1024.)
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Determine point source centroid
sign_amp2D, alpha_centers2D, beta_centers2D, sigma_alpha2D, sigma_beta2D, bkg_amp2D = point_source_centroiding(band, sci_img, d2cMaps, spec_grid=[lambcens, lambfwhms], fit='2D')

alpha_centers2D_dict[band] = alpha_centers2D
beta_centers2D_dict[band] = beta_centers2D
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span># Diagnostic plot for the point source centroid: We care about the mean value of alpha, beta. These will be used for the PSF projection on the detector plane.
# Conceivably a PSF residual algorithm could be coded, to determine the alpha,beta centroid more accurately still.
fig, axs = plt.subplots(2, 1, figsize=(15, 10))
axs[0].plot(lambcens[20:-20], alpha_centers2D_dict[band][20:-20])
axs[0].plot(lambcens[20:-20], np.ones(len(lambcens[20:-20]))*np.mean(alpha_centers2D_dict[band][20:-20]), 'k--')
axs[1].plot(lambcens[20:-20], beta_centers2D_dict[band][20:-20])
axs[1].plot(lambcens[20:-20], np.ones(len(lambcens[20:-20]))*np.mean(beta_centers2D_dict[band][20:-20]), 'k--')
axs[0].set_ylabel(r'Along-slice position $\alpha$ [arcsec]')
axs[0].set_title('MRS Band {}'.format(band))
axs[1].set_xlabel(r'Wavelength [$\mu m$]')
axs[1].set_ylabel(r'Across-slice position $\beta$ [arcsec]')
plt.tight_layout()
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
         </section>
         <section class="tex2jax_ignore mathjax_ignore" id="determine-transmission-factor-corresponding-to-source-across-slice-position-beta-the-signal-should-be-multiplied-by-this-factor">
          <h1>
           Determine transmission factor corresponding to source across-slice position
           <span class="math notranslate nohighlight">
            \(\beta\)
           </span>
           , the signal should be multiplied by this factor
           <a class="headerlink" href="#determine-transmission-factor-corresponding-to-source-across-slice-position-beta-the-signal-should-be-multiplied-by-this-factor" title="Permalink to this headline">
            #
           </a>
          </h1>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span>beta = np.mean(beta_centers2D_dict[band][20:-20])
wav_array = {}
Tb_min = {}
Tb_max = {}
Tdiff_point = {}
Tdiff_extended = {}
for i, key in enumerate(['CH1', 'CH2', 'CH3', 'CH4']):
    wav_array[key] = np.arange(lamb_min[i], lamb_max[i], 0.01) # micron
    Tb_min[key] = Tcen_min[i] + 2 * abs(beta) * (Tedg_min[i]-Tcen_min[i])
    Tb_max[key] = Tcen_max[i] + 2 * abs(beta) * (Tedg_max[i]-Tcen_max[i])
    
    Tdiff_point[key] = Tb_min[key] + ((wav_array[key]-lamb_min[i])/(lamb_max[i]-lamb_min[i])) * (Tb_max[key]-Tb_min[key])
    Tdiff_extended[key] = (Tcen_min[i]+Tedg_max[i])/2. + ((wav_array[key]-lamb_min[i])/(lamb_max[i]-lamb_min[i])) * ((Tcen_max[i]+Tedg_max[i]) - (Tcen_min[i]+Tedg_min[i])) / 2.
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span>plt.figure(figsize=(12, 7))
for key in ['CH1', 'CH2', 'CH3', 'CH4']:
    plt.plot(wav_array[key], Tdiff_point[key], 'k', linestyle='dashed')
    plt.plot(wav_array[key], Tdiff_extended[key], 'k')
plt.xlabel(r'Wavelength [$\mu m$]')
plt.ylabel(r'Transmission correction [%]')
legend_elements = [Line2D([0], [0], color='k', linestyle='dashed', label=r'Point source correction ($\beta$ = {} arcsec)'.format(np.round(beta, 2))),
                   Line2D([0], [0], color='k', linestyle='solid', label='Extended source correction')]
plt.legend(handles=legend_elements, fontsize=20)
plt.tight_layout()

plt.figure(figsize=(12, 7))
for key in ['CH1', 'CH2', 'CH3', 'CH4']:
    plt.plot(wav_array[key], Tdiff_point[key]/Tdiff_extended[key], 'k', linestyle='dotted')
plt.xlabel(r'Wavelength [$\mu m$]')
plt.ylabel(r'$\zeta$ = Tdiff_point / Tdiff_extended')
legend_elements = [Line2D([0], [0], color='k', linestyle='dotted', label=r'$\beta$ = {} arcsec'.format(np.round(beta, 2)))]
plt.legend(handles=legend_elements)
plt.tight_layout()
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span>key = 'CH' + band[0]
ip_zeta = interp1d(wav_array[key], Tdiff_point[key]/Tdiff_extended[key], kind='linear')

zetaMap = np.ones(lambdaMap.shape)
sel = (sliceMap &gt; 100*int(band[0])) &amp; (sliceMap &lt; 100*(int(band[0]) + 1))
zetaMap[sel] = ip_zeta(lambdaMap[sel])

plt.figure(figsize=(8, 6))
plt.imshow(zetaMap, vmin=zetaMap[zetaMap != 0].min(), vmax=zetaMap[zetaMap != 0].max())
clb = plt.colorbar()
clb.set_label(r'$\zeta$')
plt.xlabel('X-pixel')
plt.ylabel('Y-pixel')
plt.tight_layout()
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span># Apply correction to science and error signal
sci_img *= zetaMap
err_img *= zetaMap
</pre>
             </div>
            </div>
           </div>
          </div>
         </section>
         <section class="tex2jax_ignore mathjax_ignore" id="determine-wavelength-correction-due-to-source-across-slice-position-beta">
          <h1>
           Determine wavelength correction due to source across-slice position
           <span class="math notranslate nohighlight">
            \(\beta\)
           </span>
           <a class="headerlink" href="#determine-wavelength-correction-due-to-source-across-slice-position-beta" title="Permalink to this headline">
            #
           </a>
          </h1>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span>beta_center = np.mean(beta_centers2D_dict[band][20:-20])

# determine unique beta values for each slice
sel = np.where((sliceMap &gt; 100*int(band[0])) &amp; (sliceMap &lt; 100*(int(band[0])+1)))
unique_betas = np.unique(betaMap[sel])

# find index of value nearest to beta center in the unique_betas array
idx = np.abs(unique_betas-beta_center).argmin() 
source_center_slice = idx+1

# find index of value nearest to beta center in the unique_betas array
beta_brightest_slice = unique_betas[idx]

# Point source offset from slice centre (-0.5 &lt; tgtOffset &lt; +0.5)
betaOffsetSlice0 = (beta_center-beta_brightest_slice)/d2cMaps['bdel'] 

# Define input data characteristics.
nSubBands = 3
optIndex = nSubBands * (int(band[0]) - 1) + (band_id_nr - 1)
betaSlice = beta_slice[optIndex]

# Compute wavelength correction map (based on MIRI-DD-00006-ATC issue 4)
# The correction is valid only for the two slices nearest to the brightest slice
wavcorr_across_slice = np.zeros((1024, 1032))
for islice in range(-2, 3):
    sel = (sliceMap == 100*int(band[0])+source_center_slice+islice)
    tgtWave = lambdaMap[sel]
    
    # Step 1. Find target offset from slice centre in beta direction'
    betaOff = betaOffsetSlice0 - islice

    # Step 2. Calculate Xslice
    xSlice = betaSlice / tgtWave
    xSliceref = betaSlice / ((lambmin+lambmax)/2.) # We define a reference xslice for the entire band to avoid jumps between beta_off values as a function of wavelength in Step 4.

    # Step 3. Derive scaled offset
    betaOff_scaled = betaOff * xSlice
    betaOff_scaled_ref = betaOff * xSliceref  # We define a reference betaOff_scaled_ref for the entire band to avoid jumps between beta_off values as a function of wavelength in Step 4.

    # Step 4. Find look-up table betaOff_LT values which bracket betaOFF_scaled
    nShiftValues = len(beta_off)
    betaSign = 1
    if (betaOff &lt; 0.0):
        betaSign = -1
        betaOff_scaled = -1.0 * betaOff_scaled
    indexA = -1 # Index in look up table_WCORR_SHIFT 
    for j in range(nShiftValues):
        if (betaOff_scaled_ref &lt; beta_off[j]):
            if (indexA == -1):
                indexA = j-1
    indexB = indexA + 1
    betaOff_LT_A = beta_off[indexA]
    betaOff_LT_B = beta_off[indexB]

    # Step 5. Find ds_min and ds_max
    betaFactor = (betaOff_scaled - betaOff_LT_A) / (betaOff_LT_B - betaOff_LT_A) 

    ds_minA = Delta_s_min_LT[indexA]
    ds_minB = Delta_s_min_LT[indexB]
    ds_min = ds_minA + betaFactor * (ds_minB - ds_minA)
    ds_min = betaSign * ds_min

    ds_maxA = Delta_s_max_LT[indexA]
    ds_maxB = Delta_s_max_LT[indexA]
    ds_max = ds_maxA + betaFactor * (ds_maxB - ds_maxA)
    ds_max = betaSign * ds_max

    # Step 6. Find ds by interpolation between ds_min and ds_max
    xSlice_min = x_slice_min_LT
    xSlice_max = x_slice_max_LT
    xFactor = (xSlice - xSlice_min) / (xSlice_max - xSlice_min)

    ds = ds_min + xFactor * (ds_max - ds_min)

    # Step 7. Convert ds to wavelength shift by intepolstion between SRP values
    w_min = wave_min[optIndex]
    w_max = wave_max[optIndex]
    wFactor = (tgtWave - w_min) / (w_max - w_min)

    srp = srp_min[optIndex] + wFactor * (srp_max[optIndex] - srp_min[optIndex])

    wavcorr_across_slice[sel] = ds * tgtWave / srp

# Plot wavelength correction map
plt.figure(figsize=(10, 6))
plt.imshow(wavcorr_across_slice)
clb = plt.colorbar()
clb.set_label('Wavelength correction [$\u03bc m$]')
plt.xlabel('X-pixel')
plt.ylabel('Y-pixel')
plt.title('MRS spectral band {}'.format(band))
plt.tight_layout()
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span># Apply correction to wavelength map
lambdaMap += wavcorr_across_slice
</pre>
             </div>
            </div>
           </div>
          </div>
         </section>
         <section class="tex2jax_ignore mathjax_ignore" id="load-mrs-psf-model-in-the-3d-spectral-cube-and-project-it-on-the-2d-detector">
          <h1>
           Load MRS PSF model in the 3D spectral cube and project it on the 2D detector
           <a class="headerlink" href="#load-mrs-psf-model-in-the-3d-spectral-cube-and-project-it-on-the-2d-detector" title="Permalink to this headline">
            #
           </a>
          </h1>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span>psf_fits_file = cdpDir+"MIRI_FM_{}_{}{}_PSF_07.02.00.fits".format(det_id, ch, band_id.upper())
psffits = fits.open(psf_fits_file)

# normalize and project PSF on 2D detector (normalization ensures that each cube slice of the model has a signal sum of 1)
psf_img = evaluate_psf_cdp(psffits, d2cMaps, source_center=[np.mean(alpha_centers2D_dict[band][20:-20]), np.mean(beta_centers2D_dict[band][20:-20])], norm=True)

# close fits file
psffits.close()
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span># Diagnostic plot to show how well the projected PSF matches the data
# For low SNR observations this will likely not be very useful
plt.close('all')
plt.figure(figsize=(16, 6))
if band[0] in ['1', '4']:
    plt.plot(sci_img[512, 10:516], label='MIRISim signal')
    scale_factor = (sci_img[512, 10:516][~np.isnan(sci_img[512, 10:516])].max()/psf_img[512, 10:516].max())
    plt.plot(psf_img[512, 10:516]*scale_factor, label='PSF model (scaled)')
elif band[0] in ['2', '3']:
    plt.plot(sci_img[512, 516:-10], label='MIRISim signal')
    scale_factor = (sci_img[512, 516:-10][~np.isnan(sci_img[512, 516:-10])].max()/psf_img[512, 516:-10].max())
    plt.plot(psf_img[512, 516:-10]*scale_factor, label='PSF model (scaled)')
plt.xlabel('X-pixel')
plt.ylabel('Signal [DN/sec]')
plt.legend()
plt.title('MRS spectral band {}'.format(band))
plt.tight_layout()
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span># Determine optimal pixel weights for detector-based spectral extraction
weight_map = psf_img**2 / (err_img)**2
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span># Wavelength array used for the detector-based spectral extraction
# The grid step is approximately half the smallest spectral size in each band (due to the MRS distortion and slice curvature, different pixels contribute to each bin)
wav_array = {'1A': np.arange(4.9, 5.74, 0.0005), '1B': np.arange(5.67, 6.6, 0.0008), '1C': np.arange(6.45, 7.5, 0.001),
             '2A': np.arange(7.477, 8.765, 0.0014), '2B': np.arange(8.711, 10.228, 0.0017), '2C': np.arange(10.017, 11.753, 0.002),
             '3A': np.arange(11.481, 13.441, 0.0023), '3B': np.arange(13.319, 15.592, 0.0026), '3C': np.arange(15.4, 18.072, 0.0030),
             '4A': np.arange(17.651, 20.938, 0.0036), '4B': np.arange(20.417, 24.22, 0.0042), '4C': np.arange(23.884, 28.329, 0.0048)}
nwavs = len(wav_array[band])

# Evaluate smallest distortion solution on the 2D detector (largest slice transmission of 90%)
slice_transmission = '90pc'
d2cMaps = d2cMapping(band, d2cDir, slice_transmission=slice_transmission, fileversion="8B.05.02")
lambdaMap = d2cMaps['lambdaMap']
lambdas = lambdaMap[np.nonzero(lambdaMap)].flatten()

# Need approximate number of pixels contributing to each spectral bin
# This is because only one pixel is used for each detector column --&gt; we want to avoid sampling issues
if band[0] in ['1', '2']:
    if slice_transmission == '90pc':
        npix = 380
    elif slice_transmission == '10pc':
        npix = 500
elif band[0] in ['3', '4']:
    npix = 380
k = np.arange(npix)

# Define pixel grid
X, Y = np.meshgrid(np.arange(1032), np.arange(1024))
X_flat = X[np.nonzero(lambdaMap)].flatten()
Y_flat = Y[np.nonzero(lambdaMap)].flatten()
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span># Omit NaNs from analysis
nan_idx = ~np.isnan(sci_img)
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span># Diffraction grating second order spectral leak contribution
if band == '1B':
    
    np.save('spectral_leak_transmission.npy', sys_transm_img)
    
    plt.close('all')
    plt.figure(figsize=(8, 6))
    plt.imshow(sys_transm_img*100.)
    clb = plt.colorbar()
    clb.set_label('Dichroic transmission [%]')
    plt.xlabel('X-pixel')
    plt.ylabel('Y-pixel')
    plt.tight_layout()
    
    # Compute spectral leak signal from band 1B and update the error map
    spectral_leak_sci_img = sci_img*sys_transm_img
    spectral_leak_err_img = err_img*sys_transm_img
    
    plt.figure(figsize=(8, 6))
    plt.imshow(spectral_leak_sci_img*1000)
    clb = plt.colorbar()
    clb.set_label('Spectral leak signal [mJy]')
    plt.xlabel('X-pixel')
    plt.ylabel('Y-pixel')
    plt.tight_layout()
    
    # Redetermine optimal pixel weights for detector-based spectral extraction
    spectral_leak_weight_map = psf_img**2 / (spectral_leak_err_img)**2
    
    # Initialize placeholder
    spectral_leak_spectrum = np.zeros(nwavs)
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span># Perform detector-based spectral extraction
isolambda_spec_optimal[band] = np.zeros(nwavs)

for i in range(nwavs):
    # determine pixels contributing to spectral bin
    test_img = np.zeros((1024, 1032))
    idxs = np.argsort(np.abs(lambdas-wav_array[band][i]))[k]
    test_img[Y_flat[idxs], X_flat[idxs]] = 1
    
    # ascertain that only one pixel is selected per detector column
    outliers = np.where(np.sum(test_img, axis=0) == 2)[0]

    for col in outliers:
        Y_ = np.argsort(np.abs(lambdaMap[:, col] - wav_array[band][i]))[1]
        test_img[Y_, col] = 0
    
    # plot meant for debugging !!!ONLY USE AT A SINGLE WAVELENGTH!!!
    # plt.figure()
    # plt.imshow(test_img,aspect=0.5)
    # plt.tight_layout()

    # spectral extraction
    sel_valid = (test_img == 1) &amp; nan_idx
    isolambda_spec_optimal[band][i] = np.sum(weight_map[sel_valid] * sci_img[sel_valid] / psf_img[sel_valid]) / np.sum(weight_map[sel_valid])
    
    if band == '1B':
        # Estimate diffraction grating second order spectral leak contribution
        spectral_leak_spectrum[i] = np.sum(spectral_leak_weight_map[sel_valid] * spectral_leak_sci_img[sel_valid] / psf_img[sel_valid]) / np.sum(spectral_leak_weight_map[sel_valid])
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span># debugging spectral bins

i = 200
# determine pixels contributing to spectral bin
test_img = np.zeros((1024, 1032))
idxs = np.argsort(np.abs(lambdas-wav_array[band][i]))[k]
test_img[Y_flat[idxs], X_flat[idxs]] = 1

# ascertain that only one pixel is selected per detector column
outliers = np.where(np.sum(test_img, axis=0) == 2)[0]

for col in outliers:
    Y_ = np.argsort(np.abs(lambdaMap[:, col]-wav_array[band][i]))[1]
    test_img[Y_, col] = 0

plt.figure(figsize=(8, 6))
plt.imshow(test_img)
plt.imshow(d2cMaps['sliceMap'], alpha=0.4)
plt.xlabel('X-pixel')
plt.ylabel('Y-pixel')
plt.title('MRS spectral band {}'.format(band))
plt.tight_layout()
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span># Compare resulting extracted spectrum to result from JWST-pipeline-reconstructed spectrum and original ISO spectrum
# Disclaimer: Due to flux conservation issues in MIRISim, the  MIRISim MRS PSF is broader than the MRS PSF CDP model. 
# This results on the detector-based spectrum having a significantly higher spectral baseline.

# JWST pipeline result
hdu = fits.open('combine_dithers_all_exposures_ch{}-{}_x1d.fits'.format(ch, band_id))
wav = hdu[1].data['WAVELENGTH']
flux = hdu[1].data['FLUX']
hdu.close()

# Original ISO spectrum
W_Per_hdu = fits.open('W_Per_spectrum_sws.fit')
wav_WPer = W_Per_hdu[0].data[:, 0]
flux_WPer = W_Per_hdu[0].data[:, 1]
sel_WPer = (wav_WPer &gt; lambmin) &amp; (wav_WPer &lt; lambmax)
W_Per_hdu.close()

# Plot
if band in ['1A', '1B', '1C']:
    fudge_factor = 28.5
elif band in ['2A', '2B', '2C']:
    fudge_factor = 45
plt.close('all')
plt.figure(figsize=(16, 6))
plt.plot(wav, flux, label='combine_dithers_all_exposures')
plt.plot(wav_array[band], isolambda_spec_optimal[band]/fudge_factor, label='Single dither detector-based extraction (scaled)')
plt.plot(wav_WPer[sel_WPer], flux_WPer[sel_WPer]/1000., label='ISO SWS spectrum of W Per')
plt.xlabel(r'Wavelength' u'[$\u03bc m$]')
plt.ylabel(r'Signal [Jy]')
plt.title('MRS spectral band {}'.format(band))
plt.legend(fontsize=15)
plt.tight_layout()

if band == '1B':
    plt.figure(figsize=(16, 6))
    plt.plot(wav_array[band], isolambda_spec_optimal[band], label='Original signal band 1B')
    plt.plot(wav_array[band], spectral_leak_spectrum, label='Estimated spectral leak')
    plt.xlabel('Wavelength [$\u03bc m$]')
    plt.ylabel('Spectral flux density [Jy]')
    plt.title('MRS spectral band 1B')
    plt.legend()
    plt.tight_layout()
</pre>
             </div>
            </div>
           </div>
          </div>
          <section id="correct-for-spectral-leak-if-mrs-band-is-set-to-3a">
           <h2>
            Correct for spectral leak if MRS band is set to 3A
            <a class="headerlink" href="#correct-for-spectral-leak-if-mrs-band-is-set-to-3a" title="Permalink to this headline">
             #
            </a>
           </h2>
          </section>
          <section id="caution-in-order-for-the-following-cell-to-work-the-user-must-have-run-this-notebook-already-once-for-band-1b">
           <h2>
            CAUTION: In order for the following cell to work, the user must have run this notebook already once for band 1B.
            <a class="headerlink" href="#caution-in-order-for-the-following-cell-to-work-the-user-must-have-run-this-notebook-already-once-for-band-1b" title="Permalink to this headline">
             #
            </a>
           </h2>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span>if band == '3A':
    spectral_leak_corr_band3A = isolambda_spec_optimal[band]-spectral_leak_spectrum
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
         </section>
         <section class="tex2jax_ignore mathjax_ignore" id="the-end">
          <h1>
           THE END
           <a class="headerlink" href="#the-end" title="Permalink to this headline">
            #
           </a>
          </h1>
          <section id="still-to-do">
           <h2>
            Still to do:
            <a class="headerlink" href="#still-to-do" title="Permalink to this headline">
             #
            </a>
           </h2>
           <ul class="simple">
            <li>
             <p>
              Loop the notebook over all dither positions and average the resulting spectra. The reason why we may not want to use all four dithers in one go (i.e. to run the detector based extraction only once) is because we will likely find variations in the PSF as a function of which slice gets illuminated on the detector (think incoming cone angle and detector-scattered light).
             </p>
            </li>
            <li>
             <p>
              Consider updating current centroiding algorithm to use the cross-correlation method of the SDSS MANGA pipeline.
             </p>
            </li>
           </ul>
          </section>
          <section id="about-this-notebook">
           <h2>
            About this notebook
            <a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            <strong>
             Author:
            </strong>
            Ioannis (Yannis) Argyriou, Post-Doctoral Researcher, Institute of Astronomy, KU Leuven, Belgium
            <br/>
            <strong>
             Date:
            </strong>
            2022-01-08
           </p>
           <hr class="docutils"/>
           <p>
            <a class="reference external" href="#top">
             Top of Page
            </a>
           </p>
          </section>
         </section>
         <script type="text/x-thebe-config">
          {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/jdat_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/MRS_Mstar_analysis"
        },
        predefinedOutput: true
    }
         </script>
         <script>
          kernelName = 'python3'
         </script>
        </div>
       </main>
       <footer class="footer-article noprint">
        <!-- Previous / next buttons -->
        <div class="prev-next-area">
         <a class="left-prev" href="JWST_Mstar_dataAnalysis_runpipeline.html" id="prev-link" title="previous page">
          <i class="fas fa-angle-left">
          </i>
          <div class="prev-next-info">
           <p class="prev-next-subtitle">
            previous
           </p>
           <p class="prev-next-title">
            MRS Pipeline
           </p>
          </div>
         </a>
         <a class="right-next" href="JWST_Mstar_dataAnalysis_analysis.html" id="next-link" title="next page">
          <div class="prev-next-info">
           <p class="prev-next-subtitle">
            next
           </p>
           <p class="prev-next-title">
            MRS Cube Analysis
           </p>
          </div>
          <i class="fas fa-angle-right">
          </i>
         </a>
        </div>
       </footer>
      </div>
     </div>
     <div class="footer-content row">
      <footer class="col footer">
       <p>
        By STScI
        <br/>
        © Copyright 2022.
        <br/>
       </p>
      </footer>
     </div>
    </div>
   </div>
  </div>
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  </script>
 </body>
</html>