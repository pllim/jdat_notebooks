<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
  <title>
   WFSS Spectra Part 3: Emission Line Map — STScI JDAT Notebooks
  </title>
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
  <link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
  <link href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
  <link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" rel="stylesheet" type="text/css"/>
  <link href="../../_static/togglebutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/copybutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/mystnb.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/sphinx-thebe.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/main.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" rel="stylesheet" type="text/css"/>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
  <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js">
  </script>
  <script src="../../_static/jquery.js">
  </script>
  <script src="../../_static/underscore.js">
  </script>
  <script src="../../_static/doctools.js">
  </script>
  <script src="../../_static/clipboard.min.js">
  </script>
  <script src="../../_static/copybutton.js">
  </script>
  <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411">
  </script>
  <script>
   let toggleHintShow = 'Click to show';
  </script>
  <script>
   let toggleHintHide = 'Click to hide';
  </script>
  <script>
   let toggleOpenOnPrint = 'true';
  </script>
  <script src="../../_static/togglebutton.js">
  </script>
  <script>
   var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';
  </script>
  <script src="../../_static/design-tabs.js">
  </script>
  <script>
   const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
  </script>
  <script async="async" src="../../_static/sphinx-thebe.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js">
  </script>
  <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js">
  </script>
  <link href="../../genindex.html" rel="index" title="Index"/>
  <link href="../../search.html" rel="search" title="Search"/>
  <link href="../IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html" rel="next" title="IFU Cube Fitting"/>
  <link href="02_Cross_correlation_template.html" rel="prev" title="WFSS Spectra - Part 2: Cross Correlation to Determine Redshift"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <meta content="None" name="docsearch:language"/>
  <!-- Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3">
  </script>
  <script>
   window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-D46G4HKJY3');
  </script>
 </head>
 <body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
  <!-- Checkboxes to toggle the left sidebar -->
  <input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
  <label class="overlay overlay-navbar" for="__navigation">
   <div class="visually-hidden">
    Toggle navigation sidebar
   </div>
  </label>
  <!-- Checkboxes to toggle the in-page toc -->
  <input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
  <label class="overlay overlay-pagetoc" for="__page-toc">
   <div class="visually-hidden">
    Toggle in-page Table of Contents
   </div>
  </label>
  <!-- Headers at the top -->
  <div class="announcement header-item noprint">
  </div>
  <div class="header header-item noprint">
  </div>
  <div class="container-fluid" id="banner">
  </div>
  <div class="container-xl">
   <div class="row">
    <!-- Sidebar -->
    <div class="bd-sidebar noprint" id="site-navigation">
     <div class="bd-sidebar__content">
      <div class="bd-sidebar__top">
       <div class="navbar-brand-box">
        <a class="navbar-brand text-wrap" href="../../index.html">
         <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
         <img alt="logo" class="logo" src="../../_static/stsci_logo2.png"/>
         <h1 class="site-logo" id="site-title">
          STScI JDAT Notebooks
         </h1>
        </a>
       </div>
       <form action="../../search.html" class="bd-search d-flex align-items-center" method="get">
        <i class="icon fas fa-search">
        </i>
        <input aria-label="Search this book..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." type="search"/>
       </form>
       <nav aria-label="Main" class="bd-links" id="bd-docs-nav">
        <div class="bd-toc-item active">
         <ul class="nav bd-sidenav bd-sidenav__home-link">
          <li class="toctree-l1">
           <a class="reference internal" href="../../intro.html">
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           General
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../../index.html">
            Home
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../../install.html">
            Installation
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           Cross-Instrument
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../asdf_example/asdf_example.html">
            ASDF Example
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../background_estimation_imaging/Imaging_Sky_Background_Estimation.html">
            Complex 2D Background
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../composite_model_fitting/specfit_demo_3.html">
            Composite Model Spectral Fitting
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">
            MAST Query
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">
            Specviz Simple Demo
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../cube_fitting/cube_fitting.html">
            IFU Cube Line Maps
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           MIRI
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_runpipeline.html">
            MRS Mstar - Run Pipeline
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_PointSourceDetectorBasedExtraction.html">
            MRS Detector Based Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">
            MRS Mstar - Data Analysis
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">
            IFU of YSOs in LMC
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_spectral_extraction.html">
            LRS Optimal Spectral Extraction
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           NIRCam
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../aperture_photometry/NIRCam_Aperture_Photometry_Example.html">
            Point Source Aperture Photometry
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRCam_photometry/NIRCam_multiband_photometry.html">
            Extended Aperture Photometry
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">
            Cross-Filter PSF Matching
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../psf_photometry/NIRCam_PSF_Photometry_Example.html">
            PSF Photometry
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           NIRISS
          </span>
         </p>
         <ul class="current nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="00_Optimal_extraction.html">
            WFSS Spectra - Optimal Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="01_Combine_and_normalize_1D_spectra.html">
            WFSS Spectra - Combine and Normalize 1D Spectra
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="02_Cross_correlation_template.html">
            WFSS Spectra - Cross-Correlation Template
           </a>
          </li>
          <li class="toctree-l1 current active">
           <a class="current reference internal" href="#">
            WFSS Spectra - Emission Line Map
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           NIRSpec
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">
            IFU Cube Fitting
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../ifu_optimal/ifu_optimal.html">
            IFU Optimal Spectral Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../optimal_extraction/Spectral_Extraction-static.html">
            MOS Optimal Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../mos-spectroscopy/MOSspec_sv06_revised.html">
            MOS Spectroscopy of Extragalactic Field
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">
            BOTS Time Series Observations
           </a>
          </li>
         </ul>
        </div>
       </nav>
      </div>
      <div class="bd-sidebar__bottom">
       <!-- To handle the deprecated key -->
       <div class="navbar_extra_footer">
        Powered by
        <a href="https://jupyterbook.org">
         Jupyter Book
        </a>
       </div>
      </div>
     </div>
     <div id="rtd-footer-container">
     </div>
    </div>
    <!-- A tiny helper pixel to detect if we've scrolled -->
    <div class="sbt-scroll-pixel-helper">
    </div>
    <!-- Main content -->
    <div class="col py-0 content-container">
     <div class="header-article row sticky-top noprint">
      <div class="col py-1 d-flex header-article-main">
       <div class="header-article__left">
        <label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
         <span class="headerbtn__icon-container">
          <i class="fas fa-bars">
          </i>
         </span>
        </label>
       </div>
       <div class="header-article__right">
        <div class="menu-dropdown menu-dropdown-launch-buttons">
         <button aria-label="Launch interactive content" class="headerbtn menu-dropdown__trigger">
          <i class="fas fa-rocket">
          </i>
         </button>
         <div class="menu-dropdown__content">
          <ul>
           <li>
            <button class="headerbtn headerbtn-launch-thebe" data-placement="left" data-toggle="tooltip" onclick="initThebeSBT()" title="Launch Thebe">
             <span class="headerbtn__icon-container">
              <i class="fas fa-play">
              </i>
             </span>
             <span class="headerbtn__text-container">
              Live Code
             </span>
            </button>
           </li>
          </ul>
         </div>
        </div>
        <button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
         <span class="headerbtn__icon-container">
          <i class="fas fa-expand">
          </i>
         </span>
        </button>
        <div class="menu-dropdown menu-dropdown-repository-buttons">
         <button aria-label="Source repositories" class="headerbtn menu-dropdown__trigger">
          <i class="fab fa-github">
          </i>
         </button>
         <div class="menu-dropdown__content">
          <ul>
           <li>
            <a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/spacetelescope/jdat_notebooks/" title="Source repository">
             <span class="headerbtn__icon-container">
              <i class="fab fa-github">
              </i>
             </span>
             <span class="headerbtn__text-container">
              repository
             </span>
            </a>
           </li>
           <li>
            <a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/spacetelescope/jdat_notebooks//issues/new?title=Issue%20on%20page%20%2Fnotebooks/NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.html&amp;body=Your%20issue%20content%20here." title="Open an issue">
             <span class="headerbtn__icon-container">
              <i class="fas fa-lightbulb">
              </i>
             </span>
             <span class="headerbtn__text-container">
              open issue
             </span>
            </a>
           </li>
          </ul>
         </div>
        </div>
        <div class="menu-dropdown menu-dropdown-download-buttons">
         <button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
          <i class="fas fa-download">
          </i>
         </button>
         <div class="menu-dropdown__content">
          <ul>
           <li>
            <a class="headerbtn" data-placement="left" data-toggle="tooltip" href="../../_sources/notebooks/NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.ipynb" title="Download source file">
             <span class="headerbtn__icon-container">
              <i class="fas fa-file">
              </i>
             </span>
             <span class="headerbtn__text-container">
              .ipynb
             </span>
            </a>
           </li>
           <li>
            <button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
             <span class="headerbtn__icon-container">
              <i class="fas fa-file-pdf">
              </i>
             </span>
             <span class="headerbtn__text-container">
              .pdf
             </span>
            </button>
           </li>
          </ul>
         </div>
        </div>
        <label class="headerbtn headerbtn-page-toc" for="__page-toc">
         <span class="headerbtn__icon-container">
          <i class="fas fa-list">
          </i>
         </span>
        </label>
       </div>
      </div>
      <!-- Table of contents -->
      <div class="col-md-3 bd-toc show noprint">
       <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list">
        </i>
        Contents
       </div>
       <nav aria-label="Page" id="bd-toc-nav">
        <ul class="visible nav section-nav flex-column">
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#introduction">
           Introduction
          </a>
          <ul class="nav section-nav flex-column">
           <li class="toc-h3 nav-item toc-entry">
            <a class="reference internal nav-link" href="#download-notebook-01-products">
             0. Download notebook 01 products
            </a>
           </li>
           <li class="toc-h3 nav-item toc-entry">
            <a class="reference internal nav-link" href="#get-halpha-emission-line-map">
             1.Get Halpha emission line map;
            </a>
           </li>
           <li class="toc-h3 nav-item toc-entry">
            <a class="reference internal nav-link" href="#subtract-continuum-at-each-y-position">
             Subtract continuum at each y-position:
            </a>
           </li>
           <li class="toc-h3 nav-item toc-entry">
            <a class="reference internal nav-link" href="#extract-halpha-emission-from-a-continuum-subtracted-spectrum">
             Extract Halpha emission from a continuum-subtracted spectrum;
            </a>
           </li>
           <li class="toc-h3 nav-item toc-entry">
            <a class="reference internal nav-link" href="#get-hbeta-and-oiii-maps">
             2.Get Hbeta and OIII maps
            </a>
           </li>
           <li class="toc-h3 nav-item toc-entry">
            <a class="reference internal nav-link" href="#in-the-plot-above-you-can-see-oiii-doublet-and-hbeta">
             In the plot above, you can see Oiii doublet, and Hbeta.
            </a>
            <ul class="nav section-nav flex-column">
             <li class="toc-h4 nav-item toc-entry">
              <a class="reference internal nav-link" href="#a-get-continuum">
               2a. Get continuum;
              </a>
             </li>
             <li class="toc-h4 nav-item toc-entry">
              <a class="reference internal nav-link" href="#b-fit-emissionn-with-multi-conponent-gaussian">
               2b. Fit emissionn, with multi-conponent gaussian;
              </a>
             </li>
            </ul>
           </li>
           <li class="toc-h3 nav-item toc-entry">
            <a class="reference internal nav-link" href="#fit-to-the-central-array-looks-good-repeat-this-along-y-axis-and-get-emission-line-maps-as-a-same-way-as-for-halpha">
             Fit to the central array looks good. Repeat this along y-axis and get emission line maps, as a same way as for Halpha
            </a>
           </li>
          </ul>
         </li>
         <li class="toc-h2 nav-item toc-entry">
          <a class="reference internal nav-link" href="#summary">
           Summary;
          </a>
         </li>
        </ul>
       </nav>
      </div>
     </div>
     <div class="article row">
      <div class="col pl-md-3 pl-lg-5 content-container">
       <!-- Table of contents that is only displayed when printing the page -->
       <div class="onlyprint" id="jb-print-docs-body">
        <h1>
         WFSS Spectra Part 3: Emission Line Map
        </h1>
        <!-- Table of contents -->
        <div id="print-main-content">
         <div id="jb-print-toc">
          <div>
           <h2>
            Contents
           </h2>
          </div>
          <nav aria-label="Page">
           <ul class="visible nav section-nav flex-column">
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#introduction">
              Introduction
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#download-notebook-01-products">
                0. Download notebook 01 products
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#get-halpha-emission-line-map">
                1.Get Halpha emission line map;
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#subtract-continuum-at-each-y-position">
                Subtract continuum at each y-position:
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#extract-halpha-emission-from-a-continuum-subtracted-spectrum">
                Extract Halpha emission from a continuum-subtracted spectrum;
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#get-hbeta-and-oiii-maps">
                2.Get Hbeta and OIII maps
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#in-the-plot-above-you-can-see-oiii-doublet-and-hbeta">
                In the plot above, you can see Oiii doublet, and Hbeta.
               </a>
               <ul class="nav section-nav flex-column">
                <li class="toc-h4 nav-item toc-entry">
                 <a class="reference internal nav-link" href="#a-get-continuum">
                  2a. Get continuum;
                 </a>
                </li>
                <li class="toc-h4 nav-item toc-entry">
                 <a class="reference internal nav-link" href="#b-fit-emissionn-with-multi-conponent-gaussian">
                  2b. Fit emissionn, with multi-conponent gaussian;
                 </a>
                </li>
               </ul>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#fit-to-the-central-array-looks-good-repeat-this-along-y-axis-and-get-emission-line-maps-as-a-same-way-as-for-halpha">
                Fit to the central array looks good. Repeat this along y-axis and get emission line maps, as a same way as for Halpha
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#summary">
              Summary;
             </a>
            </li>
           </ul>
          </nav>
         </div>
        </div>
       </div>
       <main id="main-content" role="main">
        <div>
         <section class="tex2jax_ignore mathjax_ignore" id="wfss-spectra-part-3-emission-line-map">
          <h1>
           WFSS Spectra Part 3: Emission Line Map
           <a class="headerlink" href="#wfss-spectra-part-3-emission-line-map" title="Permalink to this headline">
            #
           </a>
          </h1>
          <p>
           <strong>
            Use case:
           </strong>
           optimal extraction of grism spectra; redshift measurement; emission-line maps.  Simplified version of
           <a class="reference external" href="https://jwst-docs.stsci.edu/near-infrared-imager-and-slitless-spectrograph/niriss-example-science-programs/niriss-wfss-with-nircam-parallel-imaging-of-galaxies-in-lensing-clusters">
            JDox Science Use Case # 33
           </a>
           .
           <br/>
           <strong>
            Data:
           </strong>
           JWST simulated NIRISS images from
           <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-other-tools/mirage-data-simulator">
            MIRAGE
           </a>
           , run through the
           <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/">
            JWST calibration pipeline
           </a>
           ; galaxy cluster.
           <br/>
           <strong>
            Tools:
           </strong>
           specutils, astropy, pandas, emcee, lmfit, corner, h5py.
           <br/>
           <strong>
            Cross-intrument:
           </strong>
           NIRSpec
           <br/>
           <strong>
            Documentation:
           </strong>
           This notebook is part of a STScI’s larger
           <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-post-pipeline-data-analysis">
            post-pipeline Data Analysis Tools Ecosystem
           </a>
           .
           <br/>
          </p>
          <section id="introduction">
           <h2>
            Introduction
            <a class="headerlink" href="#introduction" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            This notebook is 4 of 4 in a set focusing on NIRISS WFSS data:
1. 1D optimal extraction since the JWST pipeline only provides a box extraction.  Optimal extraction improves S/N of spectra for faint sources.
2. Combine and normalize 1D spectra.
3. Cross correlate galaxy with template to get redshift.
4. Spatially resolved emission line map.
           </p>
           <p>
            This notebook obtains an emission line map from the 2D-cutout of NIRISS WFSS spectra. This notebook will require the 2D-cutout of NIRISS WFSS spectrum (e.g., l3_nis_f150w_G150C_s00004_cal.fits; Pipeline spec3 product).
           </p>
           <p>
            <strong>
             Note:
            </strong>
            For this example, the notebook uses only a 2D rectified spectra at one dither position, directly obtained from the current versionn of the  pipeline (Build 7.5), but one could start with spectra stacked with all dither positions too, to improve S/Ns.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">astropy.convolution</span> <span class="kn">import</span> <span class="n">Gaussian2DKernel</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.stats</span> <span class="kn">import</span> <span class="n">gaussian_fwhm_to_sigma</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">QTable</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">make_lupton_rgb</span><span class="p">,</span> <span class="n">SqrtStretch</span><span class="p">,</span> <span class="n">ImageNormalize</span><span class="p">,</span> <span class="n">simple_norm</span>
<span class="kn">import</span> <span class="nn">astropy.wcs</span> <span class="k">as</span> <span class="nn">wcs</span>
<span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.modeling.polynomial</span> <span class="kn">import</span> <span class="n">Chebyshev1D</span>

<span class="kn">from</span> <span class="nn">specutils.spectra</span> <span class="kn">import</span> <span class="n">Spectrum1D</span>
<span class="kn">from</span> <span class="nn">specutils.fitting</span> <span class="kn">import</span> <span class="n">fit_lines</span>
<span class="kn">from</span> <span class="nn">specutils.fitting</span> <span class="kn">import</span> <span class="n">continuum</span>

<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">astropy_version</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'astropy'</span><span class="p">,</span> <span class="n">astropy_version</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>astropy 5.1
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">'savefig.dpi'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">'figure.dpi'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <section id="download-notebook-01-products">
            <h3>
             0. Download notebook 01 products
             <a class="headerlink" href="#download-notebook-01-products" title="Permalink to this headline">
              #
             </a>
            </h3>
            <p>
             These can be also obtained by running the notebooks.
            </p>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">'./output'</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">zipfile</span>
    <span class="kn">import</span> <span class="nn">urllib.request</span>
    <span class="n">boxlink</span> <span class="o">=</span> <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/NIRISS_lensing_cluster/output.zip'</span>
    <span class="n">boxfile</span> <span class="o">=</span> <span class="s1">'./output.zip'</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">boxlink</span><span class="p">,</span> <span class="n">boxfile</span><span class="p">)</span>
    <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">boxfile</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span>
    <span class="n">zf</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Already exists'</span><span class="p">)</span>
</pre>
               </div>
              </div>
             </div>
             <div class="cell_output docutils container">
              <div class="output stream highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>Already exists
</pre>
               </div>
              </div>
             </div>
            </div>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="c1"># Download files, if not exists yet.</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">'./pipeline_products'</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">zipfile</span>
    <span class="kn">import</span> <span class="nn">urllib.request</span>
    <span class="n">boxlink</span> <span class="o">=</span> <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/NIRISS_lensing_cluster/pipeline_products.zip'</span>
    <span class="n">boxfile</span> <span class="o">=</span> <span class="s1">'./pipeline_products.zip'</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">boxlink</span><span class="p">,</span> <span class="n">boxfile</span><span class="p">)</span>
    <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">boxfile</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span>
    <span class="n">zf</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>
</pre>
               </div>
              </div>
             </div>
            </div>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="c1"># Which target?</span>
<span class="n">DIR_OUT</span> <span class="o">=</span> <span class="s1">'./output/'</span>
<span class="n">filt</span> <span class="o">=</span> <span class="s1">'f200w'</span>

<span class="n">grism</span> <span class="o">=</span> <span class="s1">'G150C'</span>
<span class="c1">#grism = 'G150R'</span>

<span class="nb">id</span> <span class="o">=</span> <span class="s1">'00004'</span>
</pre>
               </div>
              </div>
             </div>
            </div>
           </section>
           <section id="get-halpha-emission-line-map">
            <h3>
             1.Get Halpha emission line map;
             <a class="headerlink" href="#get-halpha-emission-line-map" title="Permalink to this headline">
              #
             </a>
            </h3>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="c1"># Open two-dimensional file;</span>
<span class="c1"># can be downloaded in No.01a.</span>
<span class="n">DIR_DATA</span> <span class="o">=</span> <span class="s1">'./pipeline_products/'</span>

<span class="c1"># Zero-indexed number for dither --- the test data has two dither positions.</span>
<span class="n">ndither</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># File</span>
<span class="n">file_2d</span> <span class="o">=</span> <span class="s1">'</span><span class="si">%s</span><span class="s1">l3_nis_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_s</span><span class="si">%s</span><span class="s1">_cal.fits'</span><span class="o">%</span><span class="p">(</span><span class="n">DIR_DATA</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">grism</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
<span class="n">hdu_2d</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_2d</span><span class="p">)</span>

<span class="c1"># Align grism direction</span>
<span class="c1">#   - x-direction = Dispersion (wavelength) direction.</span>
<span class="c1">#   - y-direction = Cross-dispersion.</span>
<span class="c1"># in this notebook.</span>
    
<span class="k">if</span> <span class="n">grism</span> <span class="o">==</span> <span class="s1">'G150C'</span><span class="p">:</span>
    <span class="c1"># If spectrum is horizontal;</span>
    <span class="n">data_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">err_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">wave_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">data_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">dq_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">err_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">wave_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</pre>
               </div>
              </div>
             </div>
            </div>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,:])</span>
</pre>
               </div>
              </div>
             </div>
             <div class="cell_output docutils container">
              <div class="output text_plain highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fa79f6f6460&gt;
</pre>
               </div>
              </div>
              <img alt="../../_images/03_Spatially_resolved_emission_line_map_11_1.png" src="../../_images/03_Spatially_resolved_emission_line_map_11_1.png"/>
             </div>
            </div>
           </section>
           <section id="subtract-continuum-at-each-y-position">
            <h3>
             Subtract continuum at each y-position:
             <a class="headerlink" href="#subtract-continuum-at-each-y-position" title="Permalink to this headline">
              #
             </a>
            </h3>
            <p>
             There are two options, depending on the brightness of the source;
            </p>
            <ul class="simple">
             <li>
              <p>
               1.Subtract continuum estimated at each position of cross-dispersion column. This works for a bright source.
              </p>
             </li>
             <li>
              <p>
               2.Subtract a single continuum (“master continuum”), assuming the shape is same across cross-dispersion direction as the one from a 1d extraction. This is required for a faint source.
              </p>
             </li>
            </ul>
            <p>
             Since we clearly see continuum across the source, here we demonstrate the option 1.
            </p>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="c1"># At which y position do we want to see spectrum?</span>
<span class="c1"># as an example;</span>
<span class="n">yy</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">spec_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span>

<span class="n">mask_line</span> <span class="o">=</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&gt;</span> <span class="mf">1.75</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&lt;</span> <span class="mf">1.97</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&gt;</span> <span class="mf">2.08</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&lt;</span> <span class="mf">2.23</span><span class="p">))</span>

<span class="n">obs</span>  <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">data_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">)</span>
<span class="n">cont</span> <span class="o">=</span> <span class="n">continuum</span><span class="o">.</span><span class="n">fit_generic_continuum</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">Chebyshev1D</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:],</span> <span class="n">data_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Observed at y=</span><span class="si">%d</span><span class="s1">'</span><span class="o">%</span><span class="p">(</span><span class="n">yy</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">cont</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Fitted continuum'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.6</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">)</span>
</pre>
               </div>
              </div>
             </div>
             <div class="cell_output docutils container">
              <div class="output stderr highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>WARNING: Model is linear in parameters; consider using linear fitting methods. [astropy.modeling.fitting]
</pre>
               </div>
              </div>
              <div class="output text_plain highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>(1.6, 2.3)
</pre>
               </div>
              </div>
              <img alt="../../_images/03_Spatially_resolved_emission_line_map_13_2.png" src="../../_images/03_Spatially_resolved_emission_line_map_13_2.png"/>
             </div>
            </div>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="n">cont</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</pre>
               </div>
              </div>
             </div>
             <div class="cell_output docutils container">
              <div class="output text_plain highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>array([250.33514625, 251.34196997, 252.3399539 , 253.31373358,
       254.24980241, 255.13666809, 255.96455649, 256.72516215,
       257.41178054, 258.01904392, 258.54273027, 258.97986573,
       259.32840475, 259.58730346, 259.75633833, 259.83601505,
       259.82753631, 259.73268276, 259.55376941, 259.29355234,
       258.95516032, 258.54210389, 258.05809227, 257.50714698,
       256.89339286, 256.22107226, 255.4946214 , 254.71842986,
       253.89689648, 253.03453451, 252.13569698, 251.2046636 ,
       227.2937026 , 226.56797698, 225.86951509, 225.19837698,
       224.55451447, 223.93770343, 223.34764344, 222.78388357,
       222.24585274, 221.73279607, 221.24384862, 220.7779845 ,
       220.33396715, 219.91041011, 219.50570908, 219.11804745,
       218.74533159, 218.38522917, 218.03510699, 217.69197741,
       217.35251716, 217.01299411, 216.66924474, 216.31659529,
       215.94986731, 215.56329808, 215.15045747, 214.70424554,
       214.21679044, 213.6794031 , 213.08244929, 212.41535398,
       211.66646567, 210.82300532, 209.87088579, 208.79474276,
       207.57778338, 206.20156842, 204.64608538, 202.88950983,
       200.90816203, 198.67616835, 196.16562581, 193.34633991,
       190.18542588, 186.64758372, 182.694655  ])
</pre>
               </div>
              </div>
             </div>
            </div>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="c1"># Repeat this along y-axis;</span>
<span class="n">flux_cont2d</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[:,:]</span> <span class="o">*</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])):</span>

    <span class="n">mask_line</span> <span class="o">=</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&gt;</span> <span class="mf">1.75</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&lt;</span> <span class="mf">1.97</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&gt;</span> <span class="mf">2.08</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&lt;</span> <span class="mf">2.23</span><span class="p">))</span>

    <span class="n">obs</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">data_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">)</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="n">continuum</span><span class="o">.</span><span class="n">fit_generic_continuum</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">Chebyshev1D</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>

    <span class="n">flux_cont2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cont</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</pre>
               </div>
              </div>
             </div>
            </div>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">flux_cont2d</span><span class="p">[:,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Fitted continuum'</span><span class="p">)</span>
</pre>
               </div>
              </div>
             </div>
             <div class="cell_output docutils container">
              <div class="output text_plain highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>Text(0.5, 1.0, 'Fitted continuum')
</pre>
               </div>
              </div>
              <img alt="../../_images/03_Spatially_resolved_emission_line_map_16_1.png" src="../../_images/03_Spatially_resolved_emission_line_map_16_1.png"/>
             </div>
            </div>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,:]</span> <span class="o">-</span> <span class="n">flux_cont2d</span><span class="p">[:,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Continuum subtracted spectrum'</span><span class="p">)</span>
</pre>
               </div>
              </div>
             </div>
             <div class="cell_output docutils container">
              <div class="output text_plain highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>Text(0.5, 1.0, 'Continuum subtracted spectrum')
</pre>
               </div>
              </div>
              <img alt="../../_images/03_Spatially_resolved_emission_line_map_17_1.png" src="../../_images/03_Spatially_resolved_emission_line_map_17_1.png"/>
             </div>
            </div>
           </section>
           <section id="extract-halpha-emission-from-a-continuum-subtracted-spectrum">
            <h3>
             Extract Halpha emission from a continuum-subtracted spectrum;
             <a class="headerlink" href="#extract-halpha-emission-from-a-continuum-subtracted-spectrum" title="Permalink to this headline">
              #
             </a>
            </h3>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="c1"># Cutout Ha line map;</span>
<span class="n">rsq</span> <span class="o">=</span> <span class="n">data_2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cut_ha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rsq</span><span class="p">,</span><span class="n">rsq</span><span class="p">),</span><span class="s1">'float32'</span><span class="p">)</span>

<span class="n">zin</span> <span class="o">=</span> <span class="mf">2.1</span> <span class="c1"># From Notebook No.3, cross-correlation;</span>
<span class="n">lamcen</span> <span class="o">=</span> <span class="mf">0.6564</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">zin</span><span class="p">)</span>

<span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])):</span>
    <span class="c1"># This has to be done at each y pixel, as wavelength array can be tilted.</span>
    <span class="n">index_lamcen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lamcen</span> <span class="o">-</span> <span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]))</span>
    <span class="n">cut_ha</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_2d</span> <span class="o">-</span> <span class="n">flux_cont2d</span><span class="p">)[</span><span class="n">yy</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen</span><span class="o">-</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen</span><span class="o">+</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cut_ha</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'H$</span><span class="se">\\</span><span class="s1">alpha$ map'</span><span class="p">)</span>
</pre>
               </div>
              </div>
             </div>
             <div class="cell_output docutils container">
              <div class="output text_plain highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>Text(0.5, 1.0, 'H$\\alpha$ map')
</pre>
               </div>
              </div>
              <img alt="../../_images/03_Spatially_resolved_emission_line_map_19_1.png" src="../../_images/03_Spatially_resolved_emission_line_map_19_1.png"/>
             </div>
            </div>
           </section>
           <section id="get-hbeta-and-oiii-maps">
            <h3>
             2.Get Hbeta and OIII maps
             <a class="headerlink" href="#get-hbeta-and-oiii-maps" title="Permalink to this headline">
              #
             </a>
            </h3>
            <p>
             This is more challenging, as these lines locate close to each other. Ideally, iteration process will be preferred, but here we use Specutils’ double gaussian component fitting, in a similar way for Ha.
            </p>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="n">filt</span> <span class="o">=</span> <span class="s1">'f150w'</span>

<span class="n">file_2d</span> <span class="o">=</span> <span class="s1">'</span><span class="si">%s</span><span class="s1">l3_nis_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_s</span><span class="si">%s</span><span class="s1">_cal.fits'</span><span class="o">%</span><span class="p">(</span><span class="n">DIR_DATA</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">grism</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
<span class="n">hdu_2d</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_2d</span><span class="p">)</span>

<span class="c1"># Align grism direction</span>
<span class="c1">#   - x-direction = Dispersion (wavelength) direction.</span>
<span class="c1">#   - y-direction = Cross-dispersion.</span>
<span class="c1"># in this notebook.</span>
    
<span class="k">if</span> <span class="n">grism</span> <span class="o">==</span> <span class="s1">'G150C'</span><span class="p">:</span>
    <span class="c1"># If spectrum is horizontal;</span>
    <span class="n">data_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">err_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">wave_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">data_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">dq_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">err_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">wave_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    
<span class="c1"># !! Note that the extracted spectra has flipped wavelength direction !!</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'</span><span class="si">%s</span><span class="s1">'</span><span class="o">%</span><span class="p">(</span><span class="n">filt</span><span class="p">))</span>
</pre>
               </div>
              </div>
             </div>
             <div class="cell_output docutils container">
              <div class="output text_plain highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>Text(0.5, 1.0, 'f150w')
</pre>
               </div>
              </div>
              <img alt="../../_images/03_Spatially_resolved_emission_line_map_21_1.png" src="../../_images/03_Spatially_resolved_emission_line_map_21_1.png"/>
             </div>
            </div>
           </section>
           <section id="in-the-plot-above-you-can-see-oiii-doublet-and-hbeta">
            <h3>
             In the plot above, you can see Oiii doublet, and Hbeta.
             <a class="headerlink" href="#in-the-plot-above-you-can-see-oiii-doublet-and-hbeta" title="Permalink to this headline">
              #
             </a>
            </h3>
            <section id="a-get-continuum">
             <h4>
              2a. Get continuum;
              <a class="headerlink" href="#a-get-continuum" title="Permalink to this headline">
               #
              </a>
             </h4>
             <div class="cell docutils container">
              <div class="cell_input docutils container">
               <div class="highlight-ipython3 notranslate">
                <div class="highlight">
                 <pre><span></span><span class="n">yy</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># as an example;</span>

<span class="n">spec_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span>

<span class="n">mask_line</span> <span class="o">=</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&gt;</span> <span class="mf">1.35</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&lt;</span> <span class="mf">1.48</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&gt;</span> <span class="mf">1.6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&lt;</span> <span class="mf">1.65</span><span class="p">))</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">data_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">)</span>
<span class="n">cont</span> <span class="o">=</span> <span class="n">continuum</span><span class="o">.</span><span class="n">fit_generic_continuum</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">Chebyshev1D</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:],</span> <span class="n">data_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Observed at y=</span><span class="si">%d</span><span class="s1">'</span><span class="o">%</span><span class="p">(</span><span class="n">yy</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">cont</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Fitted continuum'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">)</span>
</pre>
                </div>
               </div>
              </div>
              <div class="cell_output docutils container">
               <div class="output text_plain highlight-myst-ansi notranslate">
                <div class="highlight">
                 <pre><span></span>(1.2, 1.8)
</pre>
                </div>
               </div>
               <img alt="../../_images/03_Spatially_resolved_emission_line_map_24_1.png" src="../../_images/03_Spatially_resolved_emission_line_map_24_1.png"/>
              </div>
             </div>
             <div class="cell docutils container">
              <div class="cell_input docutils container">
               <div class="highlight-ipython3 notranslate">
                <div class="highlight">
                 <pre><span></span><span class="c1"># Repeat this along y-axis;</span>
<span class="n">flux_cont2d_150</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[:,:]</span> <span class="o">*</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])):</span>

    <span class="n">mask_line</span> <span class="o">=</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&gt;</span> <span class="mf">1.35</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&lt;</span> <span class="mf">1.48</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&gt;</span> <span class="mf">1.6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&lt;</span> <span class="mf">1.65</span><span class="p">))</span>

    <span class="n">obs</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">data_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">)</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="n">continuum</span><span class="o">.</span><span class="n">fit_generic_continuum</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">Chebyshev1D</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>

    <span class="n">flux_cont2d_150</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cont</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">flux_cont2d_150</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre>
                </div>
               </div>
              </div>
              <div class="cell_output docutils container">
               <div class="output text_plain highlight-myst-ansi notranslate">
                <div class="highlight">
                 <pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fa79b2f8790&gt;
</pre>
                </div>
               </div>
               <img alt="../../_images/03_Spatially_resolved_emission_line_map_25_1.png" src="../../_images/03_Spatially_resolved_emission_line_map_25_1.png"/>
              </div>
             </div>
             <div class="cell docutils container">
              <div class="cell_input docutils container">
               <div class="highlight-ipython3 notranslate">
                <div class="highlight">
                 <pre><span></span><span class="n">line_2d</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[:,:]</span> <span class="o">-</span> <span class="n">flux_cont2d_150</span><span class="p">[:,:]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">line_2d</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre>
                </div>
               </div>
              </div>
              <div class="cell_output docutils container">
               <div class="output text_plain highlight-myst-ansi notranslate">
                <div class="highlight">
                 <pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fa79b2c1bb0&gt;
</pre>
                </div>
               </div>
               <img alt="../../_images/03_Spatially_resolved_emission_line_map_26_1.png" src="../../_images/03_Spatially_resolved_emission_line_map_26_1.png"/>
              </div>
             </div>
            </section>
            <section id="b-fit-emissionn-with-multi-conponent-gaussian">
             <h4>
              2b. Fit emissionn, with multi-conponent gaussian;
              <a class="headerlink" href="#b-fit-emissionn-with-multi-conponent-gaussian" title="Permalink to this headline">
               #
              </a>
             </h4>
             <div class="cell docutils container">
              <div class="cell_input docutils container">
               <div class="highlight-ipython3 notranslate">
                <div class="highlight">
                 <pre><span></span><span class="n">yy</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># Fit the spectrum</span>
<span class="n">con</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.4</span> <span class="o">&lt;</span> <span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&lt;</span> <span class="mf">1.65</span><span class="p">)</span>

<span class="n">spectrum_cut</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">flux</span><span class="o">=</span><span class="n">line_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">con</span><span class="p">]</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span>
                          <span class="n">spectral_axis</span><span class="o">=</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">con</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

<span class="c1"># !!! Some tweaks may be needed for initial value, to successfuully run the fit;</span>

<span class="c1"># For Hb</span>
<span class="n">g1_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.5</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.005</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

<span class="c1"># For O3 blue</span>
<span class="n">g2_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mf">50.</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.535</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.002</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

<span class="c1"># For O3 red</span>
<span class="n">g3_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mf">45.</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.55</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.001</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

<span class="n">g123_fit</span> <span class="o">=</span> <span class="n">fit_lines</span><span class="p">(</span><span class="n">spectrum_cut</span><span class="p">,</span> <span class="n">g1_init</span><span class="o">+</span><span class="n">g2_init</span><span class="o">+</span><span class="n">g3_init</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span><span class="mf">0.001</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span><span class="mf">0.001</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">])</span>
<span class="n">y_fit</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">g123_fit</span><span class="p">)</span>
</pre>
                </div>
               </div>
              </div>
              <div class="cell_output docutils container">
               <div class="output stream highlight-myst-ansi notranslate">
                <div class="highlight">
                 <pre><span></span>Model: CompoundModel
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Expression: [0] + [1] + [2]
Components: 
    [0]: &lt;Gaussian1D(amplitude=105.67672529 , mean=1.50774443 um, stddev=0.00935698 um)&gt;

    [1]: &lt;Gaussian1D(amplitude=82.09499951 , mean=1.53395958 um, stddev=0.0064488 um)&gt;

    [2]: &lt;Gaussian1D(amplitude=186.44732716 , mean=1.54938177 um, stddev=0.0110966 um)&gt;
Parameters:
       amplitude_0           mean_0       ...       stddev_2      
                               um         ...          um         
    ------------------ ------------------ ... --------------------
    105.67672528736512 1.5077444323784523 ... 0.011096600264679632
</pre>
                </div>
               </div>
               <div class="output stderr highlight-myst-ansi notranslate">
                <div class="highlight">
                 <pre><span></span>WARNING: The fit may be unsuccessful; check fit_info['message'] for more information. [astropy.modeling.fitting]
</pre>
                </div>
               </div>
              </div>
             </div>
             <div class="cell docutils container">
              <div class="cell_input docutils container">
               <div class="highlight-ipython3 notranslate">
                <div class="highlight">
                 <pre><span></span><span class="c1"># Plot separately?</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:],</span> <span class="n">line_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'.'</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Observed at y=</span><span class="si">%d</span><span class="s1">'</span><span class="o">%</span><span class="p">(</span><span class="n">yy</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:],</span> <span class="n">y_fit</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Fit'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">y_fit1</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:],</span> <span class="n">y_fit1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'g'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'1'</span><span class="p">)</span>

<span class="n">y_fit1</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:],</span> <span class="n">y_fit1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'2'</span><span class="p">)</span>

<span class="n">y_fit1</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">[</span><span class="mi">2</span><span class="p">](</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:],</span> <span class="n">y_fit1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'purple'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'3'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Single fit peak'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre>
                </div>
               </div>
              </div>
              <div class="cell_output docutils container">
               <div class="output text_plain highlight-myst-ansi notranslate">
                <div class="highlight">
                 <pre><span></span>&lt;matplotlib.legend.Legend at 0x7fa79b271b80&gt;
</pre>
                </div>
               </div>
               <img alt="../../_images/03_Spatially_resolved_emission_line_map_29_1.png" src="../../_images/03_Spatially_resolved_emission_line_map_29_1.png"/>
              </div>
             </div>
             <div class="cell docutils container">
              <div class="cell_input docutils container">
               <div class="highlight-ipython3 notranslate">
                <div class="highlight">
                 <pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">g123_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">g123_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">g123_fit</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre>
                </div>
               </div>
              </div>
              <div class="cell_output docutils container">
               <div class="output stream highlight-myst-ansi notranslate">
                <div class="highlight">
                 <pre><span></span>Model: Gaussian1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Parameters:
        amplitude             mean               stddev       
                               um                  um         
    ------------------ ------------------ --------------------
    105.67672528736512 1.5077444323784523 0.009356977079029261
Model: Gaussian1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Parameters:
        amplitude            mean               stddev       
                              um                  um         
    ----------------- ------------------ --------------------
    82.09499950808333 1.5339595832025317 0.006448802572610104
Model: Gaussian1D
Inputs: ('x',)
Outputs: ('y',)
Model set size: 1
Parameters:
        amplitude             mean               stddev       
                               um                  um         
    ------------------ ------------------ --------------------
    186.44732716000823 1.5493817718594916 0.011096600264679632
</pre>
                </div>
               </div>
              </div>
             </div>
            </section>
           </section>
           <section id="fit-to-the-central-array-looks-good-repeat-this-along-y-axis-and-get-emission-line-maps-as-a-same-way-as-for-halpha">
            <h3>
             Fit to the central array looks good. Repeat this along y-axis and get emission line maps, as a same way as for Halpha
             <a class="headerlink" href="#fit-to-the-central-array-looks-good-repeat-this-along-y-axis-and-get-emission-line-maps-as-a-same-way-as-for-halpha" title="Permalink to this headline">
              #
             </a>
            </h3>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="c1"># Cutout Hb, Oiii line maps;</span>
<span class="n">rsq</span> <span class="o">=</span> <span class="n">data_2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cut_hb</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rsq</span><span class="p">,</span> <span class="n">rsq</span><span class="p">),</span> <span class="s1">'float32'</span><span class="p">)</span>
<span class="n">cut_o3b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rsq</span><span class="p">,</span> <span class="n">rsq</span><span class="p">),</span> <span class="s1">'float32'</span><span class="p">)</span>
<span class="n">cut_o3r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rsq</span><span class="p">,</span> <span class="n">rsq</span><span class="p">),</span> <span class="s1">'float32'</span><span class="p">)</span>

<span class="n">zin</span> <span class="o">=</span> <span class="mf">2.1</span> <span class="c1"># Redshift estimate from Notebook No.2, cross-correlation;</span>
<span class="n">lamcen_hb</span>  <span class="o">=</span> <span class="mf">0.4862680</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">zin</span><span class="p">)</span>
<span class="n">lamcen_o3b</span> <span class="o">=</span> <span class="mf">0.4960295</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">zin</span><span class="p">)</span>
<span class="n">lamcen_o3r</span> <span class="o">=</span> <span class="mf">0.5008240</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">zin</span><span class="p">)</span>

<span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])):</span>
    <span class="c1"># Fit the spectrum</span>
    <span class="n">con</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.4</span> <span class="o">&lt;</span> <span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">&lt;</span> <span class="mf">1.65</span><span class="p">)</span>
    <span class="n">spectrum_cut</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">flux</span><span class="o">=</span><span class="n">line_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">con</span><span class="p">]</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> 
                              <span class="n">spectral_axis</span><span class="o">=</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:][</span><span class="n">con</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

    <span class="c1"># !!! Some tweaks may be needed for initial value, to successfuully run the fit;</span>

    <span class="c1"># For Hb</span>
    <span class="n">g1_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.5</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.005</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
    <span class="c1"># For O3 blue</span>
    <span class="n">g2_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mf">50.</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.535</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.002</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
    <span class="c1"># For O3 red</span>
    <span class="n">g3_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mf">45.</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.55</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.001</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
    <span class="n">g123_fit</span> <span class="o">=</span> <span class="n">fit_lines</span><span class="p">(</span><span class="n">spectrum_cut</span><span class="p">,</span> <span class="n">g1_init</span><span class="o">+</span><span class="n">g2_init</span><span class="o">+</span><span class="n">g3_init</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="mf">0.001</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="mf">0.001</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">])</span>
    <span class="n">y_fit</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

    <span class="c1"># This has to be done at each y pixel, as wavelength array can be tilted.</span>
    <span class="n">index_lamcen_hb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lamcen_hb</span> <span class="o">-</span> <span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]))</span>
    <span class="n">cut_hb</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen_hb</span><span class="o">-</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen_hb</span><span class="o">+</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">)]</span>

    <span class="n">index_lamcen_o3b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lamcen_o3b</span> <span class="o">-</span> <span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]))</span>
    <span class="n">cut_o3b</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen_o3b</span><span class="o">-</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen_o3b</span><span class="o">+</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">)]</span>

    <span class="n">index_lamcen_o3r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lamcen_o3r</span> <span class="o">-</span> <span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]))</span>
    <span class="n">cut_o3r</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">[</span><span class="mi">2</span><span class="p">](</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen_o3r</span><span class="o">-</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen_o3r</span><span class="o">+</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">)]</span>
    
</pre>
               </div>
              </div>
             </div>
             <div class="cell_output docutils container">
              <div class="output stderr highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>WARNING: The fit may be unsuccessful; check fit_info['message'] for more information. [astropy.modeling.fitting]
</pre>
               </div>
              </div>
             </div>
            </div>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cut_hb</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'H$</span><span class="se">\\</span><span class="s1">beta$ map'</span><span class="p">)</span>
</pre>
               </div>
              </div>
             </div>
             <div class="cell_output docutils container">
              <div class="output text_plain highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>Text(0.5, 1.0, 'H$\\beta$ map')
</pre>
               </div>
              </div>
              <img alt="../../_images/03_Spatially_resolved_emission_line_map_33_1.png" src="../../_images/03_Spatially_resolved_emission_line_map_33_1.png"/>
             </div>
            </div>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cut_o3b</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Oiii 4960'</span><span class="p">)</span>
</pre>
               </div>
              </div>
             </div>
             <div class="cell_output docutils container">
              <div class="output text_plain highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>Text(0.5, 1.0, 'Oiii 4960')
</pre>
               </div>
              </div>
              <img alt="../../_images/03_Spatially_resolved_emission_line_map_34_1.png" src="../../_images/03_Spatially_resolved_emission_line_map_34_1.png"/>
             </div>
            </div>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cut_o3r</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Oiii 5008'</span><span class="p">)</span>
</pre>
               </div>
              </div>
             </div>
             <div class="cell_output docutils container">
              <div class="output text_plain highlight-myst-ansi notranslate">
               <div class="highlight">
                <pre><span></span>Text(0.5, 1.0, 'Oiii 5008')
</pre>
               </div>
              </div>
              <img alt="../../_images/03_Spatially_resolved_emission_line_map_35_1.png" src="../../_images/03_Spatially_resolved_emission_line_map_35_1.png"/>
             </div>
            </div>
           </section>
          </section>
          <section id="summary">
           <h2>
            Summary;
            <a class="headerlink" href="#summary" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            As seen above, regions except for the very center
            <font color="red">
             do not look right.
            </font>
            This is due to failure of multi-component fit, especially for Oiii doublet.
To improve the fit, one can either;
           </p>
           <ul class="simple">
            <li>
             <p>
              fit and inspect the fit repeatedly at each y-axis until it converges,
             </p>
            </li>
            <li>
             <p>
              use MCMC for more intensive fitting, which also enables to fix the ratio of two Oiii lines by setting up a prior.
             </p>
            </li>
            <li>
             <p>
              or reduce the number of components, especially for Oiii doublet at the edge of the source position, where the lines are blended.
             </p>
            </li>
           </ul>
          </section>
         </section>
         <script type="text/x-thebe-config">
          {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/jdat_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/NIRISS_WFSS_postpipeline"
        },
        predefinedOutput: true
    }
         </script>
         <script>
          kernelName = 'python3'
         </script>
        </div>
       </main>
       <footer class="footer-article noprint">
        <!-- Previous / next buttons -->
        <div class="prev-next-area">
         <a class="left-prev" href="02_Cross_correlation_template.html" id="prev-link" title="previous page">
          <i class="fas fa-angle-left">
          </i>
          <div class="prev-next-info">
           <p class="prev-next-subtitle">
            previous
           </p>
           <p class="prev-next-title">
            WFSS Spectra - Part 2: Cross Correlation to Determine Redshift
           </p>
          </div>
         </a>
         <a class="right-next" href="../IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html" id="next-link" title="next page">
          <div class="prev-next-info">
           <p class="prev-next-subtitle">
            next
           </p>
           <p class="prev-next-title">
            IFU Cube Fitting
           </p>
          </div>
          <i class="fas fa-angle-right">
          </i>
         </a>
        </div>
       </footer>
      </div>
     </div>
     <div class="footer-content row">
      <footer class="col footer">
       <p>
        By STScI
        <br/>
        © Copyright 2022.
        <br/>
       </p>
      </footer>
     </div>
    </div>
   </div>
  </div>
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  </script>
 </body>
</html>